<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>åºŸåœŸæ–¹èˆŸ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#x1F3F0;</text></svg>">
    
    <style>
        /* ====== åŸºç¡€é‡ç½® ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0a0a12;
            color: #e0e0ff;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        /* ====== PWAå…¨å±ä¼˜åŒ– ====== */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        /* ====== æ¨ªç«–å±åˆ‡æ¢æ ·å¼ ====== */
        body.portrait-mode #game-container {
            flex-direction: column;
        }
        
        body.landscape-mode #game-container {
            flex-direction: row;
        }
        
        body.portrait-mode #main-content {
            flex-direction: column;
        }
        
        body.landscape-mode #main-content {
            flex-direction: row;
        }
        
        body.portrait-mode #map-container {
            height: 50vh;
            min-height: 300px;
        }
        
        body.landscape-mode #map-container {
            flex: 1;
            min-height: 0;
        }
        
        body.portrait-mode #control-panel {
            flex-direction: row;
            height: auto;
        }
        
        body.landscape-mode #control-panel {
            flex-direction: column;
            width: 120px;
        }

        /* ====== åŠ è½½åŠ¨ç”» ====== */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        /* ====== æ¸¸æˆä¸»å®¹å™¨ ====== */
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 5px;
            gap: 5px;
            display: none;
        }

        /* ====== é¡¶éƒ¨çŠ¶æ€æ  ====== */
        #status-bar {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 8px;
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #3498db;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            height: 45px;
            font-size: 12px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 0 3px;
            flex-shrink: 0;
        }

        .status-icon {
            font-size: 14px;
            min-width: 20px;
            text-align: center;
        }

        .status-value {
            font-size: 13px;
            font-weight: bold;
            color: #fff;
            white-space: nowrap;
        }

        /* ====== ä¸»å†…å®¹åŒºåŸŸ ====== */
        #main-content {
            flex: 1;
            display: flex;
            gap: 5px;
            min-height: 0;
        }

        /* ====== ä¸­å¤®åœ°å›¾åŒºåŸŸ ====== */
        #map-container {
            flex: 1;
            background: rgba(25, 30, 45, 0.95);
            border-radius: 8px;
            border: 1px solid #444;
            position: relative;
            overflow: hidden;
        }

        #base-canvas {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
        }

        /* ====== æ§åˆ¶é¢æ¿ ====== */
        #control-panel {
            display: flex;
            gap: 5px;
            padding: 8px;
            background: rgba(30, 35, 50, 0.95);
            border-radius: 8px;
            border: 1px solid #444;
        }

        /* ====== é€šç”¨æŒ‰é’®æ ·å¼ ====== */
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 6px;
            color: white;
            padding: 5px 10px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            height: 30px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }

        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-success { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-purple { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .btn-orange { background: linear-gradient(135deg, #e67e22, #d35400); }
        .btn-pause { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-resume { background: linear-gradient(135deg, #2ecc71, #27ae60); }

        .btn-small {
            padding: 3px 6px;
            font-size: 10px;
            height: 24px;
        }

        /* ====== å¼¹çª—ç³»ç»Ÿ ====== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 10px;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            background: #2c3e50;
            border-radius: 10px;
            padding: 15px;
            width: 95%;
            max-width: 400px;
            border: 2px solid #3498db;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 15px;
            color: #3498db;
            margin-bottom: 10px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* ====== å¢å¼ºå…³é—­æŒ‰é’®æ ·å¼ ====== */
        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            z-index: 1001;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .close-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }

        .close-btn:active {
            transform: scale(0.95);
        }

        /* ====== äººç‰©å¼¹çª—æ ·å¼ ====== */
        #survivors-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* å¹¸å­˜è€…åˆ—è¡¨ */
        #survivors-list-container {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 5px;
        }

        .survivor-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .survivor-item:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: #3498db;
        }

        .survivor-item.selected {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
        }

        .survivor-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .survivor-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .survivor-name {
            font-weight: bold;
            font-size: 14px;
        }

        .survivor-skill {
            font-size: 11px;
            color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .stat-bar {
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 4px 0;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .health-bar { background: linear-gradient(90deg, #e74c3c, #f39c12); }
        .hunger-bar { background: linear-gradient(90deg, #2ecc71, #f39c12); }
        .energy-bar { background: linear-gradient(90deg, #3498db, #9b59b6); }

        .stat-label {
            font-size: 10px;
            color: #8899cc;
            display: flex;
            justify-content: space-between;
        }

        /* å¹¸å­˜è€…è¯¦æƒ… */
        .detail-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-icon {
            font-size: 48px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .detail-info h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .detail-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
        }

        .stat-title {
            font-size: 11px;
            color: #8899cc;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
        }

        /* äººç‰©è¡ŒåŠ¨æŒ‰é’® */
        .survivor-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        /* æ‹›å‹ŸæŒ‰é’® */
        #recruit-survivor-btn {
            margin-top: 10px;
            width: 100%;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-idle { background: #3498db; }
        .status-working { background: #2ecc71; }
        .status-injured { background: #e74c3c; }
        .status-tired { background: #f39c12; }

        /* ====== èµ„æºå¼¹çª—æ ·å¼ ====== */
        .resource-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 13px;
        }

        .resource-icon {
            font-size: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            flex-shrink: 0;
        }

        .resource-bar {
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 5px 0;
            overflow: hidden;
        }

        .resource-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s;
        }

        /* ====== ç§‘æŠ€æ ‘æ ·å¼ ====== */
        .tech-item {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .tech-item:hover {
            background: rgba(52, 152, 219, 0.2);
        }

        .tech-item.researched {
            background: rgba(46, 204, 113, 0.2);
            border-color: #2ecc71;
        }

        .tech-item.insufficient {
            background: rgba(231, 76, 60, 0.1);
            border-color: #e74c3c;
            opacity: 0.7;
        }

        /* ====== æˆå°±æ ·å¼ ====== */
        .achievement-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            margin: 8px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            font-size: 13px;
        }

        .achievement-item.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .achievement-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            flex-shrink: 0;
        }

        /* ====== è®¾ç½®é¡¹æ ·å¼ ====== */
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            font-size: 14px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #666;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* ====== æˆ˜æ–—ç•Œé¢æ ·å¼ ====== */
        .enemy-card {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            font-size: 14px;
        }

        .combat-log {
            height: 120px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
        }

        .combat-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        /* ====== æ¢ç´¢è®¡æ—¶å™¨æ ·å¼ ====== */
        #explore-timer {
            position: fixed;
            top: 60px;
            right: 10px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 1002;
            font-size: 14px;
            animation: fadeIn 0.3s;
            border: 2px solid #2ecc71;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
        }

        #explore-timer .time {
            font-weight: bold;
            color: #f39c12;
            font-size: 16px;
        }

        /* ====== åŠ¨ç”»å®šä¹‰ ====== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ====== é€šçŸ¥ç³»ç»Ÿ ====== */
        #notification-container {
            position: fixed;
            top: 50px;
            right: 10px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 300px;
        }

        .notification {
            background: #2c3e50;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s, fadeOut 0.3s 2.7s forwards;
            font-size: 14px;
        }

        .notification.success { border-left-color: #2ecc71; }
        .notification.warning { border-left-color: #f39c12; }
        .notification.danger { border-left-color: #e74c3c; }

        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(-10px); }
        }

        /* ====== å®‰è£…æç¤º ====== */
        #install-prompt {
            position: fixed;
            top: 50px;
            right: 10px;
            background: #2ecc71;
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s;
            z-index: 1002;
            font-size: 13px;
            display: none;
        }

        #install-prompt button {
            background: white;
            color: #2ecc71;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ====== æ—¶é—´æ˜¾ç¤ºæ ·å¼ ====== */
        #time-display {
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }
        
        /* ====== éŸ³é‡æ»‘å—æ ·å¼ ====== */
        input[type="range"] {
            width: 120px;
            height: 8px;
            -webkit-appearance: none;
            background: #34495e;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }
        
        /* ====== éŸ³ä¹æ§åˆ¶å®¹å™¨ ====== */
        .music-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body class="portrait-mode">
    <!-- åŠ è½½å±å¹• -->
    <div id="loading-screen">
        <div class="loading-spinner"></div>
        <div style="font-size: 18px; color: #3498db; margin-bottom: 10px; font-weight: bold;">åºŸåœŸæ–¹èˆŸ</div>
        <div style="font-size: 12px; color: #8899cc; text-align: center; max-width: 300px;">
            åŠ è½½ä¸­...
        </div>
    </div>

    <!-- å®‰è£…æç¤º -->
    <div id="install-prompt">
        <span>&#x1F4F1;</span> æƒ³æ·»åŠ åˆ°æ¡Œé¢å—ï¼Ÿ
        <button id="install-btn">å®‰è£…</button>
    </div>

    <!-- ä¸»æ¸¸æˆç•Œé¢ -->
    <div id="game-container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div id="status-bar">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div class="status-item">
                    <span class="status-icon">&#x1F4C5;</span>
                    <span class="status-value" id="day-count">ç¬¬1å¤©</span>
                </div>
                
                <div class="status-item">
                    <span class="status-icon">&#x23F0;</span>
                    <span class="status-value" id="time-display">07:00:00</span>
                </div>
                
                <div class="status-item">
                    <span class="status-icon">&#x2601;&#xFE0F;</span>
                    <span class="status-value" id="weather">æ™´æœ—</span>
                </div>
                
                <button class="btn btn-small btn-success" id="btn-explore">
                    <span>&#x1F9ED;</span>
                    <span>æ¢ç´¢</span>
                </button>
                
                <button class="btn btn-small btn-pause" id="btn-pause">
                    <span>&#x23F8;&#xFE0F;</span>
                    <span>æš‚åœ</span>
                </button>
                
                <button class="btn btn-small btn-purple" id="btn-settings">
                    <span>&#x2699;&#xFE0F;</span>
                    <span>è®¾ç½®</span>
                </button>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div id="main-content">
            <!-- ä¸­å¤®åœ°å›¾åŒºåŸŸ -->
            <div id="map-container">
                <canvas id="base-canvas"></canvas>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div id="control-panel">
            <!-- äººç‰©æŒ‰é’®ï¼ˆæœ€å·¦è¾¹ï¼‰ -->
            <button class="btn btn-orange" id="btn-survivors">
                <span>&#x1F465;</span>
                <span>äººç‰©</span>
            </button>
            
            <!-- èµ„æºæŒ‰é’®ï¼ˆæ—è¾¹ï¼‰ -->
            <button class="btn btn-success" id="btn-resources">
                <span>&#x1F4E6;</span>
                <span>èµ„æº</span>
            </button>
            
            <button class="btn btn-purple" id="btn-tech">
                <span>&#x1F52C;</span>
                <span>ç§‘æŠ€</span>
            </button>
            
            <button class="btn btn-warning" id="btn-upgrade">
                <span>&#x2B06;&#xFE0F;</span>
                <span>å‡çº§</span>
            </button>
            
            <button class="btn" id="btn-achievements">
                <span>&#x1F3C6;</span>
                <span>æˆå°±</span>
            </button>
            
            <button class="btn btn-success" id="btn-save">
                <span>&#x1F4BE;</span>
                <span>ä¿å­˜</span>
            </button>
            
            <button class="btn" id="btn-load">
                <span>&#x1F4C2;</span>
                <span>åŠ è½½</span>
            </button>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notification-container"></div>

    <!-- ====== å¼¹çª—ç³»ç»Ÿ ====== -->
    
    <!-- äººç‰©ç®¡ç†å¼¹çª— -->
    <div id="survivors-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x1F465; å¹¸å­˜è€…ç®¡ç†</div>
            <button class="close-btn" onclick="closeModal('survivors-modal')">Ã—</button>
            <div id="survivors-content">
                <div id="survivors-list-container">
                    <div id="survivors-list"></div>
                </div>
                
                <div id="survivor-detail">
                    <div id="survivor-detail-content"></div>
                </div>
                
                <button class="btn btn-success" id="recruit-survivor-btn">
                    <span>&#x2795;</span>
                    <span>æ‹›å‹Ÿæ–°å¹¸å­˜è€…</span>
                </button>
            </div>
        </div>
    </div>

    <!-- èµ„æºç®¡ç†å¼¹çª— -->
    <div id="resources-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x1F4E6; èµ„æºç®¡ç†</div>
            <button class="close-btn" onclick="closeModal('resources-modal')">Ã—</button>
            <div id="resources-list" style="margin-top: 10px;"></div>
        </div>
    </div>

    <!-- ç§‘æŠ€æ ‘å¼¹çª— -->
    <div id="tech-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x1F52C; ç§‘æŠ€æ ‘</div>
            <button class="close-btn" onclick="closeModal('tech-modal')">Ã—</button>
            <div id="tech-list" style="margin-top: 10px;"></div>
        </div>
    </div>

    <!-- åŸºåœ°å‡çº§å¼¹çª— -->
    <div id="upgrade-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x2B06;&#xFE0F; åŸºåœ°å‡çº§</div>
            <button class="close-btn" onclick="closeModal('upgrade-modal')">Ã—</button>
            <div id="upgrade-list" style="margin-top: 10px;"></div>
        </div>
    </div>

    <!-- æˆå°±å¼¹çª— -->
    <div id="achievements-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x1F3C6; æˆå°±ç³»ç»Ÿ</div>
            <button class="close-btn" onclick="closeModal('achievements-modal')">Ã—</button>
            <div id="achievements-list" style="margin-top: 10px;"></div>
        </div>
    </div>

    <!-- æ¢ç´¢å¼¹çª— -->
    <div id="explore-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x1F9ED; æ¢ç´¢åºŸåœŸ</div>
            <button class="close-btn" onclick="closeModal('explore-modal')">Ã—</button>
            <div id="explore-options" style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;"></div>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x2699;&#xFE0F; æ¸¸æˆè®¾ç½®</div>
            <button class="close-btn" onclick="closeModal('settings-modal')">Ã—</button>
            
            <div class="settings-item">
                <span>&#x1F3B5; èƒŒæ™¯éŸ³ä¹</span>
                <div class="music-controls">
                    <label class="switch">
                        <input type="checkbox" id="music-toggle" checked>
                        <span class="slider"></span>
                    </label>
                    <button class="btn btn-small" id="btn-change-music" style="padding: 3px 8px;">
                        åˆ‡æ¢éŸ³ä¹
                    </button>
                </div>
            </div>
            
            <div class="settings-item">
                <span>&#x1F50A; éŸ³ä¹éŸ³é‡</span>
                <input type="range" id="music-volume" min="0" max="100" value="30">
            </div>
            
            <div class="settings-item">
                <span>&#x26A1; æ¸¸æˆé€Ÿåº¦</span>
                <select id="game-speed" style="background: #34495e; color: white; border: 1px solid #555; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                    <option value="1">1x (æ­£å¸¸)</option>
                    <option value="5">5x (å¿«é€Ÿ)</option>
                    <option value="10">10x (æé€Ÿ)</option>
                </select>
            </div>
            
            <div class="settings-item">
                <span>&#x1F504; å±å¹•æ–¹å‘</span>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-small" id="btn-portrait" style="padding: 3px 8px;">&#x1F4F1; ç«–å±</button>
                    <button class="btn btn-small" id="btn-landscape" style="padding: 3px 8px;">&#x1F504; æ¨ªå±</button>
                </div>
            </div>
            
            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                <button class="btn btn-danger" id="btn-exit-game" style="width: 100%; margin-bottom: 8px;">
                    &#x1F6AA; é€€å‡ºæ¸¸æˆ
                </button>
            </div>
            
            <div style="margin-top: 15px; font-size: 10px; color: #8899cc; text-align: center;">
                ã€ŠåºŸåœŸæ–¹èˆŸã€‹åŸºç¡€ç‰ˆ v1.0<br>
                ç”Ÿå­˜å¤©æ•°: <span id="settings-game-day">1</span>
            </div>
        </div>
    </div>

    <!-- æˆ˜æ–—å¼¹çª— -->
    <div id="combat-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">&#x2694;&#xFE0F; ä¸§å°¸æ¥è¢­ï¼</div>
            <button class="close-btn" onclick="closeModal('combat-modal')">Ã—</button>
            <div id="enemy-info"></div>
            <div class="combat-log" id="combat-log"></div>
            <div class="combat-actions">
                <button class="btn btn-success" id="btn-attack">&#x1F5E1;&#xFE0F; æ”»å‡»</button>
                <button class="btn" id="btn-defend">&#x1F6E1;&#xFE0F; é˜²å¾¡</button>
                <button class="btn btn-danger" id="btn-flee">&#x1F3C3; æ’¤é€€</button>
            </div>
        </div>
    </div>

    <script>
        // ====== æ¸¸æˆæ ¸å¿ƒç±» ======
        class SurvivalGame {
            constructor() {
                // æ¸¸æˆçŠ¶æ€ - æ—¶é—´æ”¹ä¸ºæ—©ä¸Š7ç‚¹
                this.gameState = {
                    day: 1,
                    hour: 7,
                    minute: 0,
                    second: 0,
                    weather: 'clear',
                    paused: false,
                    threat: 1,
                    tech: new Set(),
                    explored: new Set(),
                    achievements: new Set(),
                    settings: {
                        music: false,
                        speed: 1, // é»˜è®¤æ­£å¸¸é€Ÿåº¦
                        orientation: 'portrait',
                        volume: 0.3
                    }
                };
                
                // ä¿®å¤ï¼šæ·»åŠ æ¢ç´¢ç›¸å…³å˜é‡
                this.isExploring = false;
                this.currentExplore = null;
                this.exploreTimer = null;
                this.exploreCountdown = null;
                
                // èµ„æºç³»ç»Ÿ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                this.resources = {
                    'é£Ÿç‰©': { amount: 100, max: 500, prod: 5, cons: 8, icon: '\uD83C\uDF4E' }, // ğŸ
                    'æ°´': { amount: 80, max: 300, prod: 3, cons: 6, icon: '\uD83D\uDCA7' }, // ğŸ’§
                    'ææ–™': { amount: 50, max: 1000, prod: 2, cons: 1, icon: '\uD83D\uDD28' }, // ğŸ”¨
                    'è¯å“': { amount: 20, max: 200, prod: 0.5, cons: 0.2, icon: '\uD83D\uDC8A' }, // ğŸ’Š
                    'å¼¹è¯': { amount: 50, max: 500, prod: 1, cons: 0, icon: '\uD83D\uDD2B' } // ğŸ”«
                };
                
                // å¹¸å­˜è€…ç³»ç»Ÿ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                this.survivorNames = ['å¼ ä¼Ÿ', 'æå¨œ', 'ç‹åˆš', 'èµµæ•', 'åˆ˜å¼º', 'é™ˆé™', 'å­™æµ©', 'å‘¨å©·'];
                this.survivorIcons = [
                    '\uD83D\uDC68\u200D\uD83D\uDE80', // ğŸ‘¨â€ğŸš€
                    '\uD83D\uDC69\u200D\uD83D\uDD2C', // ğŸ‘©â€ğŸ”¬
                    '\uD83D\uDC68\u200D\uD83D\uDD27', // ğŸ‘¨â€ğŸ”§
                    '\uD83D\uDC69\u200D\u2695\uFE0F', // ğŸ‘©â€âš•ï¸
                    '\uD83D\uDC68\u200D\uD83C\uDF3E', // ğŸ‘¨â€ğŸŒ¾
                    '\uD83D\uDC69\u200D\uD83D\uDE92', // ğŸ‘©â€ğŸš’
                    '\uD83D\uDC68\u200D\uD83C\uDF93', // ğŸ‘¨â€ğŸ“
                    '\uD83D\uDC69\u200D\uD83C\uDFA8'  // ğŸ‘©â€ğŸ¨
                ];
                
                this.survivorSkills = {
                    'å»ºé€ ': { icon: '\uD83D\uDD28', color: '#e67e22', effect: 'å»ºç­‘é€Ÿåº¦+20%' }, // ğŸ”¨
                    'åŒ»ç–—': { icon: '\uD83D\uDC8A', color: '#e74c3c', effect: 'æ²»ç–—æ•ˆç‡+30%' }, // ğŸ’Š
                    'æˆ˜æ–—': { icon: '\u2694\uFE0F', color: '#c0392b', effect: 'æ”»å‡»åŠ›+25%' }, // âš”ï¸
                    'æ¢ç´¢': { icon: '\uD83E\uDDED', color: '#3498db', effect: 'æ¢ç´¢æˆåŠŸç‡+15%' }, // ğŸ§­
                    'ç ”ç©¶': { icon: '\uD83D\uDD2C', color: '#9b59b6', effect: 'ç§‘ç ”é€Ÿåº¦+20%' }, // ğŸ”¬
                    'å†œä¸š': { icon: '\uD83C\uDF31', color: '#27ae60', effect: 'é£Ÿç‰©äº§é‡+25%' } // ğŸŒ±
                };
                
                // åˆå§‹å¹¸å­˜è€…
                this.survivors = [
                    this.createRandomSurvivor(1),
                    this.createRandomSurvivor(2),
                    this.createRandomSurvivor(3)
                ];
                
                this.selectedSurvivor = this.survivors[0];
                
                // å»ºç­‘
                this.buildings = [
                    { id: 1, type: 'æŒ‡æŒ¥ä¸­å¿ƒ', level: 1, x: 150, y: 100 },
                    { id: 2, type: 'å®¿èˆ', level: 1, x: 100, y: 160 },
                    { id: 3, type: 'å¨æˆ¿', level: 1, x: 200, y: 160 }
                ];
                
                // äº‹ä»¶æ—¥å¿—
                this.events = [
                    { time: '07:00:00', message: 'æ–°çš„ä¸€å¤©å¼€å§‹äº†', type: 'info' }
                ];
                
                // ç§‘æŠ€æ ‘ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                this.techTree = [
                    { id: 'basic_farming', name: 'åŸºç¡€å†œä¸š', cost: 50, desc: 'é£Ÿç‰©äº§é‡+20%', time: 24, icon: '\uD83C\uDF31', require: [] }, // ğŸŒ±
                    { id: 'water_purify', name: 'å‡€æ°´æŠ€æœ¯', cost: 40, desc: 'æ°´æ¶ˆè€—-30%', time: 18, icon: '\uD83D\uDCA7', require: [] }, // ğŸ’§
                    { id: 'advanced_defense', name: 'é«˜çº§é˜²å¾¡', cost: 60, desc: 'é˜²å¾¡åŠ›+50%', time: 36, icon: '\uD83D\uDEE1\uFE0F', require: [] }, // ğŸ›¡ï¸
                    { id: 'solar_power', name: 'å¤ªé˜³èƒ½æŠ€æœ¯', cost: 70, desc: 'ææ–™+10/å°æ—¶', time: 48, icon: '\u2600\uFE0F', require: ['advanced_defense'] } // â˜€ï¸
                ];
                
                // æˆå°±ç³»ç»Ÿ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                this.achievementList = [
                    { id: 'first_light', name: 'ç¬¬ä¸€é“å…‰', desc: 'å»ºé€ ç¬¬ä¸€ä¸ªå»ºç­‘', icon: '\uD83C\uDFD7\uFE0F', condition: () => this.buildings.length >= 4 }, // ğŸ—ï¸
                    { id: 'dawn_breaker', name: 'ç ´æ™“ä¹‹äºº', desc: 'ç”Ÿå­˜è¶…è¿‡7å¤©', icon: '\uD83C\uDF05', condition: () => this.gameState.day >= 7 }, // ğŸŒ…
                    { id: 'ark_heart', name: 'æ–¹èˆŸä¹‹å¿ƒ', desc: 'æ”¶å®¹5åå¹¸å­˜è€…', icon: '\u2764\uFE0F', condition: () => this.survivors.length >= 5 }, // â¤ï¸
                    { id: 'explorer', name: 'æ¢ç´¢è€…', desc: 'æ¢ç´¢æ‰€æœ‰åœ°ç‚¹', icon: '\uD83E\uDDED', condition: () => this.gameState.explored.size >= 4 }, // ğŸ§­
                    { id: 'zombie_slayer', name: 'ä¸§å°¸æ€æ‰‹', desc: 'å‡»è´¥10ä¸ªæ•Œäºº', icon: '\uD83E\uDDDF', condition: () => this.survivors.reduce((sum, s) => sum + (s.kills || 0), 0) >= 10 } // ğŸ§Ÿ
                ];
                
                // æ¢ç´¢åœ°ç‚¹ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                this.exploreLocations = [
                    { name: 'åºŸå¢Ÿ', risk: 0.2, icon: '\uD83C\uDFDA', rewards: { 'ææ–™': 30, 'è¯å“': 10 } }, // ğŸšï¸
                    { name: 'åŒ»é™¢', risk: 0.4, icon: '\uD83C\uDFE5', rewards: { 'è¯å“': 40, 'ææ–™': 15 } }, // ğŸ¥
                    { name: 'è¶…å¸‚', risk: 0.3, icon: '\uD83D\uDED2', rewards: { 'é£Ÿç‰©': 50, 'æ°´': 30 } }, // ğŸ›’
                    { name: 'å†›äº‹åŸºåœ°', risk: 0.6, icon: '\uD83C\uDF96\uFE0F', rewards: { 'å¼¹è¯': 80, 'ææ–™': 40 } } // ğŸ–ï¸
                ];
                
                // å»ºç­‘å‡çº§é€‰é¡¹
                this.buildingUpgrades = [
                    { name: 'å¼ºåŒ–å¢™å£', cost: 100, desc: 'åŸºåœ°é˜²å¾¡+20%', effect: () => this.gameState.threat = Math.max(1, this.gameState.threat - 1) },
                    { name: 'æ‰©å¤§ä»“åº“', cost: 150, desc: 'æ‰€æœ‰èµ„æºä¸Šé™+50', effect: () => Object.values(this.resources).forEach(r => r.max += 50) },
                    { name: 'æ”¹å–„ä¾›æ°´', cost: 120, desc: 'æ°´äº§é‡+5/å°æ—¶', effect: () => this.resources['æ°´'].prod += 5 },
                    { name: 'è‡ªåŠ¨é˜²å¾¡', cost: 200, desc: 'è‡ªåŠ¨å‡»é€€å°‘é‡ä¸§å°¸', effect: () => this.addEvent('è‡ªåŠ¨é˜²å¾¡ç³»ç»Ÿå·²å¯ç”¨', 'success') }
                ];
                
                // æ•Œäººç³»ç»Ÿ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                this.enemies = [];
                this.combatActive = false;
                this.currentEnemy = null;
                
                // éŸ³é¢‘ç³»ç»Ÿ
                this.audio = {
                    bgMusic: null,
                    bgMusicVolume: 0.3,
                    currentTrack: 0,
                    musicEnabled: false
                };
                
                // æ¸¸æˆå¾ªç¯å¼•ç”¨ï¼ˆç”¨äºæ¸…ç†ï¼‰
                this.gameLoopInterval = null;
                
                // åˆå§‹åŒ–
                this.init();
            }
            
            createRandomSurvivor(id) {
                const name = this.survivorNames[Math.floor(Math.random() * this.survivorNames.length)];
                const icon = this.survivorIcons[Math.floor(Math.random() * this.survivorIcons.length)];
                const skillKeys = Object.keys(this.survivorSkills);
                const skill = skillKeys[Math.floor(Math.random() * skillKeys.length)];
                const skillData = this.survivorSkills[skill];
                
                return {
                    id: id,
                    name: name,
                    icon: icon,
                    level: 1,
                    experience: Math.floor(Math.random() * 20),
                    skill: skill,
                    skillIcon: skillData.icon,
                    skillColor: skillData.color,
                    health: 70 + Math.floor(Math.random() * 30),
                    hunger: 40 + Math.floor(Math.random() * 40),
                    energy: 60 + Math.floor(Math.random() * 40),
                    morale: 50 + Math.floor(Math.random() * 40),
                    status: 'ç©ºé—²',
                    assigned: false,
                    daysSurvived: Math.floor(Math.random() * 5),
                    kills: Math.floor(Math.random() * 3),
                    description: name + 'æ˜¯ä¸€å' + skill + 'ä¸“å®¶ï¼Œèƒ½åœ¨åºŸåœŸä¸­ç”Ÿå­˜ä¸‹æ¥å·²ç»å¾ˆä¸å®¹æ˜“äº†ã€‚'
                };
            }
            
            init() {
                this.initCanvas();
                this.setupUI();
                this.initAudio();
                this.startGameLoop();
                this.loadGame();
                
                setTimeout(() => {
                    document.getElementById('loading-screen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                        document.getElementById('game-container').style.display = 'flex';
                        this.showNotification('åºŸåœŸæ–¹èˆŸå·²å¯åŠ¨', 'success');
                    }, 500);
                }, 1500);
            }
            
            initCanvas() {
                this.canvas = document.getElementById('base-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                this.drawBase();
                window.addEventListener('resize', () => this.resizeCanvas());
            }
            
            resizeCanvas() {
                const container = document.getElementById('map-container');
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
                this.drawBase();
            }
            
            initAudio() {
                try {
                    this.audio.bgMusic = new Audio();
                    this.audio.bgMusic.volume = this.audio.bgMusicVolume;
                    this.audio.bgMusic.muted = true;
                    this.audio.bgMusic.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ';
                } catch (e) {
                    console.log('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', e.message);
                }
            }
            
            setupUI() {
                this.updateUI();
                this.bindEvents();
                this.generateExploreOptions();
                this.updateSurvivorsList();
                this.updateSurvivorDetail();
            }
            
            bindEvents() {
                // çŠ¶æ€æ æŒ‰é’®
                document.getElementById('btn-explore').addEventListener('click', () => {
                    this.showExploreModal();
                });
                
                // æ–°å¢æš‚åœæŒ‰é’®
                document.getElementById('btn-pause').addEventListener('click', () => {
                    this.togglePause();
                });
                
                document.getElementById('btn-settings').addEventListener('click', () => {
                    this.showSettings();
                });
                
                // æ§åˆ¶é¢æ¿æŒ‰é’®
                document.getElementById('btn-survivors').addEventListener('click', () => {
                    this.showSurvivorsModal();
                });
                
                document.getElementById('btn-resources').addEventListener('click', () => {
                    this.showResourcesModal();
                });
                
                document.getElementById('btn-tech').addEventListener('click', () => {
                    this.showTechModal();
                });
                
                document.getElementById('btn-upgrade').addEventListener('click', () => {
                    this.showUpgradeModal();
                });
                
                document.getElementById('btn-achievements').addEventListener('click', () => {
                    this.showAchievementsModal();
                });
                
                document.getElementById('btn-save').addEventListener('click', () => {
                    this.saveGame();
                });
                
                document.getElementById('btn-load').addEventListener('click', () => {
                    this.loadGame();
                });
                
                // æ‹›å‹Ÿå¹¸å­˜è€…æŒ‰é’®
                document.getElementById('recruit-survivor-btn').addEventListener('click', () => {
                    this.recruitSurvivor();
                });
                
                // è®¾ç½®é¢æ¿
                document.getElementById('music-toggle').addEventListener('change', (e) => {
                    this.gameState.settings.music = e.target.checked;
                    this.audio.musicEnabled = e.target.checked;
                    this.saveSettings();
                });
                
                document.getElementById('music-volume').addEventListener('input', (e) => {
                    const volume = e.target.value / 100;
                    this.audio.bgMusicVolume = volume;
                    this.gameState.settings.volume = volume;
                    if (this.audio.bgMusic) {
                        this.audio.bgMusic.volume = volume;
                    }
                    this.saveSettings();
                });
                
                // æ¸¸æˆé€Ÿåº¦è®¾ç½®
                document.getElementById('game-speed').addEventListener('change', (e) => {
                    const newSpeed = parseFloat(e.target.value);
                    this.gameState.settings.speed = newSpeed;
                    this.saveSettings();
                    
                    // é‡æ–°å¯åŠ¨æ¸¸æˆå¾ªç¯
                    if (this.gameLoopInterval) {
                        clearInterval(this.gameLoopInterval);
                    }
                    if (!this.gameState.paused) {
                        this.startGameLoop();
                    }
                    
                    let speedText = '';
                    if (newSpeed === 1) speedText = 'æ­£å¸¸é€Ÿåº¦ (æ¢ç´¢5ç§’)';
                    else if (newSpeed === 5) speedText = 'å¿«é€Ÿ (æ¢ç´¢10ç§’)';
                    else if (newSpeed === 10) speedText = 'æé€Ÿ (æ¢ç´¢20ç§’)';
                    
                    this.showNotification('æ¸¸æˆé€Ÿåº¦å·²è®¾ä¸º: ' + speedText, 'info');
                });
                
                document.getElementById('btn-portrait').addEventListener('click', () => {
                    this.setOrientation('portrait');
                });
                
                document.getElementById('btn-landscape').addEventListener('click', () => {
                    this.setOrientation('landscape');
                });
                
                document.getElementById('btn-exit-game').addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦é€€å‡ºæ¸¸æˆå—ï¼Ÿ')) {
                        this.saveGame();
                        alert('æ¸¸æˆå·²ä¿å­˜ï¼Œå¯ä»¥å®‰å…¨å…³é—­é¡µé¢');
                    }
                });
                
                // æˆ˜æ–—æŒ‰é’®
                document.getElementById('btn-attack').addEventListener('click', () => this.combatAction('attack'));
                document.getElementById('btn-defend').addEventListener('click', () => this.combatAction('defend'));
                document.getElementById('btn-flee').addEventListener('click', () => this.combatAction('flee'));
                
                // åœ°å›¾ç‚¹å‡»
                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    this.buildings.forEach(building => {
                        const scale = this.canvas.width / 400;
                        const bX = building.x * scale;
                        const bY = building.y * scale;
                        const size = 40 * scale;
                        
                        if (x >= bX && x <= bX + size && y >= bY && y <= bY + size) {
                            this.showBuildingInfo(building);
                        }
                    });
                });
                
                // PWAå®‰è£…æç¤º
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    document.getElementById('install-prompt').style.display = 'block';
                });
                
                document.getElementById('install-btn').addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        if (outcome === 'accepted') {
                            document.getElementById('install-prompt').style.display = 'none';
                        }
                    }
                });
            }
            
            // ====== æ–°å¢æš‚åœåŠŸèƒ½ ======
            togglePause() {
                this.gameState.paused = !this.gameState.paused;
                const btn = document.getElementById('btn-pause');
                
                if (this.gameState.paused) {
                    clearInterval(this.gameLoopInterval);
                    btn.innerHTML = '<span>&#x25B6;&#xFE0F;</span><span>ç»§ç»­</span>';
                    btn.className = 'btn btn-small btn-resume';
                    this.showNotification('æ¸¸æˆå·²æš‚åœ', 'warning');
                } else {
                    this.startGameLoop();
                    btn.innerHTML = '<span>&#x23F8;&#xFE0F;</span><span>æš‚åœ</span>';
                    btn.className = 'btn btn-small btn-pause';
                    this.showNotification('æ¸¸æˆç»§ç»­', 'success');
                }
            }
            
            // ====== ä¿®å¤æ¢ç´¢åŠŸèƒ½ ======
            showExploreModal() {
                // å¦‚æœæ­£åœ¨æ¢ç´¢ï¼Œæç¤ºç”¨æˆ·
                if (this.isExploring) {
                    this.showNotification('æ­£åœ¨æ¢ç´¢' + this.currentExplore + 'ä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ', 'warning');
                    return;
                }
                
                this.generateExploreOptions();
                document.getElementById('explore-modal').style.display = 'flex';
            }
            
            generateExploreOptions() {
                const container = document.getElementById('explore-options');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.exploreLocations.forEach(location => {
                    const button = document.createElement('button');
                    button.className = 'btn';
                    button.style.flexDirection = 'column';
                    button.style.height = 'auto';
                    button.style.padding = '10px 5px';
                    button.innerHTML = `
                        <span style="font-size: 24px;">${location.icon}</span>
                        <span style="font-size: 13px; margin-top: 5px;">${location.name}</span>
                        <span style="font-size: 11px; color: ${location.risk < 0.3 ? '#2ecc71' : location.risk < 0.5 ? '#f39c12' : '#e74c3c'}">
                            ${location.risk < 0.3 ? 'ä½é£é™©' : location.risk < 0.5 ? 'ä¸­é£é™©' : 'é«˜é£é™©'}
                        </span>
                    `;
                    
                    button.addEventListener('click', () => {
                        this.startExplore(location);
                        closeModal('explore-modal');
                    });
                    
                    container.appendChild(button);
                });
            }
            
            startExplore(location) {
                // æ£€æŸ¥èµ„æºæ˜¯å¦è¶³å¤Ÿ
                if (this.resources['é£Ÿç‰©'].amount < 10 || this.resources['æ°´'].amount < 5) {
                    this.showNotification('èµ„æºä¸è¶³ï¼Œæ— æ³•æ¢ç´¢', 'danger');
                    return;
                }
                
                // æ‰£é™¤èµ„æº
                this.resources['é£Ÿç‰©'].amount -= 10;
                this.resources['æ°´'].amount -= 5;
                
                // è®¾ç½®æ¢ç´¢çŠ¶æ€
                this.isExploring = true;
                this.currentExplore = location.name;
                
                // æ˜¾ç¤ºå¼€å§‹æ¶ˆæ¯
                this.showNotification('å¼€å§‹æ¢ç´¢' + location.name + '...', 'info');
                
                // æ˜¾ç¤ºæ¢ç´¢è®¡æ—¶å™¨
                this.showExploreTimer(location);
                
                // è®¡ç®—æ¢ç´¢æ—¶é—´
                let exploreSeconds;
                if (this.gameState.settings.speed === 1) {
                    exploreSeconds = 5; // æ­£å¸¸é€Ÿåº¦ï¼š5ç§’
                } else if (this.gameState.settings.speed === 5) {
                    exploreSeconds = 10; // å¿«é€Ÿï¼š10ç§’
                } else if (this.gameState.settings.speed === 10) {
                    exploreSeconds = 20; // æé€Ÿï¼š20ç§’
                } else {
                    exploreSeconds = 5 * this.gameState.settings.speed; // è‡ªé€‚åº”
                }
                
                // å¼€å§‹å€’è®¡æ—¶
                let timeLeft = exploreSeconds;
                this.updateExploreTimer(timeLeft);
                
                // æ¯ç§’æ›´æ–°è®¡æ—¶å™¨
                this.exploreCountdown = setInterval(() => {
                    timeLeft--;
                    this.updateExploreTimer(timeLeft);
                    
                    if (timeLeft <= 0) {
                        clearInterval(this.exploreCountdown);
                        this.finishExplore(location);
                    }
                }, 1000);
                
                // è®¾ç½®æ¢ç´¢å®Œæˆè¶…æ—¶
                this.exploreTimer = setTimeout(() => {
                    if (this.exploreCountdown) {
                        clearInterval(this.exploreCountdown);
                    }
                    this.finishExplore(location);
                }, exploreSeconds * 1000);
            }
            
            showExploreTimer(location) {
                // ç§»é™¤æ—§çš„è®¡æ—¶å™¨
                const oldTimer = document.getElementById('explore-timer');
                if (oldTimer) oldTimer.remove();
                
                // åˆ›å»ºæ–°è®¡æ—¶å™¨
                const timer = document.createElement('div');
                timer.id = 'explore-timer';
                timer.innerHTML = `
                    <div>&#x1F9ED; æ¢ç´¢: ${location.name}</div>
                    <div>å‰©ä½™æ—¶é—´: <span class="time">${this.getExploreTimeSeconds()}s</span></div>
                `;
                timer.style.display = 'block';
                document.body.appendChild(timer);
            }
            
            updateExploreTimer(timeLeft) {
                const timer = document.getElementById('explore-timer');
                if (timer) {
                    const timeElement = timer.querySelector('.time');
                    if (timeElement) {
                        timeElement.textContent = timeLeft + 's';
                    }
                }
            }
            
            getExploreTimeSeconds() {
                if (this.gameState.settings.speed === 1) return 5;
                if (this.gameState.settings.speed === 5) return 10;
                if (this.gameState.settings.speed === 10) return 20;
                return 5 * this.gameState.settings.speed;
            }
            
            finishExplore(location) {
                // æ¸…é™¤è®¡æ—¶å™¨
                if (this.exploreCountdown) {
                    clearInterval(this.exploreCountdown);
                    this.exploreCountdown = null;
                }
                
                if (this.exploreTimer) {
                    clearTimeout(this.exploreTimer);
                    this.exploreTimer = null;
                }
                
                // ç§»é™¤è®¡æ—¶å™¨æ˜¾ç¤º
                const timer = document.getElementById('explore-timer');
                if (timer) timer.remove();
                
                // é‡ç½®çŠ¶æ€
                this.isExploring = false;
                this.currentExplore = null;
                
                // è®¡ç®—æ¢ç´¢ç»“æœ
                const success = Math.random() > location.risk;
                
                if (success) {
                    // æ¢ç´¢æˆåŠŸ
                    let message = 'æ¢ç´¢' + location.name + 'æˆåŠŸï¼è·å¾—ï¼š';
                    for (const [resource, amount] of Object.entries(location.rewards)) {
                        if (this.resources[resource]) {
                            this.resources[resource].amount = Math.min(
                                this.resources[resource].max,
                                this.resources[resource].amount + amount
                            );
                            message += ' ' + amount + resource;
                        }
                    }
                    
                    // ä¸ºæ‰€æœ‰å¹¸å­˜è€…å¢åŠ ç»éªŒå€¼
                    this.survivors.forEach(survivor => {
                        survivor.experience += 15; // æ¢ç´¢æˆåŠŸè·å¾—ç»éªŒå€¼
                        this.checkLevelUp(survivor);
                    });
                    
                    this.addEvent(message, 'success');
                    this.showNotification('æ¢ç´¢æˆåŠŸï¼', 'success');
                } else {
                    // æ¢ç´¢å¤±è´¥
                    this.resources['ææ–™'].amount = Math.max(0, this.resources['ææ–™'].amount - 10);
                    
                    // æ¢ç´¢å¤±è´¥ä¹Ÿæœ‰å°‘é‡ç»éªŒå€¼
                    this.survivors.forEach(survivor => {
                        survivor.experience += 5; // æ¢ç´¢å¤±è´¥è·å¾—å°‘é‡ç»éªŒå€¼
                        this.checkLevelUp(survivor);
                    });
                    
                    this.addEvent('æ¢ç´¢' + location.name + 'å¤±è´¥ï¼æŸå¤±äº†éƒ¨åˆ†èµ„æº', 'danger');
                    this.showNotification('æ¢ç´¢å¤±è´¥ï¼', 'danger');
                }
                
                // è®°å½•æ¢ç´¢
                this.gameState.explored.add(location.name);
                
                // è§£é”æˆå°±
                if (this.gameState.explored.size >= 4) {
                    this.unlockAchievement('explorer');
                }
            }
            
            // ====== ä¿®å¤äººç‰©è¯¦æƒ…æ˜¾ç¤ºé—®é¢˜ ======
            updateSurvivorsList() {
                const container = document.getElementById('survivors-list');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.survivors.forEach(survivor => {
                    const isSelected = survivor.id === this.selectedSurvivor?.id;
                    
                    const item = document.createElement('div');
                    item.className = 'survivor-item ' + (isSelected ? 'selected' : '');
                    item.dataset.id = survivor.id;
                    
                    // çŠ¶æ€æŒ‡ç¤ºå™¨
                    let statusClass = 'status-idle';
                    let statusText = 'ç©ºé—²';
                    if (survivor.health < 50) {
                        statusClass = 'status-injured';
                        statusText = 'å—ä¼¤';
                    } else if (survivor.energy < 30) {
                        statusClass = 'status-tired';
                        statusText = 'ç–²åŠ³';
                    } else if (survivor.assigned) {
                        statusClass = 'status-working';
                        statusText = 'å·¥ä½œä¸­';
                    }
                    
                    item.innerHTML = `
                        <div class="survivor-header">
                            <div class="survivor-icon">${survivor.icon}</div>
                            <div style="flex: 1;">
                                <div class="survivor-name">${survivor.name}</div>
                                <div class="survivor-skill" style="color: ${survivor.skillColor}">
                                    ${survivor.skillIcon} ${survivor.skill}
                                </div>
                            </div>
                            <div style="font-size: 10px; color: #8899cc;">
                                <span class="status-indicator ${statusClass}"></span>${statusText}
                            </div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill health-bar" style="width: ${Math.min(100, Math.max(0, survivor.health))}%"></div>
                        </div>
                        <div class="stat-label">
                            <span>&#x2764;&#xFE0F; å¥åº·</span>
                            <span>${Math.round(Math.min(100, Math.max(0, survivor.health)))}%</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill hunger-bar" style="width: ${Math.min(100, Math.max(0, survivor.hunger))}%"></div>
                        </div>
                        <div class="stat-label">
                            <span>&#x1F356; é¥¥é¥¿</span>
                            <span>${Math.round(Math.min(100, Math.max(0, survivor.hunger)))}%</span>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.selectedSurvivor = survivor;
                        this.updateSurvivorsList();
                        this.updateSurvivorDetail();
                    });
                    
                    container.appendChild(item);
                });
            }
            
            updateSurvivorDetail() {
                const container = document.getElementById('survivor-detail-content');
                if (!container) return;
                
                if (!this.selectedSurvivor) {
                    container.innerHTML = '<div style="color: #8899cc; text-align: center; padding: 20px;">è¯·é€‰æ‹©ä¸€ä¸ªå¹¸å­˜è€…</div>';
                    return;
                }
                
                const s = this.selectedSurvivor;
                const skillData = this.survivorSkills[s.skill];
                
                // ç¡®ä¿æ•°å€¼åœ¨æœ‰æ•ˆèŒƒå›´å†…
                const health = Math.min(100, Math.max(0, s.health));
                const hunger = Math.min(100, Math.max(0, s.hunger));
                const energy = Math.min(100, Math.max(0, s.energy));
                const morale = Math.min(100, Math.max(0, s.morale));
                const daysSurvived = s.daysSurvived || 0;
                const kills = s.kills || 0;
                const experience = s.experience || 0;
                
                // çŠ¶æ€æè¿°
                let statusDesc = 'çŠ¶æ€è‰¯å¥½';
                if (health < 30) statusDesc = 'é‡ä¼¤éœ€è¦æ²»ç–—';
                else if (health < 60) statusDesc = 'è½»ä¼¤';
                else if (hunger > 80) statusDesc = 'éå¸¸é¥¥é¥¿';
                else if (hunger > 60) statusDesc = 'é¥¥é¥¿';
                else if (energy < 30) statusDesc = 'ç²¾ç–²åŠ›å°½';
                else if (energy < 60) statusDesc = 'ç–²åŠ³';
                else if (morale < 30) statusDesc = 'å£«æ°”ä½è½';
                else if (morale < 60) statusDesc = 'å£«æ°”ä¸€èˆ¬';
                
                container.innerHTML = `
                    <div class="detail-header">
                        <div class="detail-icon">${s.icon}</div>
                        <div class="detail-info">
                            <h3>${s.name}</h3>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="background: ${s.skillColor}; color: white; padding: 3px 10px; border-radius: 12px; font-size: 12px;">
                                    ${s.skillIcon} ${s.skill}
                                </div>
                                <div style="font-size: 12px; color: #f39c12;">ç­‰çº§ ${s.level || 1}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 8px; margin: 15px 0; font-size: 13px;">
                        <span style="color: #3498db;">&#x1F4DD; çŠ¶æ€:</span> ${statusDesc}
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 8px; margin: 15px 0; font-size: 12px; color: #aabbee;">
                        ${s.description || s.name + 'æ˜¯ä¸€å' + s.skill + 'ä¸“å®¶ï¼Œèƒ½åœ¨åºŸåœŸä¸­ç”Ÿå­˜ä¸‹æ¥å·²ç»å¾ˆä¸å®¹æ˜“äº†ã€‚'}
                    </div>
                    
                    <div class="detail-stats">
                        <div class="stat-item">
                            <div class="stat-title">&#x2764;&#xFE0F; å¥åº·</div>
                            <div class="stat-value" style="color: #e74c3c;">${Math.round(health)}%</div>
                            <div class="stat-bar" style="margin-top: 5px;">
                                <div class="stat-fill health-bar" style="width: ${health}%"></div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-title">&#x1F356; é¥¥é¥¿</div>
                            <div class="stat-value" style="color: #f39c12;">${Math.round(hunger)}%</div>
                            <div class="stat-bar" style="margin-top: 5px;">
                                <div class="stat-fill hunger-bar" style="width: ${hunger}%"></div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-title">&#x26A1; ç²¾åŠ›</div>
                            <div class="stat-value" style="color: #3498db;">${Math.round(energy)}%</div>
                            <div class="stat-bar" style="margin-top: 5px;">
                                <div class="stat-fill energy-bar" style="width: ${energy}%"></div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-title">&#x1F60A; å£«æ°”</div>
                            <div class="stat-value" style="color: #9b59b6;">${Math.round(morale)}%</div>
                            <div class="stat-bar" style="margin-top: 5px;">
                                <div class="stat-fill" style="width: ${morale}%; background: linear-gradient(90deg, #9b59b6, #e74c3c);"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div style="font-size: 13px; color: #3498db; margin-bottom: 5px;">ä¸“ä¸šæŠ€èƒ½æ•ˆæœ</div>
                        <div style="font-size: 12px;">${skillData.effect}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px;">
                        <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 20px;">${daysSurvived}</div>
                            <div style="font-size: 10px; color: #8899cc;">ç”Ÿå­˜å¤©æ•°</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 20px;">${kills}</div>
                            <div style="font-size: 10px; color: #8899cc;">å‡»æ€æ•°</div>
                        </div>
                        <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 20px;">${experience}</div>
                            <div style="font-size: 10px; color: #8899cc;">ç»éªŒå€¼</div>
                        </div>
                    </div>
                    
                    <div class="survivor-actions">
                        <button class="btn btn-small" style="flex: 1;" onclick="game.assignSurvivor(${s.id})">
                            ${s.assigned ? 'å–æ¶ˆåˆ†é…' : 'åˆ†é…å·¥ä½œ'}
                        </button>
                        <button class="btn btn-small btn-success" style="flex: 1;" onclick="game.healSurvivor(${s.id})">
                            æ²»ç–—
                        </button>
                        <button class="btn btn-small btn-warning" style="flex: 1;" onclick="game.feedSurvivor(${s.id})">
                            å–‚é£Ÿ
                        </button>
                    </div>
                `;
            }
            
            updateResourcesList() {
                const container = document.getElementById('resources-list');
                if (!container) return;
                
                container.innerHTML = '';
                
                for (const [name, data] of Object.entries(this.resources)) {
                    const percent = (data.amount / data.max) * 100;
                    const color = percent > 50 ? '#2ecc71' : percent > 20 ? '#f39c12' : '#e74c3c';
                    
                    const item = document.createElement('div');
                    item.className = 'resource-item';
                    item.innerHTML = `
                        <div class="resource-icon">${data.icon}</div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between;">
                                <div style="font-size: 14px;">${name}</div>
                                <div style="font-size: 12px;">${Math.floor(data.amount)}/${data.max}</div>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill" style="width: ${percent}%; background: ${color};"></div>
                            </div>
                            <div style="font-size: 11px; color: #aaa; display: flex; justify-content: space-between;">
                                <span>${percent.toFixed(1)}%</span>
                                <span style="color: ${data.prod > data.cons ? '#2ecc71' : '#e74c3c'};">
                                    ${data.prod > data.cons ? '+' : ''}${(data.prod - data.cons).toFixed(1)}/h
                                </span>
                            </div>
                        </div>
                    `;
                    container.appendChild(item);
                }
            }
            
            assignSurvivor(survivorId) {
                const survivor = this.survivors.find(s => s.id === survivorId);
                if (survivor) {
                    survivor.assigned = !survivor.assigned;
                    survivor.status = survivor.assigned ? 'å·¥ä½œä¸­' : 'ç©ºé—²';
                    
                    // åˆ†é…å·¥ä½œè·å¾—ç»éªŒå€¼
                    if (survivor.assigned) {
                        survivor.experience += 5;
                        this.checkLevelUp(survivor);
                    }
                    
                    this.updateSurvivorsList();
                    this.updateSurvivorDetail();
                    this.addEvent(survivor.name + ' ' + (survivor.assigned ? 'å¼€å§‹å·¥ä½œ' : 'åœæ­¢å·¥ä½œ'), 'info');
                }
            }
            
            healSurvivor(survivorId) {
                const survivor = this.survivors.find(s => s.id === survivorId);
                if (survivor && this.resources['è¯å“'].amount >= 5) {
                    this.resources['è¯å“'].amount -= 5;
                    survivor.health = Math.min(100, survivor.health + 30);
                    
                    // æ²»ç–—è·å¾—ç»éªŒå€¼
                    survivor.experience += 3;
                    this.checkLevelUp(survivor);
                    
                    this.updateSurvivorsList();
                    this.updateSurvivorDetail();
                    this.addEvent(survivor.name + 'æ¥å—äº†æ²»ç–—ï¼Œæ¢å¤å¥åº·', 'success');
                } else {
                    this.showNotification('è¯å“ä¸è¶³ï¼', 'danger');
                }
            }
            
            feedSurvivor(survivorId) {
                const survivor = this.survivors.find(s => s.id === survivorId);
                if (survivor && this.resources['é£Ÿç‰©'].amount >= 3 && this.resources['æ°´'].amount >= 2) {
                    this.resources['é£Ÿç‰©'].amount -= 3;
                    this.resources['æ°´'].amount -= 2;
                    survivor.hunger = Math.max(0, survivor.hunger - 30);
                    survivor.energy = Math.min(100, survivor.energy + 20);
                    survivor.morale = Math.min(100, survivor.morale + 10);
                    
                    // å–‚é£Ÿè·å¾—ç»éªŒå€¼
                    survivor.experience += 2;
                    this.checkLevelUp(survivor);
                    
                    this.updateSurvivorsList();
                    this.updateSurvivorDetail();
                    this.addEvent(survivor.name + 'åƒé¥±å–è¶³ï¼Œç²¾ç¥ç„•å‘', 'success');
                } else {
                    this.showNotification('é£Ÿç‰©æˆ–æ°´ä¸è¶³ï¼', 'danger');
                }
            }
            
            // æ£€æŸ¥å‡çº§
            checkLevelUp(survivor) {
                if (survivor.experience >= 100) {
                    survivor.level = (survivor.level || 1) + 1;
                    survivor.experience = 0;
                    survivor.health = Math.min(100, survivor.health + 10);
                    survivor.energy = Math.min(100, survivor.energy + 10);
                    this.addEvent(survivor.name + ' å‡çº§åˆ° ' + survivor.level + ' çº§ï¼', 'success');
                }
            }
            
            recruitSurvivor() {
                const maxPopulation = 4 + this.buildings.filter(b => b.type === 'å®¿èˆ').length * 4;
                if (this.survivors.length >= maxPopulation) {
                    this.showNotification('äººå£å·²è¾¾ä¸Šé™ï¼Œéœ€è¦å»ºé€ æ›´å¤šå®¿èˆ', 'warning');
                    return;
                }
                
                if (this.resources['é£Ÿç‰©'].amount < 20 || this.resources['æ°´'].amount < 15) {
                    this.showNotification('èµ„æºä¸è¶³ï¼Œæ— æ³•æ‹›å‹Ÿå¹¸å­˜è€…', 'danger');
                    return;
                }
                
                this.resources['é£Ÿç‰©'].amount -= 20;
                this.resources['æ°´'].amount -= 15;
                
                const newId = this.survivors.length + 1;
                const newSurvivor = this.createRandomSurvivor(newId);
                this.survivors.push(newSurvivor);
                this.selectedSurvivor = newSurvivor;
                
                this.addEvent(newSurvivor.name + 'åŠ å…¥äº†åŸºåœ°', 'success');
                this.updateSurvivorsList();
                this.updateSurvivorDetail();
                this.checkAchievement('ark_heart');
            }
            
            setOrientation(orientation) {
                this.gameState.settings.orientation = orientation;
                document.body.className = orientation + '-mode';
                this.saveSettings();
                setTimeout(() => this.resizeCanvas(), 100);
            }
            
            // ====== å¼¹çª—æ˜¾ç¤ºæ–¹æ³• ======
            showSurvivorsModal() {
                this.updateSurvivorsList();
                this.updateSurvivorDetail();
                document.getElementById('survivors-modal').style.display = 'flex';
            }
            
            showResourcesModal() {
                this.updateResourcesList();
                document.getElementById('resources-modal').style.display = 'flex';
            }
            
            showTechModal() {
                const container = document.getElementById('tech-list');
                container.innerHTML = '';
                
                this.techTree.forEach(tech => {
                    const canResearch = this.canResearchTech(tech);
                    const researched = this.gameState.tech.has(tech.id);
                    
                    const item = document.createElement('div');
                    item.className = 'tech-item ' + (researched ? 'researched' : '') + ' ' + (!canResearch && !researched ? 'insufficient' : '');
                    item.innerHTML = `
                        <div>${tech.icon} ${tech.name}</div>
                        <div style="font-size: 12px; color: #8899cc;">${tech.desc}</div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="color: #f39c12; font-size: 12px;">${tech.cost}ææ–™</span>
                            ${researched ? 
                                '<span style="color: #2ecc71; font-size: 12px;">âœ…å·²ç ”ç©¶</span>' : 
                                canResearch ? 
                                '<button class="btn btn-small" onclick="game.researchTech(\'' + tech.id + '\')">ç ”ç©¶</button>' :
                                '<span style="color: #e74c3c; font-size: 12px;">ğŸ”’æœªè§£é”</span>'
                            }
                        </div>
                    `;
                    
                    if (tech.require.length > 0) {
                        const reqNames = tech.require.map(r => this.techTree.find(t => t.id === r)?.name || r);
                        item.innerHTML += '<div style="font-size: 11px; color: #f39c12; margin-top: 3px;">éœ€è¦: ' + reqNames.join(', ') + '</div>';
                    }
                    
                    container.appendChild(item);
                });
                
                document.getElementById('tech-modal').style.display = 'flex';
            }
            
            showUpgradeModal() {
                const container = document.getElementById('upgrade-list');
                container.innerHTML = '';
                
                this.buildingUpgrades.forEach(upgrade => {
                    const canAfford = this.resources['ææ–™'].amount >= upgrade.cost;
                    
                    const item = document.createElement('div');
                    item.className = 'tech-item ' + (canAfford ? '' : 'insufficient');
                    item.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 3px;">${upgrade.name}</div>
                        <div style="font-size: 12px; color: #8899cc; margin-bottom: 5px;">${upgrade.desc}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #f39c12; font-size: 13px;">${upgrade.cost}ææ–™</span>
                            ${canAfford ? 
                                '<button class="btn btn-small" onclick="game.purchaseUpgrade(' + JSON.stringify(upgrade).replace(/"/g, '&quot;') + ')">å‡çº§</button>' :
                                '<span style="color: #e74c3c; font-size: 12px;">ææ–™ä¸è¶³</span>'
                            }
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                document.getElementById('upgrade-modal').style.display = 'flex';
            }
            
            showAchievementsModal() {
                const container = document.getElementById('achievements-list');
                container.innerHTML = '';
                
                this.achievementList.forEach(achievement => {
                    const unlocked = this.gameState.achievements.has(achievement.id);
                    
                    const item = document.createElement('div');
                    item.className = 'achievement-item ' + (unlocked ? '' : 'locked');
                    item.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 14px;">${achievement.name}</div>
                            <div style="font-size: 12px; color: #8899cc;">${achievement.desc}</div>
                            <div style="font-size: 11px; color: ${unlocked ? '#2ecc71' : '#e74c3c'}; margin-top: 3px;">
                                ${unlocked ? 'âœ… å·²è§£é”' : 'ğŸ”’ æœªè§£é”'}
                            </div>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                document.getElementById('achievements-modal').style.display = 'flex';
            }
            
            showSettings() {
                document.getElementById('settings-modal').style.display = 'flex';
            }
            
            startGameLoop() {
                if (this.gameLoopInterval) {
                    clearInterval(this.gameLoopInterval);
                }
                
                // ä½¿ç”¨å½“å‰æ¸¸æˆé€Ÿåº¦
                const interval = 1000 / this.gameState.settings.speed;
                this.gameLoopInterval = setInterval(() => this.updateGame(), interval);
            }
            
            updateGame() {
                if (this.gameState.paused) return;
                
                // æ—¶é—´æµé€
                this.gameState.second++;
                if (this.gameState.second >= 60) {
                    this.gameState.second = 0;
                    this.gameState.minute++;
                    
                    if (this.gameState.minute >= 60) {
                        this.gameState.minute = 0;
                        this.gameState.hour++;
                        
                        if (this.gameState.hour >= 24) {
                            this.gameState.hour = 0;
                            this.gameState.day++;
                            this.addEvent('ç¬¬' + this.gameState.day + 'å¤©å¼€å§‹äº†', 'info');
                            
                            // ä¿®å¤ï¼šæ¯å¤©å¼€å§‹æ—¶ä¸ºæ‰€æœ‰å¹¸å­˜è€…å¢åŠ ç”Ÿå­˜å¤©æ•°
                            this.survivors.forEach(s => {
                                s.daysSurvived = (s.daysSurvived || 0) + 1; // å¢åŠ ç”Ÿå­˜å¤©æ•°
                                s.experience = (s.experience || 0) + 2; // æ¯å¤©ç”Ÿå­˜è·å¾—ç»éªŒå€¼
                                this.checkLevelUp(s);
                            });
                            
                            if (this.gameState.day % 3 === 0) {
                                this.gameState.threat = Math.min(10, this.gameState.threat + 1);
                                this.addEvent('å¨èƒç­‰çº§æå‡äº†ï¼', 'warning');
                            }
                        }
                    }
                }
                
                if (Math.random() < 0.001) {
                    const weathers = ['clear', 'rain', 'fog', 'storm'];
                    this.gameState.weather = weathers[Math.floor(Math.random() * weathers.length)];
                }
                
                for (const [name, data] of Object.entries(this.resources)) {
                    const net = (data.prod - data.cons) / 3600;
                    data.amount = Math.max(0, Math.min(data.amount + net, data.max));
                }
                
                if (this.gameState.second === 0) {
                    this.survivors.forEach(survivor => {
                        survivor.hunger += 0.1;
                        survivor.energy -= 0.05;
                        
                        if (survivor.hunger > 80) survivor.health -= 0.2;
                        if (survivor.energy < 30) survivor.health -= 0.1;
                        
                        if (survivor.hunger < 20 && survivor.energy > 70) {
                            survivor.health = Math.min(100, survivor.health + 0.05);
                        }
                        
                        survivor.hunger = Math.max(0, Math.min(100, survivor.hunger));
                        survivor.energy = Math.max(0, Math.min(100, survivor.energy));
                        survivor.health = Math.max(0, Math.min(100, survivor.health));
                        
                        if (survivor.health <= 0) {
                            this.handleDeath(survivor);
                        }
                    });
                }
                
                if (this.gameState.minute === 0 && this.gameState.second === 0 && Math.random() < 0.3) {
                    this.randomEvent();
                }
                
                if (Math.random() < 0.0005 + this.gameState.threat * 0.0001) {
                    this.spawnEnemy();
                }
                
                this.checkAchievements();
                
                this.updateUI();
            }
            
            updateUI() {
                document.getElementById('day-count').textContent = 'ç¬¬' + this.gameState.day + 'å¤©';
                const timeStr = this.gameState.hour.toString().padStart(2, '0') + ':' + 
                               this.gameState.minute.toString().padStart(2, '0') + ':' + 
                               this.gameState.second.toString().padStart(2, '0');
                document.getElementById('time-display').textContent = timeStr;
                
                const weatherMap = {
                    'clear': '&#x2600;&#xFE0F;æ™´æœ—',
                    'rain': '&#x1F327;&#xFE0F;é›¨å¤©', 
                    'fog': '&#x1F32B;&#xFE0F;é›¾å¤©',
                    'storm': '&#x26C8;&#xFE0F;æš´é£é›¨'
                };
                document.getElementById('weather').innerHTML = weatherMap[this.gameState.weather] || this.gameState.weather;
                document.getElementById('settings-game-day').textContent = this.gameState.day;
                
                this.drawBase();
            }
            
            addEvent(message, type = 'info') {
                const time = this.gameState.hour.toString().padStart(2, '0') + ':' + 
                            this.gameState.minute.toString().padStart(2, '0') + ':' + 
                            this.gameState.second.toString().padStart(2, '0');
                this.events.push({ time, message, type });
                this.showNotification(message, type);
            }
            
            showNotification(message, type = 'info') {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = 'notification ' + type;
                notification.textContent = message;
                container.appendChild(notification);
                
                setTimeout(() => notification.remove(), 3000);
            }
            
            handleDeath(survivor) {
                const index = this.survivors.findIndex(s => s.id === survivor.id);
                if (index !== -1) {
                    this.addEvent('&#x1F622; ' + survivor.name + 'ä¸å¹¸å»ä¸–äº†...', 'danger');
                    this.survivors.splice(index, 1);
                    if (this.selectedSurvivor?.id === survivor.id) {
                        this.selectedSurvivor = this.survivors[0] || null;
                    }
                }
            }
            
            spawnEnemy() {
                if (this.combatActive || this.enemies.length > 0) return;
                
                const enemyType = { 
                    type: 'ä¸§å°¸', 
                    health: 50 + this.gameState.threat * 10, 
                    damage: 10 + this.gameState.threat * 2, 
                    speed: 1, 
                    icon: '\uD83E\uDDDF' // ğŸ§Ÿ
                };
                
                const enemy = {
                    ...enemyType,
                    id: 1,
                    maxHealth: enemyType.health,
                    health: enemyType.health
                };
                
                this.enemies.push(enemy);
                this.addEvent('&#x26A0;&#xFE0F; ä¸§å°¸æ­£åœ¨æ¥è¿‘åŸºåœ°ï¼', 'danger');
                
                setTimeout(() => {
                    if (!this.combatActive && this.enemies.length > 0) {
                        this.startCombat();
                    }
                }, 2000);
            }
            
            startCombat() {
                if (this.enemies.length === 0) return;
                
                this.combatActive = true;
                this.currentEnemy = this.enemies[0];
                
                document.getElementById('enemy-info').innerHTML = `
                    <div class="enemy-card">
                        <div style="font-size: 48px;">${this.currentEnemy.icon}</div>
                        <div style="font-size: 18px; margin: 10px 0; color: #e74c3c;">${this.currentEnemy.type}</div>
                        <div>&#x2764;&#xFE0F; ç”Ÿå‘½å€¼: ${this.currentEnemy.health}/${this.currentEnemy.maxHealth}</div>
                        <div>&#x2694;&#xFE0F; ä¼¤å®³: ${this.currentEnemy.damage}</div>
                    </div>
                `;
                
                document.getElementById('combat-log').innerHTML = 
                    '<div style="color: #e74c3c;">' + this.currentEnemy.type + 'å‡ºç°åœ¨åŸºåœ°å¤–å›´ï¼</div>';
                
                document.getElementById('combat-modal').style.display = 'flex';
            }
            
            combatAction(action) {
                if (!this.currentEnemy) return;
                
                const log = document.getElementById('combat-log');
                
                switch(action) {
                    case 'attack':
                        const playerDamage = 20 + Math.floor(Math.random() * 15) + this.survivors.length * 2;
                        this.currentEnemy.health -= playerDamage;
                        
                        log.innerHTML += '<div>ä½ çš„é˜Ÿä¼å¯¹' + this.currentEnemy.type + 'é€ æˆ' + playerDamage + 'ç‚¹ä¼¤å®³ï¼</div>';
                        
                        if (this.currentEnemy.health > 0) {
                            const enemyDamage = this.currentEnemy.damage - Math.floor(Math.random() * 5);
                            log.innerHTML += '<div>' + this.currentEnemy.type + 'åå‡»ï¼Œé€ æˆ' + enemyDamage + 'ç‚¹ä¼¤å®³ï¼</div>';
                        }
                        break;
                        
                    case 'defend':
                        log.innerHTML += '<div>ä½ çš„é˜Ÿä¼é‡‡å–é˜²å¾¡å§¿æ€ï¼Œå‡å°‘äº†ä¸‹ä¸€æ¬¡ä¼¤å®³ï¼</div>';
                        break;
                        
                    case 'flee':
                        log.innerHTML += '<div>ä½ çš„é˜Ÿä¼æ’¤é€€äº†ï¼æŸå¤±äº†éƒ¨åˆ†èµ„æºã€‚</div>';
                        this.resources['ææ–™'].amount = Math.max(0, this.resources['ææ–™'].amount - 20);
                        this.resources['é£Ÿç‰©'].amount = Math.max(0, this.resources['é£Ÿç‰©'].amount - 15);
                        this.endCombat(false);
                        return;
                }
                
                if (this.currentEnemy.health <= 0) {
                    log.innerHTML += '<div style="color: #2ecc71;">âœ… å‡»è´¥äº†' + this.currentEnemy.type + 'ï¼</div>';
                    
                    const reward = Math.floor(Math.random() * 30) + 15;
                    this.resources['å¼¹è¯'].amount += reward;
                    this.addEvent('å‡»è´¥' + this.currentEnemy.type + 'ï¼Œè·å¾—' + reward + 'å¼¹è¯', 'success');
                    
                    // ä¸ºæ‰€æœ‰å¹¸å­˜è€…å¢åŠ å‡»æ€æ•°å’Œç»éªŒå€¼
                    this.survivors.forEach(survivor => {
                        survivor.kills = (survivor.kills || 0) + 1; // å¢åŠ å‡»æ€æ•°
                        survivor.experience = (survivor.experience || 0) + 10; // æˆ˜æ–—èƒœåˆ©è·å¾—ç»éªŒå€¼
                        this.checkLevelUp(survivor);
                    });
                    
                    this.enemies.shift();
                    
                    if (this.enemies.length === 0) {
                        this.checkAchievement('zombie_slayer');
                    }
                    
                    this.endCombat(this.enemies.length === 0);
                } else {
                    log.scrollTop = log.scrollHeight;
                }
            }
            
            endCombat(victory) {
                this.combatActive = false;
                this.currentEnemy = null;
                
                setTimeout(() => {
                    document.getElementById('combat-modal').style.display = 'none';
                }, 2000);
                
                if (victory) {
                    this.addEvent('æˆåŠŸå‡»é€€æ•Œäººï¼', 'success');
                }
            }
            
            canResearchTech(tech) {
                if (!tech) return false;
                if (this.gameState.tech.has(tech.id)) return false;
                if (this.resources['ææ–™'].amount < tech.cost) return false;
                
                for (const req of tech.require) {
                    if (!this.gameState.tech.has(req)) return false;
                }
                
                return true;
            }
            
            researchTech(techId) {
                const tech = this.techTree.find(t => t.id === techId);
                if (!tech) return;
                
                if (this.gameState.tech.has(techId)) {
                    this.showNotification('è¯¥ç§‘æŠ€å·²ç ”ç©¶å®Œæˆ', 'info');
                    return;
                }
                
                if (!this.canResearchTech(tech)) {
                    if (this.resources['ææ–™'].amount < tech.cost) {
                        this.showNotification('ææ–™ä¸è¶³ï¼éœ€è¦' + tech.cost + 'ææ–™', 'danger');
                    } else if (tech.require.length > 0) {
                        this.showNotification('æœªæ»¡è¶³å‰ç½®ç§‘æŠ€æ¡ä»¶', 'warning');
                    }
                    return;
                }
                
                this.resources['ææ–™'].amount -= tech.cost;
                this.gameState.tech.add(tech.id);
                
                // ç ”ç©¶ç§‘æŠ€ä¸ºæ‰€æœ‰å¹¸å­˜è€…å¢åŠ ç»éªŒå€¼
                this.survivors.forEach(survivor => {
                    survivor.experience = (survivor.experience || 0) + 20;
                    this.checkLevelUp(survivor);
                });
                
                this.showNotification('å¼€å§‹ç ”ç©¶ ' + tech.name, 'success');
                
                // ç§‘æŠ€ç ”ç©¶æ—¶é—´ä¹Ÿå—æ¸¸æˆé€Ÿåº¦å½±å“
                const researchTime = tech.time * 1000 * (1 / this.gameState.settings.speed);
                
                setTimeout(() => {
                    this.showNotification(tech.name + ' ç ”ç©¶å®Œæˆï¼', 'success');
                    this.applyTechEffect(tech.id);
                }, researchTime);
            }
            
            applyTechEffect(techId) {
                switch(techId) {
                    case 'basic_farming':
                        this.resources['é£Ÿç‰©'].prod *= 1.2;
                        break;
                    case 'water_purify':
                        this.resources['æ°´'].cons *= 0.7;
                        break;
                    case 'advanced_defense':
                        this.gameState.threat = Math.max(1, this.gameState.threat - 2);
                        break;
                    case 'solar_power':
                        this.resources['ææ–™'].prod += 10;
                        break;
                }
            }
            
            purchaseUpgrade(upgrade) {
                if (this.resources['ææ–™'].amount < upgrade.cost) {
                    this.showNotification('éœ€è¦' + upgrade.cost + 'ææ–™', 'danger');
                    return;
                }
                
                this.resources['ææ–™'].amount -= upgrade.cost;
                
                // å‡çº§å»ºç­‘ä¸ºæ‰€æœ‰å¹¸å­˜è€…å¢åŠ ç»éªŒå€¼
                this.survivors.forEach(survivor => {
                    survivor.experience = (survivor.experience || 0) + 15;
                    this.checkLevelUp(survivor);
                });
                
                upgrade.effect();
                this.addEvent(upgrade.name + 'å‡çº§å®Œæˆ', 'success');
                document.getElementById('upgrade-modal').style.display = 'none';
            }
            
            drawBase() {
                if (!this.ctx) return;
                
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                ctx.clearRect(0, 0, width, height);
                ctx.fillStyle = '#1a1a2e';
                ctx.fillRect(0, 0, width, height);
                
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                ctx.lineWidth = 1;
                const gridSize = 40;
                for (let x = 0; x < width; x += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }
                for (let y = 0; y < height; y += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }
                
                ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.strokeRect(20, 20, width - 40, height - 40);
                ctx.setLineDash([]);
                
                this.buildings.forEach(building => {
                    this.drawBuildingOnCanvas(building);
                });
            }
            
            drawBuildingOnCanvas(building) {
                const ctx = this.ctx;
                const scale = Math.min(this.canvas.width / 400, this.canvas.height / 300);
                const x = building.x * scale;
                const y = building.y * scale;
                const size = 35 * scale;
                
                const colors = {
                    'æŒ‡æŒ¥ä¸­å¿ƒ': '#3498db', 'å®¿èˆ': '#2ecc71', 'å¨æˆ¿': '#e74c3c',
                    'åŒ»ç–—ç«™': '#9b59b6', 'ç­æœ›å¡”': '#f1c40f', 'ä»“åº“': '#95a5a6',
                    'ç ”ç©¶æ‰€': '#1abc9c'
                };
                
                ctx.fillStyle = colors[building.type] || '#34495e';
                ctx.fillRect(x, y, size, size);
                
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1.5;
                ctx.strokeRect(x, y, size, size);
                
                // å»ºç­‘å›¾æ ‡ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—
                const emojis = {
                    'æŒ‡æŒ¥ä¸­å¿ƒ': '\uD83C\uDFE2', // ğŸ¢
                    'å®¿èˆ': '\uD83D\uDECF\uFE0F', // ğŸ›ï¸
                    'å¨æˆ¿': '\uD83C\uDF73', // ğŸ³
                    'åŒ»ç–—ç«™': '\uD83C\uDFE5', // ğŸ¥
                    'ç­æœ›å¡”': '\uD83D\uDD2D', // ğŸ”­
                    'ä»“åº“': '\uD83D\uDCE6', // ğŸ“¦
                    'ç ”ç©¶æ‰€': '\uD83D\uDD2C'  // ğŸ”¬
                };
                const icon = emojis[building.type] || '\uD83C\uDFE0'; // ğŸ 
                
                ctx.fillStyle = 'white';
                ctx.font = (14 * scale) + 'px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(icon, x + size/2, y + size/2);
                
                ctx.font = (8 * scale) + 'px Arial';
                ctx.fillText('Lv.' + building.level, x + size/2, y + size + 10 * scale);
            }
            
            checkAchievements() {
                this.achievementList.forEach(achievement => {
                    if (!this.gameState.achievements.has(achievement.id) && achievement.condition()) {
                        this.unlockAchievement(achievement.id);
                    }
                });
            }
            
            unlockAchievement(achievementId) {
                const achievement = this.achievementList.find(a => a.id === achievementId);
                if (achievement && !this.gameState.achievements.has(achievementId)) {
                    this.gameState.achievements.add(achievementId);
                    
                    // è§£é”æˆå°±æ—¶æ‰€æœ‰å¹¸å­˜è€…è·å¾—å¤§é‡ç»éªŒå€¼
                    this.survivors.forEach(survivor => {
                        survivor.experience = (survivor.experience || 0) + 50;
                        this.checkLevelUp(survivor);
                    });
                    
                    this.addEvent('&#x1F3C6; æˆå°±è§£é”ï¼š' + achievement.name, 'success');
                    this.showAchievementsModal();
                    this.saveGame();
                }
            }
            
            saveGame() {
                const saveData = {
                    gameState: this.gameState,
                    resources: this.resources,
                    survivors: this.survivors,
                    buildings: this.buildings,
                    tech: Array.from(this.gameState.tech),
                    achievements: Array.from(this.gameState.achievements),
                    explored: Array.from(this.gameState.explored)
                };
                
                try {
                    localStorage.setItem('åºŸåœŸæ–¹èˆŸ_save', JSON.stringify(saveData));
                    this.showNotification('æ¸¸æˆè¿›åº¦å·²ä¿å­˜ï¼', 'success');
                } catch (e) {
                    this.showNotification('ä¿å­˜å¤±è´¥ï¼šå­˜å‚¨ç©ºé—´ä¸è¶³', 'danger');
                }
            }
            
            saveSettings() {
                localStorage.setItem('åºŸåœŸæ–¹èˆŸ_settings', JSON.stringify(this.gameState.settings));
            }
            
            loadGame() {
                try {
                    const saveData = localStorage.getItem('åºŸåœŸæ–¹èˆŸ_save');
                    if (saveData) {
                        const data = JSON.parse(saveData);
                        this.gameState = { ...this.gameState, ...data.gameState };
                        this.resources = data.resources || this.resources;
                        this.survivors = data.survivors || this.survivors;
                        this.buildings = data.buildings || this.buildings;
                        this.gameState.tech = new Set(data.tech || []);
                        this.gameState.achievements = new Set(data.achievements || []);
                        this.gameState.explored = new Set(data.explored || []);
                        this.selectedSurvivor = this.survivors[0] || null;
                        this.showNotification('è¯»å–å­˜æ¡£æˆåŠŸï¼', 'success');
                    }
                    
                    const settingsData = localStorage.getItem('åºŸåœŸæ–¹èˆŸ_settings');
                    if (settingsData) {
                        this.gameState.settings = { ...this.gameState.settings, ...JSON.parse(settingsData) };
                        this.applySettingsToUI();
                    }
                } catch (e) {
                    console.error('è¯»å–å­˜æ¡£å¤±è´¥:', e);
                }
            }
            
            applySettingsToUI() {
                document.getElementById('music-toggle').checked = this.gameState.settings.music;
                document.getElementById('game-speed').value = this.gameState.settings.speed;
                document.getElementById('music-volume').value = this.gameState.settings.volume * 100;
                this.setOrientation(this.gameState.settings.orientation);
            }
            
            randomEvent() {
                const events = [
                    { 
                        message: '&#x1F327;&#xFE0F; ä¸‹äº†ä¸€åœºé›¨ï¼Œæ”¶é›†åˆ°ä¸€äº›å¹²å‡€çš„æ°´', 
                        effect: () => {
                            this.resources['æ°´'].amount += 30;
                            // éšæœºäº‹ä»¶ä¹Ÿä¸ºå¹¸å­˜è€…å¢åŠ ç»éªŒå€¼
                            this.survivors.forEach(survivor => {
                                survivor.experience = (survivor.experience || 0) + 3;
                                this.checkLevelUp(survivor);
                            });
                        }
                    },
                    { 
                        message: '&#x1F381; å‘ç°äº†åºŸå¼ƒçš„ç‰©èµ„ç®±', 
                        effect: () => {
                            this.resources['ææ–™'].amount += 20;
                            this.resources['é£Ÿç‰©'].amount += 15;
                            this.survivors.forEach(survivor => {
                                survivor.experience = (survivor.experience || 0) + 5;
                                this.checkLevelUp(survivor);
                            });
                        }
                    },
                    { 
                        message: '&#x1F48A; æ‰¾åˆ°äº†åŒ»ç–—ç”¨å“', 
                        effect: () => {
                            this.resources['è¯å“'].amount += 25;
                            this.survivors.forEach(survivor => {
                                survivor.experience = (survivor.experience || 0) + 4;
                                this.checkLevelUp(survivor);
                            });
                        }
                    }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                this.addEvent(event.message, 'info');
                event.effect();
            }
            
            checkAchievement(achievementId) {
                const achievement = this.achievementList.find(a => a.id === achievementId);
                if (achievement && !this.gameState.achievements.has(achievementId) && achievement.condition()) {
                    this.unlockAchievement(achievementId);
                }
            }
        }

        // ====== å…¨å±€è¾…åŠ©å‡½æ•° ======
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ====== æ¸¸æˆå¯åŠ¨ ======
        let game;
        
        document.addEventListener('DOMContentLoaded', () => {
            try {
                game = new SurvivalGame();
                window.game = game;
                
                console.log('ğŸ° ã€ŠåºŸåœŸæ–¹èˆŸã€‹å®Œæ•´ä¿®å¤ç‰ˆå·²å¯åŠ¨ï¼');
                console.log('âœ… ç¼–ç é—®é¢˜å·²ä¿®å¤ - ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—');
                console.log('âœ… æ¢ç´¢åŠŸèƒ½ä¿®å¤å®Œæˆ');
                console.log('âœ… æ¸¸æˆé€Ÿåº¦ï¼š1x=5ç§’, 5x=10ç§’, 10x=20ç§’');
                console.log('âœ… æš‚åœåŠŸèƒ½å·²æ·»åŠ ');
                console.log('âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸');
                
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').then(() => {
                        console.log('Service Worker æ³¨å†ŒæˆåŠŸ');
                    }).catch(err => {
                        console.log('Service Worker æ³¨å†Œå¤±è´¥:', err);
                    });
                }
            } catch (e) {
                console.error('æ¸¸æˆå¯åŠ¨å¤±è´¥:', e);
                const loadingText = document.querySelector('#loading-screen div:nth-child(3)');
                if (loadingText) {
                    loadingText.innerHTML = 'å¯åŠ¨å¤±è´¥: ' + e.message + '<br>è¯·åˆ·æ–°é¡µé¢é‡è¯•';
                    loadingText.style.color = '#e74c3c';
                }
            }
        });
    </script>
</body>
</html>
