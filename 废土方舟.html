<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åºŸåœŸæ–¹èˆŸ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #0c0c18; 
            color: #e8f0ff; 
            font-family: sans-serif; 
            overflow: hidden; 
        }
        
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        #status-bar {
            background: rgba(25, 30, 50, 0.95);
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .status-items {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-item div:first-child {
            font-size: 11px;
            color: #95a5a6;
            margin-bottom: 2px;
        }
        
        .status-value {
            font-size: 13px;
            font-weight: bold;
        }
        
        .time-display {
            background: rgba(41, 128, 185, 0.2);
            border: 1px solid rgba(41, 128, 185, 0.5);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            color: #3498db;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .time-icon {
            font-size: 14px;
        }
        
        .status-actions {
            display: flex;
            gap: 8px;
        }
        
        .status-btn {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 6px;
            color: white;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .status-btn:hover {
            background: rgba(52, 152, 219, 0.3);
        }
        
        /* åœ°å›¾åŒºåŸŸ */
        .map-system {
            flex: 1;
            display: flex;
            gap: 10px;
            min-height: 0;
        }
        
        .map-display {
            flex: 1;
            background: rgba(10, 15, 25, 0.8);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        #map-canvas {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            width: 300px;
            background: rgba(20, 25, 40, 0.9);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }
        
        /* åœ°å›¾æ ‡ç­¾ */
        .map-tabs {
            display: flex;
            background: rgba(30, 35, 50, 0.8);
            border-radius: 8px;
            padding: 4px;
        }
        
        .map-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
        }
        
        .map-tab.active {
            background: rgba(52, 152, 219, 0.3);
            color: #3498db;
        }
        
        /* ç³»ç»ŸåŠŸèƒ½åŒºåŸŸ */
        .system-functions {
            background: rgba(30, 35, 50, 0.6);
            border-radius: 8px;
            padding: 12px;
        }
        
        .system-title {
            font-size: 12px;
            color: #95a5a6;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .system-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .system-btn {
            background: rgba(40, 45, 60, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 10px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .system-btn:hover {
            background: rgba(50, 55, 70, 0.9);
        }
        
        .system-btn.monster { color: #e74c3c; border-color: #e74c3c; }
        .system-btn.tech { color: #9b59b6; border-color: #9b59b6; }
        .system-btn.explore { color: #2ecc71; border-color: #2ecc71; }
        .system-btn.auto-save { color: #3498db; border-color: #3498db; }
        .system-btn.load-list { color: #f39c12; border-color: #f39c12; }
        
        /* å¿«æ·æ“ä½œ */
        .quick-actions {
            display: flex;
            gap: 8px;
        }
        
        .control-btn {
            background: rgba(40, 50, 80, 0.9);
            border: none;
            border-radius: 6px;
            color: white;
            padding: 10px;
            font-size: 12px;
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        /* å»ºç­‘åˆ—è¡¨ */
        .building-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .building-item {
            background: rgba(40, 45, 60, 0.6);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .building-item:hover {
            background: rgba(50, 55, 70, 0.8);
        }
        
        /* åº•éƒ¨æŒ‰é’®æ  */
        .bottom-buttons {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            padding: 10px;
            background: rgba(25, 30, 50, 0.95);
            border-radius: 10px;
            flex-shrink: 0;
        }
        
        .bottom-btn {
            background: rgba(40, 50, 80, 0.9);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 12px 5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            transition: all 0.2s;
        }
        
        .bottom-btn:hover {
            background: rgba(52, 152, 219, 0.3);
        }
        
        .bottom-btn-icon {
            font-size: 18px;
        }
        
        /* å¼¹çª—ç³»ç»Ÿ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: #2c3e50;
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid #3498db;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .modal-title {
            font-size: 16px;
            color: #3498db;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #e74c3c;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 1001;
        }
        
        /* æ–°æ‰‹æ•™ç¨‹æ ·å¼ */
        .tutorial-step {
            padding: 10px;
            margin: 10px 0;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .tutorial-step h4 {
            color: #3498db;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tutorial-step p {
            font-size: 12px;
            color: #bdc3c7;
        }
        
        /* å¹¸å­˜è€…å·¥ä½œåˆ†é… */
        .job-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .job-btn {
            padding: 8px;
            background: rgba(40, 45, 60, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            color: white;
            font-size: 11px;
            cursor: pointer;
            text-align: center;
        }
        
        .job-btn.active {
            background: rgba(52, 152, 219, 0.5);
            border-color: #3498db;
        }
        
        .job-btn:hover:not(.active) {
            background: rgba(50, 55, 70, 0.9);
        }
        
        /* æ€ªç‰©ç³»ç»Ÿ */
        .monster-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .monster-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .monster-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .monster-icon {
            font-size: 20px;
        }
        
        .monster-stats {
            display: flex;
            gap: 10px;
            font-size: 11px;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            margin: 10px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        /* é€šçŸ¥ç³»ç»Ÿ */
        #notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .notification {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-icon {
            font-size: 18px;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: bold;
            font-size: 12px;
            color: #3498db;
        }
        
        .notification-message {
            font-size: 11px;
            color: #bdc3c7;
            margin-top: 3px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* å»ºç­‘å»ºé€ æŒ‰é’® */
        .build-btn {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
            color: #2ecc71;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .build-btn:hover {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .build-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* DLCç³»ç»Ÿæ ·å¼ */
        .dlc-drop-zone {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            background: rgba(52, 152, 219, 0.1);
            transition: all 0.3s;
        }
        
        .dlc-drop-zone.drag-over {
            background: rgba(52, 152, 219, 0.3);
            border-color: #2ecc71;
        }
        
        .dlc-installed {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .dlc-item {
            padding: 10px;
            background: rgba(40, 45, 60, 0.6);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dlc-item-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dlc-icon {
            font-size: 24px;
        }
        
        .dlc-name {
            font-weight: bold;
            font-size: 14px;
        }
        
        .dlc-description {
            font-size: 11px;
            color: #95a5a6;
            margin-bottom: 8px;
        }
        
        .dlc-meta {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #7f8c8d;
        }
        
        /* æ¢ç´¢ç³»ç»Ÿæ ·å¼ */
        .exploration-locations {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .location-card {
            padding: 12px;
            background: rgba(40, 45, 60, 0.6);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .location-card:hover {
            background: rgba(50, 55, 70, 0.8);
            transform: translateY(-2px);
        }
        
        .location-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .location-icon {
            font-size: 24px;
        }
        
        .location-name {
            font-weight: bold;
            font-size: 13px;
        }
        
        .location-info {
            font-size: 11px;
            color: #95a5a6;
            margin-bottom: 8px;
        }
        
        .location-stats {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #7f8c8d;
        }
        
        .exploration-team {
            margin-top: 15px;
            padding: 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .team-member {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 11px;
        }
        
        .exploration-timer {
            margin-top: 10px;
            font-size: 12px;
            text-align: center;
            color: #2ecc71;
        }
        
        /* è®¾ç½®å¼¹çª—æ ·å¼ */
        .settings-option {
            margin-bottom: 15px;
        }
        
        .settings-label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #bdc3c7;
        }
        
        .settings-control {
            width: 100%;
            padding: 8px;
            background: #34495e;
            color: white;
            border: 1px solid #2c3e50;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .settings-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        /* å¸®åŠ©å¼¹çª—æ ·å¼å¢å¼º */
        .help-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .help-section:last-child {
            border-bottom: none;
        }
        
        .help-section-title {
            color: #3498db;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .help-tip {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
            font-size: 12px;
            color: #3498db;
            border-left: 3px solid #3498db;
        }
        
        /* é€‚åº”æ¨ªç«–å± */
        @media (orientation: portrait) {
            .map-system {
                flex-direction: column;
            }
            
            .control-panel {
                width: 100%;
                height: 300px;
            }
        }
        
        @media (orientation: landscape) {
            .map-system {
                flex-direction: row;
            }
            
            .control-panel {
                width: 300px;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div id="status-bar">
            <div class="status-items">
                <div class="status-item">
                    <div>ç”Ÿå­˜å¤©æ•°</div>
                    <div class="status-value" style="color:#3498db;">ç¬¬1å¤©</div>
                </div>
                
                <div class="time-display">
                    <span class="time-icon">ğŸ•</span>
                    <span id="game-time">07:00</span>
                </div>
                
                <div class="status-item">
                    <div>åŸºåœ°äººå£</div>
                    <div class="status-value" style="color:#2ecc71;">5/10äºº</div>
                </div>
                <div class="status-item">
                    <div>é˜²å¾¡ç­‰çº§</div>
                    <div class="status-value" style="color:#e74c3c;">Lv.1</div>
                </div>
                <div class="status-item">
                    <div>èµ„æºå‚¨å¤‡</div>
                    <div class="status-value" style="color:#f39c12;">30%</div>
                </div>
                <div class="status-item">
                    <div>ç§‘æŠ€ç‚¹æ•°</div>
                    <div class="status-value" style="color:#9b59b6;">50</div>
                </div>
                <div class="status-item">
                    <div>ææ–™</div>
                    <div class="status-value" style="color:#e67e22;" id="material-status">20</div>
                </div>
            </div>
            
            <div class="status-actions">
                <button class="status-btn" onclick="togglePause()">
                    <span id="pause-icon">â¸ï¸</span>
                    <span id="pause-text">æš‚åœ</span>
                </button>
                <!-- ä¿®å¤ï¼šå¸®åŠ©æŒ‰é’®è°ƒç”¨å¸®åŠ©å¼¹çª— -->
                <button class="status-btn" onclick="showModal('help-modal')">
                    <span>â“</span>
                    <span>å¸®åŠ©</span>
                </button>
                <!-- ä¿®å¤ï¼šè®¾ç½®æŒ‰é’®è°ƒç”¨è®¾ç½®å¼¹çª— -->
                <button class="status-btn" onclick="showModal('settings-modal')">
                    <span>âš™ï¸</span>
                    <span>è®¾ç½®</span>
                </button>
            </div>
        </div>
        
        <!-- åœ°å›¾åŒºåŸŸ -->
        <div class="map-system">
            <div class="map-display">
                <canvas id="map-canvas"></canvas>
            </div>
            
            <div class="control-panel">
                <!-- åœ°å›¾åˆ‡æ¢æ ‡ç­¾ -->
                <div class="map-tabs">
                    <div class="map-tab active" data-view="base">åŸºåœ°</div>
                    <div class="map-tab" data-view="defense">é˜²å¾¡</div>
                    <div class="map-tab" data-view="resource">èµ„æº</div>
                    <div class="map-tab" data-view="exploration">æ¢ç´¢</div>
                </div>
                
                <!-- å½“å‰è§†å›¾ä¿¡æ¯ -->
                <div id="view-info">
                    <h3 style="margin-bottom:10px;color:#3498db;">åŸºåœ°åœ°å›¾</h3>
                    <p style="font-size:12px;color:#95a5a6;">ç‚¹å‡»åœ°å›¾ä¸Šçš„å»ºç­‘è¿›è¡Œç®¡ç†</p>
                </div>
                
                <!-- ç³»ç»ŸåŠŸèƒ½åŒºåŸŸ -->
                <div class="system-functions">
                    <div class="system-title">
                        <span>âš™ï¸</span>
                        <span>ç³»ç»ŸåŠŸèƒ½</span>
                    </div>
                    <div class="system-grid">
                        <button class="system-btn monster" onclick="showModal('monster-modal')">
                            <span class="system-btn-icon">ğŸ‘¾</span>
                            <span>æ€ªç‰©ç³»ç»Ÿ</span>
                        </button>
                        <button class="system-btn tech" onclick="showModal('tech-modal')">
                            <span class="system-btn-icon">ğŸ”¬</span>
                            <span>ç§‘æŠ€ç ”ç©¶</span>
                        </button>
                        <button class="system-btn explore" onclick="showModal('exploration-modal')">
                            <span class="system-btn-icon">ğŸ§­</span>
                            <span>æ¢ç´¢åºŸåœŸ</span>
                        </button>
                        <button class="system-btn auto-save" onclick="toggleAutoSave()">
                            <span class="system-btn-icon">ğŸ’¾</span>
                            <span id="auto-save-text">è‡ªåŠ¨å­˜æ¡£:å…³</span>
                        </button>
                        <button class="system-btn load-list" onclick="showModal('save-load-modal')">
                            <span class="system-btn-icon">ğŸ“‹</span>
                            <span>å­˜æ¡£/è¯»æ¡£</span>
                        </button>
                    </div>
                </div>
                
                <!-- å¿«æ·æ“ä½œ -->
                <div class="quick-actions">
                    <button class="control-btn" onclick="zoomIn()">
                        <span>ğŸ”</span>
                        <span>æ”¾å¤§</span>
                    </button>
                    <button class="control-btn" onclick="zoomOut()">
                        <span>ğŸ”</span>
                        <span>ç¼©å°</span>
                    </button>
                    <button class="control-btn" onclick="resetView()">
                        <span>ğŸ”„</span>
                        <span>é‡ç½®</span>
                    </button>
                    <button class="control-btn" onclick="toggleGrid()">
                        <span>ğŸ”²</span>
                        <span id="grid-text">ç½‘æ ¼</span>
                    </button>
                </div>
                
                <!-- åŠ¨æ€çŠ¶æ€ä¿¡æ¯ -->
                <div class="system-functions">
                    <div class="system-title">
                        <span>ğŸ“Š</span>
                        <span>å®æ—¶çŠ¶æ€</span>
                    </div>
                    <div id="dynamic-stats">
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>é£Ÿç‰©å‚¨å¤‡</span>
                                <span>50/100</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 50%; background: #2ecc71;"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>ç”µåŠ›ä¾›åº”</span>
                                <span>30/100</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%; background: #f1c40f;"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>é˜²å¾¡å®Œå¥½åº¦</span>
                                <span>60%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%; background: #e74c3c;"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>ææ–™æ”¶é›†</span>
                                <span id="material-progress">20/100000</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="material-progress-bar" style="width: 20%; background: #e67e22;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å»ºç­‘åˆ—è¡¨ -->
                <div class="building-list" id="building-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨æŒ‰é’®æ  -->
        <div class="bottom-buttons">
            <button class="bottom-btn" onclick="showModal('survivors-modal')">
                <span class="bottom-btn-icon">ğŸ‘¥</span>
                <span>å¹¸å­˜è€…</span>
            </button>
            <button class="bottom-btn" onclick="showModal('resources-modal')">
                <span class="bottom-btn-icon">ğŸ“¦</span>
                <span>èµ„æº</span>
            </button>
            <button class="bottom-btn" onclick="showModal('buildings-modal')">
                <span class="bottom-btn-icon">ğŸ—ï¸</span>
                <span>å»ºç­‘</span>
            </button>
            <button class="bottom-btn" onclick="showModal('tech-modal')">
                <span class="bottom-btn-icon">ğŸ”¬</span>
                <span>ç§‘æŠ€</span>
            </button>
            <button class="bottom-btn" onclick="showModal('achievements-modal')">
                <span class="bottom-btn-icon">ğŸ†</span>
                <span>æˆå°±</span>
            </button>
            <button class="bottom-btn" onclick="showModal('dlc-modal')">
                <span class="bottom-btn-icon">ğŸ</span>
                <span>DLC</span>
            </button>
        </div>
    </div>
    
    <!-- é€šçŸ¥åŒºåŸŸ -->
    <div id="notification-area"></div>
    
    <!-- å¼¹çª—æ¨¡æ¿ -->
    <div class="modal" id="survivors-modal">
        <div class="modal-content">
            <div class="modal-title">å¹¸å­˜è€…ç®¡ç†</div>
            <button class="close-btn" onclick="closeModal('survivors-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                        <div style="font-size: 24px;">ğŸ‘¥</div>
                        <div style="font-size: 12px;">æ€»äººå£</div>
                        <div style="font-size: 16px; font-weight: bold; color: #3498db;" id="total-population">5/10</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: rgba(46, 204, 113, 0.1); border-radius: 6px;">
                        <div style="font-size: 24px;">â¤ï¸</div>
                        <div style="font-size: 12px;">å¥åº·åº¦</div>
                        <div style="font-size: 16px; font-weight: bold; color: #2ecc71;" id="health-rate">85%</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: rgba(155, 89, 182, 0.1); border-radius: 6px;">
                        <div style="font-size: 24px;">ğŸ§ </div>
                        <div style="font-size: 12px;">å£«æ°”</div>
                        <div style="font-size: 16px; font-weight: bold; color: #9b59b6;" id="morale-rate">70%</div>
                    </div>
                </div>
                
                <h4 style="color: #3498db; margin-bottom: 10px;">å¹¸å­˜è€…åˆ—è¡¨</h4>
                <div style="max-height: 300px; overflow-y: auto;" id="survivor-list">
                    <!-- åŠ¨æ€ç”Ÿæˆå¹¸å­˜è€…åˆ—è¡¨ -->
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                    <div style="font-size: 12px; color: #3498db; margin-bottom: 8px;">ğŸ’¡ æç¤ºï¼šç‚¹å‡»å¹¸å­˜è€…å¯ä»¥åˆ†é…å·¥ä½œ</div>
                    <div style="font-size: 11px; color: #95a5a6;">ä¸åŒèŒä¸šæœ‰ä¸åŒçš„å·¥ä½œæ•ˆç‡å’Œç‰¹é•¿</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="resources-modal">
        <div class="modal-content">
            <div class="modal-title">èµ„æºç®¡ç†</div>
            <button class="close-btn" onclick="closeModal('resources-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                    <div style="padding: 10px; background: rgba(46, 204, 113, 0.1); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>ğŸ é£Ÿç‰©</span>
                            <span style="font-weight: bold; color: #2ecc71;" id="food-amount">50/100</span>
                        </div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: 50%; background: #2ecc77;" id="food-bar"></div>
                        </div>
                    </div>
                    <div style="padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>ğŸ’§ å‡€æ°´</span>
                            <span style="font-weight: bold; color: #3498db;" id="water-amount">40/100</span>
                        </div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: 40%; background: #3498db;" id="water-bar"></div>
                        </div>
                    </div>
                    <div style="padding: 10px; background: rgba(241, 196, 15, 0.1); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>âš¡ ç”µåŠ›</span>
                            <span style="font-weight: bold; color: #f1c40f;" id="power-amount">30/100</span>
                        </div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: 30%; background: #f1c40f;" id="power-bar"></div>
                        </div>
                    </div>
                    <div style="padding: 10px; background: rgba(231, 76, 60, 0.1); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>â›ï¸ ææ–™</span>
                            <span style="font-weight: bold; color: #e74c3c;" id="material-amount">20/100</span>
                        </div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: 20%; background: #e74c3c;" id="material-bar"></div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">èµ„æºç”Ÿäº§/æ¶ˆè€—ï¼ˆæ¯å°æ—¶ï¼‰</h4>
                    <div style="font-size: 12px;">
                        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                            <span>é£Ÿç‰©ç”Ÿäº§: <span style="color: #2ecc71;" id="food-production">+2</span></span>
                            <span>é£Ÿç‰©æ¶ˆè€—: <span style="color: #e74c3c;" id="food-consumption">-5</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                            <span>å‡€æ°´ç”Ÿäº§: <span style="color: #3498db;" id="water-production">+2</span></span>
                            <span>å‡€æ°´æ¶ˆè€—: <span style="color: #e74c3c;" id="water-consumption">-5</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                            <span>ç”µåŠ›ç”Ÿäº§: <span style="color: #f1c40f;" id="power-production">+5</span></span>
                            <span>ç”µåŠ›æ¶ˆè€—: <span style="color: #e74c3c;" id="power-consumption">-3</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                            <span>ææ–™ç”Ÿäº§: <span style="color: #e74c3c;" id="material-production">+1</span></span>
                            <span>ææ–™æ¶ˆè€—: <span style="color: #e74c3c;" id="material-consumption">-1</span></span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 10px; background: rgba(241, 196, 15, 0.1); border-radius: 6px;">
                    <div style="font-size: 11px; color: #f1c40f;">âš ï¸ è­¦å‘Šï¼šå½“å‰é£Ÿç‰©å’Œæ°´æ¶ˆè€—å¤§äºç”Ÿäº§ï¼Œè¯·å°½å¿«å»ºé€ æ›´å¤šç”Ÿäº§è®¾æ–½ï¼</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="buildings-modal">
        <div class="modal-content">
            <div class="modal-title">å»ºç­‘å»ºé€ </div>
            <button class="close-btn" onclick="closeModal('buildings-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="margin-bottom: 15px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">å¯ç”¨å»ºç­‘</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;" id="available-buildings">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">å»ºç­‘è¯´æ˜</h4>
                    <div style="font-size: 12px; color: #95a5a6;">
                        <p>â€¢ æŒ‡æŒ¥ä¸­å¿ƒï¼šåŸºåœ°æ ¸å¿ƒï¼Œå‡çº§å¯è§£é”æ–°å»ºç­‘</p>
                        <p>â€¢ ä½å®…åŒºï¼šå¢åŠ äººå£å®¹é‡ï¼Œæå‡å£«æ°”</p>
                        <p>â€¢ å‘ç”µå‚ï¼šæä¾›ç”µåŠ›æ”¯æŒ</p>
                        <p>â€¢ å†œåœºï¼šç”Ÿäº§é£Ÿç‰©ï¼Œç»´æŒç”Ÿå­˜</p>
                        <p>â€¢ å‡€æ°´å‚ï¼šæä¾›æ¸…æ´é¥®ç”¨æ°´</p>
                        <p>â€¢ ä»“åº“ï¼šå­˜å‚¨èµ„æºï¼Œæå‡å­˜å‚¨ä¸Šé™</p>
                        <p>â€¢ å›æ”¶ç«™ï¼šå›æ”¶åºŸæ–™ï¼Œç”Ÿäº§å»ºç­‘ææ–™</p>
                        <p>â€¢ ææ–™åŠ å·¥å‚ï¼šé«˜æ•ˆç”Ÿäº§å»ºç­‘ææ–™</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="tech-modal">
        <div class="modal-content">
            <div class="modal-title">ç§‘æŠ€ç ”ç©¶</div>
            <button class="close-btn" onclick="closeModal('tech-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="text-align: center; margin-bottom: 15px;">
                    <div style="font-size: 12px; color: #95a5a6;">å¯ç”¨ç§‘æŠ€ç‚¹æ•°</div>
                    <div style="font-size: 24px; font-weight: bold; color: #9b59b6;" id="tech-points">50</div>
                </div>
                
                <div style="max-height: 300px; overflow-y: auto;" id="tech-list">
                    <!-- åŠ¨æ€ç”Ÿæˆç§‘æŠ€åˆ—è¡¨ -->
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(155, 89, 182, 0.1); border-radius: 6px;">
                    <div style="font-size: 11px; color: #9b59b6;">ğŸ’¡ æç¤ºï¼šç ”ç©¶ç§‘æŠ€å¯ä»¥è§£é”æ–°å»ºç­‘å’ŒåŠŸèƒ½ï¼Œæå‡ç”Ÿå­˜æ•ˆç‡</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="achievements-modal">
        <div class="modal-content">
            <div class="modal-title">æˆå°±ç³»ç»Ÿ</div>
            <button class="close-btn" onclick="closeModal('achievements-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="text-align: center; margin-bottom: 15px;">
                    <div style="font-size: 12px; color: #95a5a6;">å·²è§£é”æˆå°±</div>
                    <div style="font-size: 24px; font-weight: bold; color: #f39c12;" id="achievement-count">2/20</div>
                </div>
                
                <div style="max-height: 300px; overflow-y: auto;" id="achievement-list">
                    <!-- åŠ¨æ€ç”Ÿæˆæˆå°±åˆ—è¡¨ -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="monster-modal">
        <div class="modal-content">
            <div class="modal-title">æ€ªç‰©ç³»ç»Ÿ</div>
            <button class="close-btn" onclick="closeModal('monster-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 14px; color: #e74c3c;">å¨èƒç­‰çº§: <span id="threat-level">ä½</span></div>
                        <div style="font-size: 12px; color: #95a5a6;">ä¸‹æ¬¡è¢­å‡»: <span id="next-attack">2å¤©å</span></div>
                    </div>
                    <div class="progress-bar" style="margin-top: 10px;">
                        <div class="progress-fill" style="width: 30%; background: #e74c3c;" id="threat-bar"></div>
                    </div>
                </div>
                
                <h4 style="color: #3498db; margin-bottom: 10px;">å·²çŸ¥æ€ªç‰©ç§ç±»</h4>
                <div class="monster-list" id="monster-list">
                    <!-- åŠ¨æ€ç”Ÿæˆæ€ªç‰©åˆ—è¡¨ -->
                </div>
                
                <div style="margin-top: 15px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">é˜²å¾¡å»ºè®®</h4>
                    <div style="font-size: 12px; color: #95a5a6;">
                        <p>â€¢ å»ºé€ é˜²å¾¡è®¾æ–½å¯ä»¥æŠµæŒ¡æ€ªç‰©è¢­å‡»</p>
                        <p>â€¢ å‡çº§é˜²å¾¡è®¾æ–½å¯ä»¥åº”å¯¹æ›´å¼ºå¤§çš„æ€ªç‰©</p>
                        <p>â€¢ å®šæœŸæ´¾é£æ¢ç´¢é˜Ÿå¯ä»¥æå‰å‘ç°å¨èƒ</p>
                        <p>â€¢ ä¿æŒè¶³å¤Ÿçš„æ­¦å™¨å’Œå¼¹è¯å‚¨å¤‡</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="exploration-modal">
        <div class="modal-content">
            <div class="modal-title">æ¢ç´¢åºŸåœŸ</div>
            <button class="close-btn" onclick="closeModal('exploration-modal')">Ã—</button>
            <div style="padding: 15px;">
                <!-- æ¢ç´¢çŠ¶æ€ -->
                <div class="exploration-team" id="exploration-status">
                    <!-- åŠ¨æ€ç”Ÿæˆæ¢ç´¢çŠ¶æ€ -->
                </div>
                
                <!-- æ¢ç´¢åœ°ç‚¹ -->
                <div style="margin-top: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">å¯æ¢ç´¢åœ°ç‚¹</h4>
                    <div class="exploration-locations" id="exploration-locations">
                        <!-- åŠ¨æ€ç”Ÿæˆæ¢ç´¢åœ°ç‚¹ -->
                    </div>
                </div>
                
                <!-- æ¢ç´¢ç»“æœ -->
                <div style="margin-top: 20px; display: none;" id="exploration-results">
                    <h4 style="color: #3498db; margin-bottom: 10px;">æ¢ç´¢ç»“æœ</h4>
                    <div id="exploration-results-content">
                        <!-- åŠ¨æ€ç”Ÿæˆæ¢ç´¢ç»“æœ -->
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                    <div style="font-size: 11px; color: #3498db;">ğŸ’¡ æç¤ºï¼šç«‹å³æ¢ç´¢ï¼æˆåŠŸæ¦‚ç‡éšå±é™©ç­‰çº§é™ä½ã€‚æˆåŠŸè·å¾—å¤§é‡å¥–åŠ±ï¼Œå¤±è´¥æŸå¤±èµ„æº</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="save-load-modal">
        <div class="modal-content">
            <div class="modal-title">å­˜æ¡£/è¯»æ¡£</div>
            <button class="close-btn" onclick="closeModal('save-load-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">ä¿å­˜æ¸¸æˆ</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="save-name" placeholder="å­˜æ¡£åç§°" style="flex: 1; padding: 8px; background: #34495e; color: white; border: 1px solid #2c3e50; border-radius: 4px; font-size: 12px;">
                        <button class="control-btn" onclick="saveGame()">ä¿å­˜</button>
                    </div>
                </div>
                
                <div>
                    <h4 style="color: #3498db; margin-bottom: 10px;">åŠ è½½å­˜æ¡£</h4>
                    <div style="max-height: 200px; overflow-y: auto;" id="save-list">
                        <!-- åŠ¨æ€ç”Ÿæˆå­˜æ¡£åˆ—è¡¨ -->
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                    <div style="font-size: 11px; color: #3498db;">ğŸ’¡ æç¤ºï¼šè‡ªåŠ¨å­˜æ¡£æ¯30åˆ†é’Ÿä¿å­˜ä¸€æ¬¡ï¼Œæ‰‹åŠ¨å­˜æ¡£ä¸é™æ¬¡æ•°</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- DLCå¼¹çª— -->
    <div class="modal" id="dlc-modal">
        <div class="modal-content">
            <div class="modal-title">DLCç®¡ç†ç³»ç»Ÿ</div>
            <button class="close-btn" onclick="closeModal('dlc-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">å·²å®‰è£…DLC</h4>
                    <div class="dlc-installed" id="installed-dlc">
                        <!-- åŠ¨æ€ç”Ÿæˆå·²å®‰è£…DLC -->
                    </div>
                    
                    <div id="no-dlc-message" style="text-align: center; padding: 20px; color: #95a5a6; font-size: 12px;">
                        æš‚æ— DLCï¼Œè¯·å®‰è£…DLCæ‰©å±•å†…å®¹
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">å®‰è£…æ–°DLC</h4>
                    
                    <!-- æ–¹æ³•1ï¼šæ‹–æ‹½å®‰è£… -->
                    <div class="dlc-drop-zone" id="dlc-drop-zone">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“</div>
                        <div style="font-size: 14px; font-weight: bold; margin-bottom: 5px;">æ‹–æ‹½DLCæ–‡ä»¶åˆ°æ­¤å¤„</div>
                        <div style="font-size: 11px; color: #95a5a6;">æ”¯æŒJSONæ ¼å¼çš„DLCæ–‡ä»¶</div>
                    </div>
                    
                    <!-- æ–¹æ³•2ï¼šURLå®‰è£… -->
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 12px; color: #95a5a6; margin-bottom: 10px;">æˆ–è¾“å…¥DLC JSON URL</div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="dlc-url" placeholder="https://example.com/dlc.json" style="flex: 1; padding: 8px; background: #34495e; color: white; border: 1px solid #2c3e50; border-radius: 4px; font-size: 12px;">
                            <button class="control-btn" onclick="loadDLCFromURL()">å®‰è£…</button>
                        </div>
                    </div>
                    
                    <!-- æ–¹æ³•3ï¼šç¤ºä¾‹DLC -->
                    <div style="margin-top: 20px;">
                        <div style="font-size: 12px; color: #95a5a6; margin-bottom: 10px;">ç¤ºä¾‹DLCï¼ˆç‚¹å‡»å®‰è£…ï¼‰</div>
                        <div style="text-align: center;">
                            <button class="control-btn" style="width: 80%;" onclick="installExampleDLC()">
                                ğŸ­ å®‰è£…ææ–™ç”Ÿäº§DLC
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                    <div style="font-size: 11px; color: #3498db;">ğŸ’¡ æç¤ºï¼šDLCå¯ä»¥æ·»åŠ æ–°å»ºç­‘ã€ç§‘æŠ€ã€æ€ªç‰©ã€æˆå°±ç­‰æ¸¸æˆå†…å®¹ï¼Œæ‰©å±•æ¸¸æˆä½“éªŒ</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è®¾ç½®å¼¹çª— -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-title">æ¸¸æˆè®¾ç½®</div>
            <button class="close-btn" onclick="closeModal('settings-modal')">Ã—</button>
            <div style="padding: 15px;">
                <div class="settings-option">
                    <label class="settings-label">æ¸¸æˆé€Ÿåº¦:</label>
                    <select id="game-speed" class="settings-control">
                        <option value="2000">ææ…¢</option>
                        <option value="1000">æ…¢é€Ÿ</option>
                        <option value="500" selected>æ­£å¸¸</option>
                        <option value="250">å¿«é€Ÿ</option>
                        <option value="100">æå¿«</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <label class="settings-label">æ˜¾ç¤ºæ¨¡å¼:</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="control-btn" id="portrait-btn" onclick="setOrientation('portrait')" style="flex: 1;">
                            <span>ğŸ“±</span>
                            <span>ç«–å±</span>
                        </button>
                        <button class="control-btn" id="landscape-btn" onclick="setOrientation('landscape')" style="flex: 1;">
                            <span>ğŸ’»</span>
                            <span>æ¨ªå±</span>
                        </button>
                    </div>
                </div>
                
                <div class="settings-option">
                    <label class="settings-label">å…¶ä»–è®¾ç½®:</label>
                    <div class="settings-checkbox">
                        <input type="checkbox" id="show-grid" checked>
                        <span>æ˜¾ç¤ºç½‘æ ¼</span>
                    </div>
                    <div class="settings-checkbox">
                        <input type="checkbox" id="sound-enabled" checked>
                        <span>å¯ç”¨éŸ³æ•ˆ</span>
                    </div>
                    <div class="settings-checkbox">
                        <input type="checkbox" id="notifications-enabled" checked>
                        <span>å¯ç”¨é€šçŸ¥</span>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="control-btn" style="width: 100%;" onclick="resetGame()">
                        é‡ç½®æ¸¸æˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¸®åŠ©å¼¹çª— -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-title">æ–°æ‰‹å¸®åŠ©æŒ‡å—</div>
            <button class="close-btn" onclick="closeModal('help-modal')">Ã—</button>
            <div style="padding: 15px; max-height: 400px; overflow-y: auto;">
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ®</span> åŸºæœ¬æ“ä½œ</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ ç‚¹å‡»åœ°å›¾ä¸Šçš„å»ºç­‘è¿›è¡Œç®¡ç†</p>
                        <p>â€¢ æ‹–åŠ¨åœ°å›¾å¯ä»¥ç§»åŠ¨è§†è§’</p>
                        <p>â€¢ ä½¿ç”¨é¼ æ ‡æ»šè½®æˆ–æŒ‰é’®è¿›è¡Œç¼©æ”¾</p>
                        <p>â€¢ ç‚¹å‡»å³ä¸Šè§’æŒ‰é’®å¯æš‚åœæ¸¸æˆ</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ‘¥</span> å¹¸å­˜è€…ç®¡ç†</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ ç‚¹å‡»å¹¸å­˜è€…å¯ä»¥åˆ†é…å·¥ä½œ</p>
                        <p>â€¢ ä¸åŒèŒä¸šæœ‰ä¸åŒæ•ˆç‡</p>
                        <p>â€¢ ä¿æŒå¥åº·åº¦å’Œå£«æ°”ç¨³å®š</p>
                        <p>â€¢ é€šè¿‡å»ºç­‘å¢åŠ äººå£å®¹é‡</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ—ï¸</span> å»ºç­‘ç³»ç»Ÿ</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ å»ºç­‘éœ€è¦å»ºé€ åæ‰èƒ½å‡ºç°ç­‰çº§</p>
                        <p>â€¢ å»ºç­‘å¯ä»¥å‡çº§æå‡æ•ˆç‡</p>
                        <p>â€¢ ä¸åŒå»ºç­‘æä¾›ä¸åŒåŠŸèƒ½</p>
                        <p>â€¢ åˆç†å®‰æ’å»ºç­‘å¸ƒå±€</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ”¬</span> ç§‘æŠ€ç ”ç©¶</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ ä½¿ç”¨ç§‘æŠ€ç‚¹æ•°ç ”ç©¶æ–°ç§‘æŠ€</p>
                        <p>â€¢ ç§‘æŠ€å¯ä»¥è§£é”æ–°å»ºç­‘å’ŒåŠŸèƒ½</p>
                        <p>â€¢ ç ”ç©¶éœ€è¦æ—¶é—´å®Œæˆ</p>
                        <p>â€¢ åˆç†è§„åˆ’ç ”ç©¶è·¯çº¿</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ§­</span> æ¢ç´¢ç³»ç»Ÿ</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ ç«‹å³æ¢ç´¢ï¼šé«˜é£é™©é«˜å›æŠ¥ï¼</p>
                        <p>â€¢ æˆåŠŸæ¦‚ç‡ï¼š100% - å±é™©ç­‰çº§Ã—10%</p>
                        <p>â€¢ æˆåŠŸï¼šè·å¾—20%èµ„æºå¥–åŠ±</p>
                        <p>â€¢ å¤±è´¥ï¼šæŸå¤±10%èµ„æº</p>
                        <p>â€¢ æ¢ç´¢æ˜¯è·å–ææ–™çš„ä¸»è¦é€”å¾„</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>â›ï¸</span> ææ–™è·å–</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ æ¢ç´¢åºŸå¼ƒåœ°ç‚¹è·å–ææ–™</p>
                        <p>â€¢ å»ºé€ å›æ”¶ç«™è‡ªåŠ¨ç”Ÿäº§ææ–™</p>
                        <p>â€¢ æ´¾é£å¹¸å­˜è€…åˆ°ææ–™æ”¶é›†ç‚¹</p>
                        <p>â€¢ ææ–™æ˜¯å»ºé€ å’Œå‡çº§å»ºç­‘çš„å…³é”®</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ‘¾</span> æ€ªç‰©ç³»ç»Ÿ</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ æ€ªç‰©ä¼šå®šæœŸè¢­å‡»åŸºåœ°</p>
                        <p>â€¢ å»ºé€ é˜²å¾¡è®¾æ–½è¿›è¡ŒæŠµå¾¡</p>
                        <p>â€¢ å‡çº§é˜²å¾¡è®¾æ–½å¢å¼ºé˜²æŠ¤</p>
                        <p>â€¢ æ¢ç´¢åºŸåœŸå‘ç°å¨èƒ</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ</span> DLCç³»ç»Ÿ</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ æ”¯æŒæ‹–æ‹½æœ¬åœ°JSONæ–‡ä»¶å®‰è£…DLC</p>
                        <p>â€¢ æ”¯æŒURLé“¾æ¥å®‰è£…DLC</p>
                        <p>â€¢ DLCå¯ä»¥æ‰©å±•æ¸¸æˆå†…å®¹</p>
                        <p>â€¢ å·²å®‰è£…çš„DLCå¯ä»¥éšæ—¶å¯ç”¨/ç¦ç”¨</p>
                    </div>
                </div>
                
                <div class="help-section">
                    <div class="help-section-title"><span>ğŸ’¾</span> å­˜æ¡£ç³»ç»Ÿ</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p>â€¢ è‡ªåŠ¨å­˜æ¡£æ¯30åˆ†é’Ÿä¿å­˜ä¸€æ¬¡</p>
                        <p>â€¢ å¯ä»¥æ‰‹åŠ¨ä¿å­˜å¤šä¸ªå­˜æ¡£</p>
                        <p>â€¢ éšæ—¶åŠ è½½ä¹‹å‰çš„è¿›åº¦</p>
                        <p>â€¢ é˜²æ­¢æ„å¤–ä¸¢å¤±è¿›åº¦</p>
                    </div>
                </div>
                
                <div class="help-tip">
                    ç¥æ‚¨åœ¨åºŸåœŸä¸–ç•Œä¸­ç”Ÿå­˜é¡ºåˆ©ï¼è®°ä½ï¼šç”Ÿå­˜æ˜¯ç¬¬ä¸€è¦åŠ¡ï¼
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====== æ¸¸æˆæ•°æ® - ç¬¬ä¸€å¤©åˆå§‹åŒ– ======
        const gameData = {
            currentView: 'base',
            zoom: 1.0,
            offset: { x: 0, y: 0 },
            isPaused: false,
            gameTime: { hour: 7, minute: 0, day: 1 },
            showGrid: true,
            orientation: 'landscape',
            autoSaveEnabled: false,
            autoSaveInterval: null,
            gameSpeed: 500,
            gameTimer: null,
            
            resources: {
                food: { current: 50, max: 100, production: 2, consumption: 5 },
                water: { current: 40, max: 100, production: 2, consumption: 5 },
                power: { current: 30, max: 100, production: 5, consumption: 3 },
                material: { current: 20, max: 100000, production: 1, consumption: 1 }
            },
            
            survivors: [
                { id: 1, name: 'å®‰é¥¶', job: 'é¢†å¯¼è€…', icon: 'ğŸ‘¨â€ğŸ’¼', health: 90, morale: 80, assignedTo: 'æŒ‡æŒ¥ä¸­å¿ƒ', skills: { leadership: 8, combat: 3, construction: 4 }, status: 'å·¥ä½œä¸­' },
                { id: 2, name: 'æå¨œ', job: 'åŒ»ç”Ÿ', icon: 'ğŸ‘©â€âš•ï¸', health: 85, morale: 75, assignedTo: 'åŒ»ç–—ç«™', skills: { medical: 9, research: 5, cooking: 4 }, status: 'å·¥ä½œä¸­' },
                { id: 3, name: 'ç‹å¼º', job: 'å·¥ç¨‹å¸ˆ', icon: 'ğŸ‘¨â€ğŸ”§', health: 80, morale: 70, assignedTo: 'å‘ç”µå‚', skills: { engineering: 8, construction: 7, combat: 3 }, status: 'å·¥ä½œä¸­' },
                { id: 4, name: 'å§œä¼¯çº¦', job: 'å†œæ°‘', icon: 'ğŸ‘©â€ğŸŒ¾', health: 75, morale: 65, assignedTo: 'å†œåœº', skills: { farming: 8, cooking: 6, survival: 5 }, status: 'å·¥ä½œä¸­' },
                { id: 5, name: 'ç”˜é›¨', job: 'å®ˆå«', icon: 'ğŸ‘®', health: 85, morale: 70, assignedTo: 'å“¨å¡”', skills: { combat: 7, surveillance: 6, survival: 5 }, status: 'å·¥ä½œä¸­' }
            ],
            
            buildings: {
                base: [
                    { id: 1, type: 'core', name: 'æŒ‡æŒ¥ä¸­å¿ƒ', icon: 'ğŸ›ï¸', x: 400, y: 300, level: 1, zone: 'æ ¸å¿ƒåŒº', built: true },
                    { id: 2, type: 'residential', name: 'ç®€æ˜“æ£šå±‹', icon: 'ğŸ ', x: 400, y: 180, level: 0, zone: 'å±…ä½åŒº', built: false },
                    { id: 3, type: 'industrial', name: 'å°å‹å‘ç”µæœº', icon: 'âš¡', x: 520, y: 300, level: 0, zone: 'å·¥ä¸šåŒº', built: false },
                    { id: 4, type: 'defense', name: 'ç®€æ˜“å“¨å¡”', icon: 'ğŸ›¡ï¸', x: 400, y: 420, level: 0, zone: 'é˜²å¾¡åŒº', built: false },
                    { id: 5, type: 'storage', name: 'ä¸´æ—¶ä»“åº“', icon: 'ğŸ“¦', x: 280, y: 300, level: 0, zone: 'ä»“å‚¨åŒº', built: false },
                    { id: 6, type: 'farm', name: 'å°å‹èœå›­', icon: 'ğŸŒ¾', x: 340, y: 220, level: 0, zone: 'å±…ä½åŒº', built: false },
                    { id: 7, type: 'hospital', name: 'åŒ»ç–—å¸ç¯·', icon: 'ğŸ¥', x: 460, y: 380, level: 0, zone: 'æ ¸å¿ƒåŒº', built: false },
                    { id: 8, type: 'recycling', name: 'å›æ”¶ç«™', icon: 'â™»ï¸', x: 280, y: 220, level: 0, zone: 'å·¥ä¸šåŒº', built: false }
                ],
                
                defense: [
                    { id: 11, type: 'outer', name: 'ç®€æ˜“æ …æ ', icon: 'âš ï¸', x: 400, y: 100, level: 0, coverage: '50m', built: false },
                    { id: 12, type: 'middle', name: 'ç­æœ›å°', icon: 'ğŸ”­', x: 550, y: 250, level: 0, coverage: '100m', built: false },
                    { id: 13, type: 'middle', name: 'é˜²å¾¡å·¥äº‹', icon: 'ğŸ”«', x: 400, y: 300, level: 0, coverage: '80m', built: false },
                    { id: 14, type: 'inner', name: 'å®ˆå«å²—', icon: 'ğŸ‘®', x: 250, y: 250, level: 0, coverage: '30m', built: false }
                ],
                
                resource: [
                    { id: 21, type: 'food', name: 'å°å‹èœå›­', icon: 'ğŸŒ¾', x: 300, y: 200, level: 0, output: 'é£Ÿç‰©+2/h', built: false },
                    { id: 22, type: 'water', name: 'å‡€æ°´è£…ç½®', icon: 'ğŸ’§', x: 500, y: 200, level: 0, output: 'å‡€æ°´+2/h', built: false },
                    { id: 23, type: 'power', name: 'å°å‹å‘ç”µæœº', icon: 'âš¡', x: 400, y: 300, level: 0, output: 'ç”µåŠ›+5/h', built: false },
                    { id: 24, type: 'material', name: 'ææ–™æ”¶é›†ç‚¹', icon: 'â›ï¸', x: 300, y: 400, level: 1, output: 'ææ–™+2/h', built: true },
                    { id: 25, type: 'storage', name: 'ä¸´æ—¶ä»“åº“', icon: 'ğŸ“¦', x: 500, y: 400, level: 0, output: 'å®¹é‡:100', built: false },
                    { id: 26, type: 'recycling', name: 'å›æ”¶ç«™', icon: 'â™»ï¸', x: 450, y: 450, level: 0, output: 'ææ–™+3/h', built: false }
                ],
                
                exploration: [
                    { id: 31, type: 'hospital', name: 'åºŸå¼ƒåŒ»é™¢', icon: 'ğŸ¥', x: 150, y: 150, danger: 3, reward: 'åŒ»ç–—ç”¨å“' },
                    { id: 32, type: 'warehouse', name: 'æ—§ä»“åº“', icon: 'ğŸ­', x: 650, y: 150, danger: 2, reward: 'å»ºç­‘ææ–™' },
                    { id: 33, type: 'farm', name: 'åºŸå¼ƒå†œåœº', icon: 'ğŸŒ¾', x: 150, y: 450, danger: 2, reward: 'é£Ÿç‰©ç§å­' },
                    { id: 34, type: 'factory', name: 'æ—§å·¥å‚', icon: 'âš™ï¸', x: 650, y: 450, danger: 4, reward: 'æœºæ¢°è®¾å¤‡' },
                    { id: 35, type: 'research', name: 'ç§‘ç ”æœºæ„', icon: 'ğŸ”¬', x: 400, y: 100, danger: 5, reward: 'ç§‘æŠ€è“å›¾' },
                    { id: 36, type: 'military', name: 'å†›äº‹å“¨æ‰€', icon: 'ğŸ–ï¸', x: 400, y: 500, danger: 4, reward: 'æ­¦å™¨è£…å¤‡' },
                    { id: 37, type: 'scrapyard', name: 'åºŸæ–™åœº', icon: 'ğŸ—‘ï¸', x: 100, y: 300, danger: 1, reward: 'å¤§é‡ææ–™' }
                ]
            },
            
            availableBuildings: [
                { id: 101, name: 'ç®€æ˜“æ£šå±‹', icon: 'ğŸ ', cost: { material: 20 }, time: 1, type: 'residential', description: 'æä¾›ä½å®¿ï¼Œå¢åŠ 5äººå£å®¹é‡' },
                { id: 102, name: 'å°å‹å‘ç”µæœº', icon: 'âš¡', cost: { material: 30 }, time: 2, type: 'industrial', description: 'æä¾›ç”µåŠ›æ”¯æŒ' },
                { id: 103, name: 'å°å‹èœå›­', icon: 'ğŸŒ¾', cost: { material: 15 }, time: 1, type: 'farm', description: 'ç”Ÿäº§é£Ÿç‰©ï¼Œæ¯å°æ—¶+2é£Ÿç‰©' },
                { id: 104, name: 'å‡€æ°´è£…ç½®', icon: 'ğŸ’§', cost: { material: 25 }, time: 2, type: 'water', description: 'å‡€åŒ–æ°´æºï¼Œæ¯å°æ—¶+2å‡€æ°´' },
                { id: 105, name: 'ä¸´æ—¶ä»“åº“', icon: 'ğŸ“¦', cost: { material: 20 }, time: 1, type: 'storage', description: 'å­˜å‚¨èµ„æºï¼Œå¢åŠ å­˜å‚¨ä¸Šé™' },
                { id: 106, name: 'åŒ»ç–—å¸ç¯·', icon: 'ğŸ¥', cost: { material: 30 }, time: 2, type: 'hospital', description: 'æ²»ç–—ä¼¤å‘˜ï¼Œæå‡å¥åº·åº¦' },
                { id: 107, name: 'ç®€æ˜“æ …æ ', icon: 'âš ï¸', cost: { material: 25 }, time: 1, type: 'defense', description: 'åŸºç¡€é˜²å¾¡ï¼Œæå‡é˜²å¾¡ç­‰çº§' },
                { id: 108, name: 'ç­æœ›å°', icon: 'ğŸ”­', cost: { material: 40 }, time: 3, type: 'defense', description: 'ä¾¦æŸ¥å¨èƒï¼Œæå‰é¢„è­¦' },
                { id: 109, name: 'å›æ”¶ç«™', icon: 'â™»ï¸', cost: { material: 35 }, time: 2, type: 'recycling', description: 'å›æ”¶åºŸæ–™ï¼Œæ¯å°æ—¶+3ææ–™' },
                { id: 110, name: 'ææ–™åŠ å·¥å‚', icon: 'ğŸ­', cost: { material: 60 }, time: 4, type: 'material', description: 'é«˜æ•ˆç”Ÿäº§ï¼Œæ¯å°æ—¶+5ææ–™' }
            ],
            
            technologies: [
                { id: 1, name: 'åŸºç¡€å†œä¸š', icon: 'ğŸŒ±', cost: 10, time: 5, unlocked: true, description: 'è§£é”åŸºç¡€å†œåœºå’Œç§æ¤æŠ€æœ¯' },
                { id: 2, name: 'æ°´åŠ›å‡€åŒ–', icon: 'ğŸ’§', cost: 15, time: 8, unlocked: false, description: 'è§£é”å‡€æ°´å‚å’Œå‚¨æ°´æŠ€æœ¯' },
                { id: 3, name: 'åŸºç¡€ç”µåŠ›', icon: 'âš¡', cost: 20, time: 10, unlocked: false, description: 'è§£é”å‘ç”µæœºå’Œç”µåŠ›åˆ†é…' },
                { id: 4, name: 'åŸºç¡€åŒ»ç–—', icon: 'ğŸ¥', cost: 15, time: 8, unlocked: false, description: 'è§£é”åŒ»ç–—è®¾æ–½å’ŒåŸºç¡€æ²»ç–—' },
                { id: 5, name: 'åŸºç¡€é˜²å¾¡', icon: 'ğŸ›¡ï¸', cost: 25, time: 12, unlocked: false, description: 'è§£é”é˜²å¾¡å·¥äº‹å’Œæ­¦å™¨' },
                { id: 6, name: 'ææ–™åŠ å·¥', icon: 'â›ï¸', cost: 20, time: 10, unlocked: false, description: 'è§£é”ææ–™åŠ å·¥å’Œå›æ”¶' },
                { id: 7, name: 'é€šè®¯æŠ€æœ¯', icon: 'ğŸ“¡', cost: 30, time: 15, unlocked: false, description: 'è§£é”é€šè®¯è®¾å¤‡å’Œé›·è¾¾' },
                { id: 8, name: 'é«˜çº§å†œä¸š', icon: 'ğŸŒ¾', cost: 40, time: 20, unlocked: false, description: 'è§£é”æ¸©å®¤å’Œé«˜æ•ˆç§æ¤' },
                { id: 9, name: 'èƒ½æºå‚¨å­˜', icon: 'ğŸ”‹', cost: 35, time: 18, unlocked: false, description: 'è§£é”ç”µæ± å’Œèƒ½æºç®¡ç†' },
                { id: 10, name: 'å†›äº‹è®­ç»ƒ', icon: 'âš”ï¸', cost: 50, time: 25, unlocked: false, description: 'è§£é”æˆ˜æ–—è®­ç»ƒå’Œæˆ˜æœ¯' }
            ],
            
            achievements: [
                { id: 1, name: 'ç¬¬ä¸€å¤©', icon: 'â˜€ï¸', unlocked: true, description: 'åœ¨åºŸåœŸä¸­ç”Ÿå­˜ç¬¬ä¸€å¤©' },
                { id: 2, name: 'åŸºåœ°å»ºç«‹', icon: 'ğŸ ', unlocked: true, description: 'å»ºç«‹ç¬¬ä¸€ä¸ªåŸºåœ°' },
                { id: 3, name: 'èµ„æºæ”¶é›†', icon: 'ğŸ“¦', unlocked: false, description: 'æ”¶é›†100å•ä½èµ„æº' },
                { id: 4, name: 'äººå£å¢é•¿', icon: 'ğŸ‘¥', unlocked: false, description: 'äººå£è¾¾åˆ°10äºº' },
                { id: 5, name: 'ç§‘æŠ€å…ˆé©±', icon: 'ğŸ”¬', unlocked: false, description: 'ç ”ç©¶ç¬¬ä¸€ä¸ªç§‘æŠ€' },
                { id: 6, name: 'é˜²å¾¡å¤§å¸ˆ', icon: 'ğŸ›¡ï¸', unlocked: false, description: 'é˜²å¾¡ç­‰çº§è¾¾åˆ°5çº§' },
                { id: 7, name: 'å†œä¸šä¸“å®¶', icon: 'ğŸŒ¾', unlocked: false, description: 'é£Ÿç‰©äº§é‡è¾¾åˆ°æ¯å°æ—¶10å•ä½' },
                { id: 8, name: 'ç”µåŠ›å…ˆé”‹', icon: 'âš¡', unlocked: false, description: 'ç”µåŠ›äº§é‡è¾¾åˆ°æ¯å°æ—¶50å•ä½' },
                { id: 9, name: 'æ¢ç´¢è€…', icon: 'ğŸ§­', unlocked: false, description: 'å®Œæˆ5æ¬¡æ¢ç´¢ä»»åŠ¡' },
                { id: 10, name: 'æ€ªç‰©çŒäºº', icon: 'ğŸ‘¾', unlocked: false, description: 'å‡»é€€10æ¬¡æ€ªç‰©è¢­å‡»' },
                { id: 11, name: 'ææ–™å¤§äº¨', icon: 'â›ï¸', unlocked: false, description: 'æ”¶é›†500å•ä½ææ–™' },
                { id: 12, name: 'å›æ”¶ä¸“å®¶', icon: 'â™»ï¸', unlocked: false, description: 'å»ºé€ å›æ”¶ç«™å¹¶æ”¶é›†100ææ–™' }
            ],
            
            monsters: [
                { id: 1, name: 'è¾å°„é¼ ', icon: 'ğŸ€', threat: 1, description: 'å°å‹å˜å¼‚ç”Ÿç‰©ï¼Œæ”»å‡»åŠ›å¼±ä½†æ•°é‡å¤š' },
                { id: 2, name: 'å˜å¼‚çŠ¬', icon: 'ğŸ•', threat: 2, description: 'ä¸­å‹å˜å¼‚ç”Ÿç‰©ï¼Œé€Ÿåº¦å¿«æ”»å‡»åŠ›ä¸­ç­‰' },
                { id: 3, name: 'è¾å°„åƒµå°¸', icon: 'ğŸ§Ÿ', threat: 3, description: 'äººç±»å˜å¼‚ä½“ï¼Œç§»åŠ¨æ…¢ä½†ç”Ÿå‘½åŠ›å¼º' },
                { id: 4, name: 'å·¨å‹èœ˜è››', icon: 'ğŸ•·ï¸', threat: 4, description: 'å¤§å‹å˜å¼‚ç”Ÿç‰©ï¼Œæ”»å‡»åŠ›å¼ºæœ‰æ¯’æ¶²' },
                { id: 5, name: 'å˜å¼‚ç†Š', icon: 'ğŸ»', threat: 5, description: 'å¤§å‹å˜å¼‚ç”Ÿç‰©ï¼Œæ”»å‡»åŠ›å’Œé˜²å¾¡åŠ›éƒ½å¾ˆé«˜' }
            ],
            
            // æ¢ç´¢ç³»ç»Ÿ - ç«‹å³å®Œæˆï¼Œé«˜é£é™©é«˜å›æŠ¥
            explorationLocations: [
                { 
                    id: 1, 
                    name: 'åºŸå¼ƒè¶…å¸‚', 
                    icon: 'ğŸ›’', 
                    distance: 'è¿‘', 
                    danger: 2, 
                    successChance: 80,
                    description: 'å¯èƒ½æ‰¾åˆ°é£Ÿç‰©å’Œæ—¥å¸¸ç”¨å“',
                    rewards: { food: 30, water: 20, material: 15 },
                    risks: { food: 5, water: 5, material: 2 },
                },
                { 
                    id: 2, 
                    name: 'æ—§åŒ»é™¢', 
                    icon: 'ğŸ¥', 
                    distance: 'ä¸­', 
                    danger: 3, 
                    successChance: 70,
                    description: 'å¯èƒ½æ‰¾åˆ°åŒ»ç–—ç”¨å“å’Œè¯å“',
                    rewards: { food: 15, water: 25, material: 20, special: 'åŒ»ç–—åŒ…' },
                    risks: { food: 5, water: 5, material: 3 },
                },
                { 
                    id: 3, 
                    name: 'å†›äº‹ä»“åº“', 
                    icon: 'ğŸ–ï¸', 
                    distance: 'è¿œ', 
                    danger: 4, 
                    successChance: 60,
                    description: 'å¯èƒ½æ‰¾åˆ°æ­¦å™¨å’Œé˜²æŠ¤è£…å¤‡',
                    rewards: { material: 40, food: 10, water: 10, special: 'æ­¦å™¨' },
                    risks: { food: 8, water: 8, material: 4 },
                },
                { 
                    id: 4, 
                    name: 'ç§‘æŠ€ç ”ç©¶æ‰€', 
                    icon: 'ğŸ”¬', 
                    distance: 'è¿œ', 
                    danger: 5, 
                    successChance: 50,
                    description: 'å¯èƒ½æ‰¾åˆ°ç§‘æŠ€è“å›¾å’Œè®¾å¤‡',
                    rewards: { tech: 30, material: 25, special: 'ç§‘æŠ€è“å›¾' },
                    risks: { food: 10, water: 10, material: 5 },
                },
                { 
                    id: 5, 
                    name: 'å†œåœºåºŸå¢Ÿ', 
                    icon: 'ğŸŒ¾', 
                    distance: 'ä¸­', 
                    danger: 2, 
                    successChance: 80,
                    description: 'å¯èƒ½æ‰¾åˆ°é£Ÿç‰©ç§å­å’Œå·¥å…·',
                    rewards: { food: 40, water: 15, material: 20 },
                    risks: { food: 4, water: 4, material: 2 },
                },
                { 
                    id: 6, 
                    name: 'å‘ç”µç«™åºŸå¢Ÿ', 
                    icon: 'âš¡', 
                    distance: 'è¿œ', 
                    danger: 3, 
                    successChance: 70,
                    description: 'å¯èƒ½æ‰¾åˆ°ç”µåŠ›è®¾å¤‡å’Œé›¶ä»¶',
                    rewards: { material: 35, power: 20, special: 'å‘ç”µæœºé›¶ä»¶' },
                    risks: { food: 6, water: 6, material: 3 },
                },
                { 
                    id: 7, 
                    name: 'åºŸæ–™å›æ”¶åœº', 
                    icon: 'ğŸ—‘ï¸', 
                    distance: 'è¿‘', 
                    danger: 1, 
                    successChance: 90,
                    description: 'å¤§é‡åºŸå¼ƒææ–™å¯ä¾›å›æ”¶',
                    rewards: { material: 50, food: 10, water: 10 },
                    risks: { food: 2, water: 2, material: 1 },
                },
                { 
                    id: 8, 
                    name: 'å»ºç­‘å·¥åœ°', 
                    icon: 'ğŸ—ï¸', 
                    distance: 'ä¸­', 
                    danger: 3, 
                    successChance: 70,
                    description: 'æœªå®Œå·¥çš„å»ºç­‘ï¼Œæœ‰ä¸°å¯Œå»ºç­‘ææ–™',
                    rewards: { material: 45, food: 5, water: 5 },
                    risks: { food: 6, water: 6, material: 3 },
                }
            ],
            
            currentExploration: null,
            explorationTeam: [],
            
            threatLevel: 1,
            nextAttack: 2,
            
            techPoints: 100,
            
            installedDLCs: [
                {
                    id: 'material-production-pack',
                    name: 'ææ–™ç”Ÿäº§æ‰©å±•',
                    version: '1.0',
                    author: 'å¼€å‘è€…å›¢é˜Ÿ',
                    icon: 'ğŸ­',
                    description: 'æ·»åŠ é«˜æ•ˆææ–™ç”Ÿäº§å’Œå›æ”¶å»ºç­‘',
                    enabled: true,
                    content: {
                        buildings: [
                            { 
                                id: 1000, 
                                name: 'é«˜æ•ˆå›æ”¶ç«™', 
                                icon: 'â™»ï¸', 
                                cost: { material: 50 }, 
                                time: 3, 
                                type: 'recycling', 
                                description: 'é«˜æ•ˆå›æ”¶åºŸæ–™ï¼Œæ¯å°æ—¶+5ææ–™'
                            }
                        ]
                    }
                }
            ],
            
            viewInfo: {
                base: {
                    title: 'åŸºåœ°åœ°å›¾',
                    desc: 'å»ºç«‹æ‚¨çš„ç”Ÿå­˜åŸºåœ°',
                    zones: ['æ ¸å¿ƒåŒº', 'å±…ä½åŒº', 'å·¥ä¸šåŒº', 'é˜²å¾¡åŒº', 'ä»“å‚¨åŒº']
                },
                defense: {
                    title: 'é˜²å¾¡å¸ƒå±€',
                    desc: 'å»ºç«‹é˜²å¾¡ä½“ç³»åº”å¯¹å¨èƒ',
                    zones: ['å¤–å±‚é¢„è­¦', 'ä¸­å±‚é˜²å¾¡', 'å†…å±‚é˜²æŠ¤']
                },
                resource: {
                    title: 'èµ„æºåˆ†å¸ƒ',
                    desc: 'ç®¡ç†èµ„æºç”Ÿäº§å’Œæ¶ˆè€—',
                    zones: ['é£Ÿç‰©ç”Ÿäº§', 'æ°´æºä¾›åº”', 'ç”µåŠ›ç³»ç»Ÿ', 'ææ–™é‡‡é›†']
                },
                exploration: {
                    title: 'æ¢ç´¢åœ°å›¾',
                    desc: 'æ´¾é£å°é˜Ÿæ¢ç´¢åºŸåœŸå»ºç­‘',
                    zones: ['åºŸå¼ƒå»ºç­‘', 'èµ„æºç‚¹', 'å±é™©åŒºåŸŸ', 'æœªçŸ¥åœ°åŒº']
                }
            },
            
            saves: []
        };
        
        // ====== æ¸¸æˆæ—¶é—´ç³»ç»Ÿ ======
        function updateGameTime() {
            if (!gameData.isPaused) {
                gameData.gameTime.minute += 1;
                
                if (gameData.gameTime.minute >= 60) {
                    gameData.gameTime.minute = 0;
                    gameData.gameTime.hour += 1;
                    
                    updateResources();
                    
                    if (gameData.gameTime.hour >= 24) {
                        gameData.gameTime.hour = 0;
                        gameData.gameTime.day += 1;
                        
                        document.querySelector('.status-value[style*="color:#3498db"]').textContent = `ç¬¬${gameData.gameTime.day}å¤©`;
                        
                        if (gameData.nextAttack > 0) {
                            gameData.nextAttack--;
                            document.getElementById('next-attack').textContent = `${gameData.nextAttack}å¤©å`;
                        }
                        
                        showNotification('æ–°çš„ä¸€å¤©', `å¹¸å­˜è€…ä»¬è¿æ¥äº†ç¬¬${gameData.gameTime.day}å¤©`, 'â˜€ï¸');
                        
                        if (gameData.autoSaveEnabled) {
                            autoSaveGame();
                        }
                    }
                }
                
                const hourStr = gameData.gameTime.hour.toString().padStart(2, '0');
                const minuteStr = gameData.gameTime.minute.toString().padStart(2, '0');
                document.getElementById('game-time').textContent = `${hourStr}:${minuteStr}`;
            }
        }
        
        // ====== èµ„æºæ›´æ–°ç³»ç»Ÿ ======
        function updateResources() {
            let foodProduction = 0;
            let waterProduction = 0;
            let powerProduction = 0;
            let materialProduction = 0;
            
            for (const view in gameData.buildings) {
                gameData.buildings[view].forEach(building => {
                    if (building.built && building.level > 0) {
                        switch(building.type) {
                            case 'farm':
                            case 'food':
                                foodProduction += 2 * building.level;
                                break;
                            case 'water':
                                waterProduction += 2 * building.level;
                                break;
                            case 'industrial':
                            case 'power':
                                powerProduction += 5 * building.level;
                                break;
                            case 'material':
                                materialProduction += 2 * building.level;
                                break;
                            case 'recycling':
                                materialProduction += 3 * building.level;
                                break;
                        }
                    }
                });
            }
            
            gameData.resources.food.production = foodProduction;
            gameData.resources.water.production = waterProduction;
            gameData.resources.power.production = powerProduction;
            gameData.resources.material.production = materialProduction;
            
            const workingSurvivors = gameData.survivors.filter(s => 
                s.status === 'å·¥ä½œä¸­' && s.assignedTo !== 'æ¢ç´¢é˜Ÿ'
            ).length;
            
            gameData.resources.food.consumption = workingSurvivors;
            gameData.resources.water.consumption = workingSurvivors;
            gameData.resources.power.consumption = Math.floor(workingSurvivors / 2) + 1;
            gameData.resources.material.consumption = Math.floor(workingSurvivors / 3) + 1;
            
            gameData.resources.food.current += foodProduction - gameData.resources.food.consumption;
            gameData.resources.water.current += waterProduction - gameData.resources.water.consumption;
            gameData.resources.power.current += powerProduction - gameData.resources.power.consumption;
            gameData.resources.material.current += materialProduction - gameData.resources.material.consumption;
            
            for (const resource in gameData.resources) {
                if (gameData.resources[resource].current < 0) {
                    gameData.resources[resource].current = 0;
                    showNotification('èµ„æºè€—å°½', `${resource}å·²è€—å°½ï¼Œå¹¸å­˜è€…å°†å—åˆ°å½±å“ï¼`, 'âš ï¸');
                }
                if (gameData.resources[resource].current > gameData.resources[resource].max) {
                    gameData.resources[resource].current = gameData.resources[resource].max;
                }
            }
            
            updateResourceDisplay();
            
            if (gameData.resources.material.current >= 500) {
                unlockAchievement(11);
            }
        }
        
        function updateResourceDisplay() {
            document.getElementById('food-amount').textContent = `${gameData.resources.food.current}/${gameData.resources.food.max}`;
            document.getElementById('water-amount').textContent = `${gameData.resources.water.current}/${gameData.resources.water.max}`;
            document.getElementById('power-amount').textContent = `${gameData.resources.power.current}/${gameData.resources.power.max}`;
            document.getElementById('material-amount').textContent = `${gameData.resources.material.current}/${gameData.resources.material.max}`;
            
            document.getElementById('material-status').textContent = gameData.resources.material.current;
            
            document.getElementById('food-bar').style.width = `${(gameData.resources.food.current / gameData.resources.food.max) * 100}%`;
            document.getElementById('water-bar').style.width = `${(gameData.resources.water.current / gameData.resources.water.max) * 100}%`;
            document.getElementById('power-bar').style.width = `${(gameData.resources.power.current / gameData.resources.power.max) * 100}%`;
            document.getElementById('material-bar').style.width = `${(gameData.resources.material.current / gameData.resources.material.max) * 100}%`;
            
            document.getElementById('material-progress').textContent = `${gameData.resources.material.current}/${gameData.resources.material.max}`;
            document.getElementById('material-progress-bar').style.width = `${(gameData.resources.material.current / gameData.resources.material.max) * 100}%`;
            
            document.getElementById('food-production').textContent = `+${gameData.resources.food.production}`;
            document.getElementById('food-consumption').textContent = `-${gameData.resources.food.consumption}`;
            document.getElementById('water-production').textContent = `+${gameData.resources.water.production}`;
            document.getElementById('water-consumption').textContent = `-${gameData.resources.water.consumption}`;
            document.getElementById('power-production').textContent = `+${gameData.resources.power.production}`;
            document.getElementById('power-consumption').textContent = `-${gameData.resources.power.consumption}`;
            document.getElementById('material-production').textContent = `+${gameData.resources.material.production}`;
            document.getElementById('material-consumption').textContent = `-${gameData.resources.material.consumption}`;
            
            const totalResources = (
                gameData.resources.food.current / gameData.resources.food.max +
                gameData.resources.water.current / gameData.resources.water.max +
                gameData.resources.power.current / gameData.resources.power.max +
                gameData.resources.material.current / gameData.resources.material.max
            ) / 4 * 100;
            
            document.querySelector('.status-value[style*="color:#f39c12"]').textContent = `${Math.round(totalResources)}%`;
            
            document.querySelector('#dynamic-stats .progress-fill:nth-child(1)').style.width = `${(gameData.resources.food.current / gameData.resources.food.max) * 100}%`;
            document.querySelector('#dynamic-stats .progress-fill:nth-child(2)').style.width = `${(gameData.resources.power.current / gameData.resources.power.max) * 100}%`;
        }
        
        // ====== ç”»å¸ƒç»˜åˆ¶ ======
        const canvas = document.getElementById('map-canvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            drawMap();
        }
        
        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.save();
            ctx.translate(gameData.offset.x, gameData.offset.y);
            ctx.scale(gameData.zoom, gameData.zoom);
            
            if (gameData.showGrid) {
                drawGrid();
            }
            
            switch(gameData.currentView) {
                case 'base':
                    drawBaseMap();
                    break;
                case 'defense':
                    drawDefenseMap();
                    break;
                case 'resource':
                    drawResourceMap();
                    break;
                case 'exploration':
                    drawExplorationMap();
                    break;
            }
            
            drawBuildings();
            ctx.restore();
        }
        
        function drawGrid() {
            const gridSize = 50;
            const startX = Math.floor(-gameData.offset.x / gameData.zoom / gridSize) * gridSize;
            const startY = Math.floor(-gameData.offset.y / gameData.zoom / gridSize) * gridSize;
            const endX = startX + Math.ceil(canvas.width / gameData.zoom / gridSize) * gridSize;
            const endY = startY + Math.ceil(canvas.height / gameData.zoom / gridSize) * gridSize;
            
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            
            for (let x = startX; x <= endX; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, startY);
                ctx.lineTo(x, endY);
                ctx.stroke();
            }
            
            for (let y = startY; y <= endY; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(startX, y);
                ctx.lineTo(endX, y);
                ctx.stroke();
            }
        }
        
        function drawBaseMap() {
            const centerX = 400, centerY = 300;
            
            ctx.fillStyle = 'rgba(52, 152, 219, 0.1)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 200, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 200, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ç”Ÿå­˜åŸºåœ°', centerX, centerY);
            ctx.fillText('ç¬¬1å¤©', centerX, centerY + 20);
        }
        
        function drawDefenseMap() {
            const centerX = 400, centerY = 300;
            
            ctx.strokeStyle = 'rgba(231, 76, 60, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 150, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = 'rgba(231, 76, 60, 0.1)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 150, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('é˜²å¾¡èŒƒå›´', centerX, centerY);
            ctx.fillText('ç­‰çº§: 1', centerX, centerY + 20);
        }
        
        function drawResourceMap() {
            const centerX = 400, centerY = 300;
            
            const resources = [
                { type: 'food', color: '#2ecc71', x: 300, y: 200 },
                { type: 'water', color: '#3498db', x: 500, y: 200 },
                { type: 'power', color: '#f1c40f', x: 300, y: 400 },
                { type: 'material', color: '#e67e22', x: 500, y: 400 }
            ];
            
            resources.forEach(res => {
                ctx.fillStyle = res.color + '20';
                ctx.beginPath();
                ctx.arc(res.x, res.y, 60, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = res.color + '60';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(res.x, res.y, 60, 0, Math.PI * 2);
                ctx.stroke();
            });
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('èµ„æºåˆ†å¸ƒ', centerX, centerY);
        }
        
        function drawExplorationMap() {
            const centerX = 400, centerY = 300;
            
            ctx.strokeStyle = 'rgba(46, 204, 113, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 250, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = 'rgba(46, 204, 113, 0.1)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 250, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('æ¢ç´¢åŒºåŸŸ', centerX, centerY);
            ctx.fillText('ç‚¹å‡»å»ºç­‘è¿›è¡Œæ¢ç´¢', centerX, centerY + 20);
            
            const buildings = gameData.buildings.exploration || [];
            buildings.forEach(building => {
                if (building.discovered) {
                    ctx.fillStyle = getBuildingColor(building.type) + '80';
                    ctx.beginPath();
                    ctx.arc(building.x, building.y, 20, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(building.icon, building.x, building.y);
                } else {
                    ctx.fillStyle = 'rgba(149, 165, 166, 0.5)';
                    ctx.beginPath();
                    ctx.arc(building.x, building.y, 20, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'rgba(149, 165, 166, 0.8)';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('â“', building.x, building.y);
                }
            });
        }
        
        function drawBuildings() {
            const buildings = gameData.buildings[gameData.currentView] || [];
            
            buildings.forEach(building => {
                if (building.built && building.level > 0) {
                    ctx.fillStyle = getBuildingColor(building.type);
                    ctx.beginPath();
                    ctx.arc(building.x, building.y, 20, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(building.icon, building.x, building.y);
                    
                    ctx.fillStyle = '#FFD700';
                    ctx.font = '10px Arial';
                    ctx.fillText(`Lv.${building.level}`, building.x, building.y + 25);
                } else if (building.type !== 'exploration') {
                    ctx.fillStyle = 'rgba(149, 165, 166, 0.3)';
                    ctx.beginPath();
                    ctx.arc(building.x, building.y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'rgba(149, 165, 166, 0.6)';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(building.icon, building.x, building.y);
                    
                    ctx.fillStyle = 'rgba(149, 165, 166, 0.8)';
                    ctx.font = '9px Arial';
                    ctx.fillText('å¾…å»ºé€ ', building.x, building.y + 20);
                }
            });
        }
        
        function getBuildingColor(type) {
            const colors = {
                'core': '#3498db',
                'residential': '#2ecc71',
                'industrial': '#9b59b6',
                'defense': '#e74c3c',
                'storage': '#f39c12',
                'farm': '#27ae60',
                'hospital': '#e74c3c',
                'warehouse': '#f39c12',
                'factory': '#9b59b6',
                'research': '#3498db',
                'military': '#e74c3c',
                'outer': '#e74c3c',
                'middle': '#f1c40f',
                'inner': '#2ecc71',
                'food': '#2ecc71',
                'water': '#3498db',
                'power': '#f1c40f',
                'material': '#e67e22',
                'recycling': '#1abc9c',
                'special': '#9b59b6',
                'scrapyard': '#7f8c8d'
            };
            return colors[type] || '#95a5a6';
        }
        
        // ====== è§†å›¾åˆ‡æ¢ ======
        function switchView(view) {
            gameData.currentView = view;
            
            document.querySelectorAll('.map-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.view === view);
            });
            
            const info = gameData.viewInfo[view];
            if (info) {
                document.getElementById('view-info').innerHTML = `
                    <h3 style="margin-bottom:10px;color:#3498db;">${info.title}</h3>
                    <p style="font-size:12px;color:#95a5a6;">${info.desc}</p>
                    <div style="margin-top:8px;font-size:11px;">
                        åˆ†åŒº: ${info.zones.join(' | ')}
                    </div>
                `;
            }
            
            updateBuildingList();
            drawMap();
        }
        
        function updateBuildingList() {
            const buildings = gameData.buildings[gameData.currentView] || [];
            const listEl = document.getElementById('building-list');
            
            let html = '';
            
            if (gameData.currentView === 'exploration') {
                html = buildings.map(building => `
                    <div class="building-item" onclick="selectExplorationBuilding(${building.id})">
                        <div style="display:flex;align-items:center;gap:10px;">
                            <div style="font-size:24px;">${building.icon}</div>
                            <div>
                                <div style="font-weight:bold;">${building.name}</div>
                                <div style="font-size:11px;color:#95a5a6;">
                                    å±é™©ç­‰çº§: ${building.danger}/5 | æˆåŠŸå‡ ç‡: ${building.successChance}%
                                </div>
                            </div>
                            <div style="margin-left:auto;font-size:12px;color:${building.discovered ? '#2ecc71' : '#f39c12'}">
                                ${building.discovered ? 'å¯æ¢ç´¢' : 'æœªæ¢ç´¢'}
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                html = buildings.map(building => `
                    <div class="building-item" onclick="selectBuilding(${building.id})">
                        <div style="display:flex;align-items:center;gap:10px;">
                            <div style="font-size:24px;">${building.icon}</div>
                            <div>
                                <div style="font-weight:bold;">${building.name}</div>
                                <div style="font-size:11px;color:#95a5a6;">
                                    ${building.built && building.level > 0 ? 
                                        (building.zone || building.output || building.coverage || 'åŸºåœ°å»ºç­‘') : 
                                        'æœªå»ºé€  - ç‚¹å‡»æŸ¥çœ‹å»ºé€ éœ€æ±‚'}
                                </div>
                            </div>
                            <div style="margin-left:auto;color:#FFD700;font-size:12px;">
                                ${building.built && building.level > 0 ? `Lv.${building.level}` : 'å¾…å»ºé€ '}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            listEl.innerHTML = html;
        }
        
        function selectBuilding(id) {
            const buildings = gameData.buildings[gameData.currentView] || [];
            const building = buildings.find(b => b.id === id);
            
            if(building) {
                if (building.built && building.level > 0) {
                    showNotification('å»ºç­‘ä¿¡æ¯', `${building.name} (ç­‰çº§ ${building.level})`, building.icon);
                } else {
                    showNotification('æœªå»ºé€ ', `${building.name} å°šæœªå»ºé€ ï¼Œè¯·åœ¨å»ºç­‘èœå•ä¸­å»ºé€ `, 'ğŸ—ï¸');
                }
            }
        }
        
        function selectExplorationBuilding(id) {
            const building = gameData.buildings.exploration.find(b => b.id === id);
            if (building) {
                if (building.discovered) {
                    showNotification('å·²æ¢ç´¢', `${building.name} å·²è¢«æ¢ç´¢è¿‡`, building.icon);
                } else {
                    showExplorationOptions(building);
                }
            }
        }
        
        function showExplorationOptions(building) {
            if (gameData.currentExploration) {
                showNotification('æ¢ç´¢è¿›è¡Œä¸­', 'å·²æœ‰æ¢ç´¢é˜Ÿæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œè¯·ç­‰å¾…å®Œæˆ', 'â³');
                return;
            }
            
            const availableSurvivors = gameData.survivors.filter(s => 
                s.status === 'å·¥ä½œä¸­' || s.status === 'å¾…å‘½'
            );
            
            if (availableSurvivors.length === 0) {
                showNotification('æ— äººå¯ç”¨', 'æ²¡æœ‰å¯ç”¨çš„å¹¸å­˜è€…æ‰§è¡Œæ¢ç´¢ä»»åŠ¡', 'âš ï¸');
                return;
            }
            
            const successChance = building.successChance || (100 - building.danger * 10);
            const confirmExplore = confirm(`ç«‹å³æ¢ç´¢ ${building.name}?\nå±é™©ç­‰çº§: ${building.danger}/5\næˆåŠŸæ¦‚ç‡: ${successChance}%\n\næˆåŠŸå¥–åŠ±: å¤§é‡èµ„æº\nå¤±è´¥æƒ©ç½š: æŸå¤±éƒ¨åˆ†èµ„æº`);
            
            if (confirmExplore) {
                startImmediateExploration(building);
            }
        }
        
        // ====== æ¢ç´¢ç³»ç»Ÿ - ç«‹å³å®Œæˆ ======
        function startImmediateExploration(location) {
            // è‡ªåŠ¨é€‰æ‹©1-3åå¹¸å­˜è€…
            const availableSurvivors = gameData.survivors.filter(s => 
                s.status === 'å·¥ä½œä¸­' || s.status === 'å¾…å‘½'
            );
            
            const selectedSurvivors = availableSurvivors
                .sort((a, b) => (b.skills.combat || 0) - (a.skills.combat || 0))
                .slice(0, Math.min(3, availableSurvivors.length));
            
            // æ›´æ–°å¹¸å­˜è€…çŠ¶æ€
            selectedSurvivors.forEach(survivor => {
                survivor.status = 'æ¢ç´¢ä¸­';
                survivor.assignedTo = 'æ¢ç´¢é˜Ÿ';
            });
            
            // è®¾ç½®æ¢ç´¢ä»»åŠ¡
            gameData.currentExploration = location;
            gameData.explorationTeam = selectedSurvivors;
            
            // ç«‹å³å®Œæˆæ¢ç´¢
            completeImmediateExploration();
        }
        
        function completeImmediateExploration() {
            if (!gameData.currentExploration || gameData.explorationTeam.length === 0) return;
            
            const location = gameData.currentExploration;
            
            // è®¡ç®—æˆåŠŸæ¦‚ç‡
            const successChance = location.successChance || (100 - location.danger * 10);
            const isSuccess = Math.random() * 100 < successChance;
            
            let resultMessage = `æ¢ç´¢ ${location.name} å®Œæˆï¼\n`;
            
            if (isSuccess) {
                // æˆåŠŸæ¢ç´¢ - è·å¾—20%é¢å¤–å¥–åŠ±
                resultMessage += `âœ… æ¢ç´¢æˆåŠŸï¼(æˆåŠŸå‡ ç‡: ${successChance}%)\n\n`;
                resultMessage += `è·å¾—å¥–åŠ±:\n`;
                
                // è®¡ç®—å¥–åŠ±ï¼ˆåŸå¥–åŠ± + 20%é¢å¤–ï¼‰
                if (location.rewards.food) {
                    const reward = Math.floor(location.rewards.food * 1.2);
                    gameData.resources.food.current = Math.min(gameData.resources.food.max, 
                        gameData.resources.food.current + reward);
                    resultMessage += `â€¢ é£Ÿç‰©: +${reward} (+20%é¢å¤–)\n`;
                }
                
                if (location.rewards.water) {
                    const reward = Math.floor(location.rewards.water * 1.2);
                    gameData.resources.water.current = Math.min(gameData.resources.water.max, 
                        gameData.resources.water.current + reward);
                    resultMessage += `â€¢ å‡€æ°´: +${reward} (+20%é¢å¤–)\n`;
                }
                
                if (location.rewards.material) {
                    const reward = Math.floor(location.rewards.material * 1.2);
                    gameData.resources.material.current = Math.min(gameData.resources.material.max, 
                        gameData.resources.material.current + reward);
                    resultMessage += `â€¢ ææ–™: +${reward} (+20%é¢å¤–)\n`;
                }
                
                if (location.rewards.power) {
                    const reward = Math.floor(location.rewards.power * 1.2);
                    gameData.resources.power.current = Math.min(gameData.resources.power.max, 
                        gameData.resources.power.current + reward);
                    resultMessage += `â€¢ ç”µåŠ›: +${reward} (+20%é¢å¤–)\n`;
                }
                
                if (location.rewards.tech) {
                    const reward = Math.floor(location.rewards.tech * 1.2);
                    gameData.techPoints += reward;
                    resultMessage += `â€¢ ç§‘æŠ€ç‚¹: +${reward} (+20%é¢å¤–)\n`;
                }
                
                // ç‰¹æ®Šç‰©å“å¥–åŠ±
                if (location.rewards.special) {
                    resultMessage += `â€¢ ç‰¹æ®Šç‰©å“: ${location.rewards.special}\n`;
                    
                    switch(location.rewards.special) {
                        case 'åŒ»ç–—åŒ…':
                            gameData.survivors.forEach(s => s.health = Math.min(100, s.health + 10));
                            resultMessage += 'æ‰€æœ‰å¹¸å­˜è€…å¥åº·åº¦+10\n';
                            break;
                        case 'æ­¦å™¨':
                            gameData.threatLevel = Math.min(10, gameData.threatLevel + 1);
                            updateDefenseLevel();
                            resultMessage += 'é˜²å¾¡ç­‰çº§+1\n';
                            break;
                        case 'ç§‘æŠ€è“å›¾':
                            const lockedTechs = gameData.technologies.filter(t => !t.unlocked);
                            if (lockedTechs.length > 0) {
                                const randomTech = lockedTechs[Math.floor(Math.random() * lockedTechs.length)];
                                randomTech.unlocked = true;
                                resultMessage += `è§£é”ç§‘æŠ€: ${randomTech.name}\n`;
                                updateTechList();
                            }
                            break;
                        case 'å‘ç”µæœºé›¶ä»¶':
                            gameData.resources.power.production += 5;
                            resultMessage += 'ç”µåŠ›ç”Ÿäº§+5/å°æ—¶\n';
                            break;
                    }
                }
                
                // éšæœºäº‹ä»¶ï¼šå¯èƒ½æ‰¾åˆ°æ–°å¹¸å­˜è€…
                if (Math.random() < 0.3 && gameData.survivors.length < 10) {
                    const newSurvivors = [
                        { id: gameData.survivors.length + 1, name: 'åˆ˜æ˜', job: 'æŠ€å·¥', icon: 'ğŸ‘¨â€ğŸ”§', health: 70, morale: 60, assignedTo: 'å¾…å‘½', skills: { engineering: 6, construction: 5, combat: 2 }, status: 'å¾…å‘½' },
                        { id: gameData.survivors.length + 1, name: 'å‘¨èŠ³', job: 'ç ”ç©¶å‘˜', icon: 'ğŸ‘©â€ğŸ”¬', health: 75, morale: 65, assignedTo: 'å¾…å‘½', skills: { research: 7, medical: 4, survival: 3 }, status: 'å¾…å‘½' },
                        { id: gameData.survivors.length + 1, name: 'å´å‹‡', job: 'çŒäºº', icon: 'ğŸ¹', health: 80, morale: 70, assignedTo: 'å¾…å‘½', skills: { combat: 6, survival: 7, tracking: 5 }, status: 'å¾…å‘½' }
                    ];
                    
                    const newSurvivor = newSurvivors[Math.floor(Math.random() * newSurvivors.length)];
                    newSurvivor.id = gameData.survivors.length + 1;
                    gameData.survivors.push(newSurvivor);
                    resultMessage += `â€¢ æ–°å¹¸å­˜è€…: ${newSurvivor.name} (${newSurvivor.job})\n`;
                }
                
                showNotification('æ¢ç´¢æˆåŠŸ', `æˆåŠŸæ¢ç´¢${location.name}ï¼è·å¾—ä¸°åšå¥–åŠ±`, 'âœ…');
                
            } else {
                // å¤±è´¥æ¢ç´¢ - æŸå¤±10%èµ„æº
                resultMessage += `âŒ æ¢ç´¢å¤±è´¥ï¼(æˆåŠŸå‡ ç‡: ${successChance}%)\n\n`;
                resultMessage += `æŸå¤±èµ„æº:\n`;
                
                // è®¡ç®—æŸå¤±
                if (location.risks.food) {
                    const loss = Math.floor(location.risks.food * 1.1);
                    gameData.resources.food.current = Math.max(0, gameData.resources.food.current - loss);
                    resultMessage += `â€¢ é£Ÿç‰©: -${loss} (+10%é¢å¤–æŸå¤±)\n`;
                }
                
                if (location.risks.water) {
                    const loss = Math.floor(location.risks.water * 1.1);
                    gameData.resources.water.current = Math.max(0, gameData.resources.water.current - loss);
                    resultMessage += `â€¢ å‡€æ°´: -${loss} (+10%é¢å¤–æŸå¤±)\n`;
                }
                
                if (location.risks.material) {
                    const loss = Math.floor(location.risks.material * 1.1);
                    gameData.resources.material.current = Math.max(0, gameData.resources.material.current - loss);
                    resultMessage += `â€¢ ææ–™: -${loss} (+10%é¢å¤–æŸå¤±)\n`;
                }
                
                // æ¢ç´¢é˜Ÿå‘˜å¯èƒ½å—ä¼¤
                if (Math.random() < 0.5) {
                    resultMessage += `âš ï¸ æ¢ç´¢é˜Ÿå‘˜å—ä¼¤ï¼\n`;
                    gameData.explorationTeam.forEach(survivor => {
                        survivor.health = Math.max(10, survivor.health - 15);
                    });
                }
                
                showNotification('æ¢ç´¢å¤±è´¥', `æ¢ç´¢${location.name}å¤±è´¥ï¼ŒæŸå¤±äº†éƒ¨åˆ†èµ„æº`, 'âŒ');
            }
            
            // æ¢å¤æ¢ç´¢é˜Ÿå‘˜çŠ¶æ€
            gameData.explorationTeam.forEach(survivor => {
                survivor.status = 'å·¥ä½œä¸­';
                survivor.assignedTo = survivor.job === 'å®ˆå«' ? 'å“¨å¡”' : 
                                   survivor.job === 'åŒ»ç”Ÿ' ? 'åŒ»ç–—ç«™' :
                                   survivor.job === 'å·¥ç¨‹å¸ˆ' ? 'å‘ç”µå‚' :
                                   survivor.job === 'å†œæ°‘' ? 'å†œåœº' : 
                                   survivor.job === 'æŠ€å·¥' ? 'å›æ”¶ç«™' : 'æŒ‡æŒ¥ä¸­å¿ƒ';
            });
            
            // é‡ç½®æ¢ç´¢çŠ¶æ€
            gameData.currentExploration = null;
            gameData.explorationTeam = [];
            
            // æ›´æ–°æ˜¾ç¤º
            updateResourceDisplay();
            updateSurvivorList();
            updateExplorationStatus();
            updateExplorationLocations();
            updateBuildingList();
            drawMap();
            
            // æ˜¾ç¤ºæ¢ç´¢ç»“æœ
            document.getElementById('exploration-results').style.display = 'block';
            document.getElementById('exploration-results-content').innerHTML = `
                <div style="padding: 10px; background: ${isSuccess ? 'rgba(46, 204, 113, 0.1)' : 'rgba(231, 76, 60, 0.1)'}; border-radius: 6px;">
                    <div style="white-space: pre-line; font-size: 12px;">${resultMessage}</div>
                </div>
            `;
            
            // æ£€æŸ¥æˆå°±
            checkAchievements();
        }
        
        function updateExplorationStatus() {
            const statusEl = document.getElementById('exploration-status');
            
            if (gameData.currentExploration) {
                const location = gameData.currentExploration;
                const successChance = location.successChance || (100 - location.danger * 10);
                
                statusEl.innerHTML = `
                    <div style="font-weight: bold; color: #f39c12; margin-bottom: 8px;">æ¢ç´¢è¿›è¡Œä¸­</div>
                    <div style="font-size: 12px; margin-bottom: 8px;">
                        <div>ç›®æ ‡: ${location.name}</div>
                        <div>å±é™©ç­‰çº§: ${location.danger}/5</div>
                        <div>æˆåŠŸæ¦‚ç‡: ${successChance}%</div>
                    </div>
                    
                    <div style="font-size: 11px;">
                        <div>æ¢ç´¢é˜Ÿå‘˜:</div>
                        ${gameData.explorationTeam.map(member => `
                            <div class="team-member">
                                <span>${member.icon}</span>
                                <span>${member.name}</span>
                                <span style="color: #95a5a6;">(${member.job})</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="build-btn" style="width: 100%; margin-top: 10px;" onclick="cancelExploration()">
                        å–æ¶ˆæ¢ç´¢
                    </button>
                `;
            } else {
                statusEl.innerHTML = `
                    <div style="font-weight: bold; color: #95a5a6; margin-bottom: 8px;">æ¢ç´¢çŠ¶æ€</div>
                    <div style="font-size: 12px; margin-bottom: 8px;">æš‚æ— æ¢ç´¢ä»»åŠ¡</div>
                    <div style="font-size: 11px; color: #95a5a6;">ç«‹å³æ¢ç´¢åºŸåœŸå»ºç­‘ä»¥è·å–èµ„æºå’Œå¹¸å­˜è€…</div>
                `;
            }
        }
        
        function updateExplorationLocations() {
            const locationsEl = document.getElementById('exploration-locations');
            
            locationsEl.innerHTML = gameData.explorationLocations.map((location, index) => `
                <div class="location-card" onclick="startExplorationFromList(${index})">
                    <div class="location-header">
                        <div class="location-icon">${location.icon}</div>
                        <div>
                            <div class="location-name">${location.name}</div>
                            <div class="location-stats">
                                <span>è·ç¦»: ${location.distance}</span>
                                <span>å±é™©: ${location.danger}/5</span>
                            </div>
                        </div>
                    </div>
                    <div class="location-info">${location.description}</div>
                    <div class="location-stats">
                        <span>æˆåŠŸç‡: ${location.successChance || (100 - location.danger * 10)}%</span>
                        <span>${location.discovered ? 'å¯æ¢ç´¢' : 'æœªæ¢ç´¢'}</span>
                    </div>
                </div>
            `).join('');
        }
        
        // ä¿®å¤æ¢ç´¢åˆ—è¡¨ç‚¹å‡»äº‹ä»¶
        function startExplorationFromList(index) {
            const location = gameData.explorationLocations[index];
            if (location && !location.discovered) {
                // æ£€æŸ¥æ˜¯å¦æœ‰æ¢ç´¢é˜Ÿæ­£åœ¨æ‰§è¡Œä»»åŠ¡
                if (gameData.currentExploration) {
                    showNotification('æ¢ç´¢è¿›è¡Œä¸­', 'å·²æœ‰æ¢ç´¢é˜Ÿæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œè¯·ç­‰å¾…å®Œæˆ', 'â³');
                    return;
                }
                
                const availableSurvivors = gameData.survivors.filter(s => 
                    s.status === 'å·¥ä½œä¸­' || s.status === 'å¾…å‘½'
                );
                
                if (availableSurvivors.length === 0) {
                    showNotification('æ— äººå¯ç”¨', 'æ²¡æœ‰å¯ç”¨çš„å¹¸å­˜è€…æ‰§è¡Œæ¢ç´¢ä»»åŠ¡', 'âš ï¸');
                    return;
                }
                
                const successChance = location.successChance || (100 - location.danger * 10);
                const confirmExplore = confirm(`ç«‹å³æ¢ç´¢ ${location.name}?\nå±é™©ç­‰çº§: ${location.danger}/5\næˆåŠŸæ¦‚ç‡: ${successChance}%\n\næˆåŠŸå¥–åŠ±: å¤§é‡èµ„æº\nå¤±è´¥æƒ©ç½š: æŸå¤±éƒ¨åˆ†èµ„æº`);
                
                if (confirmExplore) {
                    startImmediateExploration(location);
                }
            }
        }
        
        function cancelExploration() {
            if (!gameData.currentExploration) return;
            
            const confirmCancel = confirm('ç¡®å®šè¦å–æ¶ˆæ¢ç´¢å—ï¼Ÿæ¢ç´¢å°†ç«‹å³ç»“æŸä¸”æ— ä»»ä½•æ”¶è·ï¼');
            
            if (confirmCancel) {
                // æ¢å¤æ¢ç´¢é˜Ÿå‘˜çŠ¶æ€
                gameData.explorationTeam.forEach(survivor => {
                    survivor.status = 'å·¥ä½œä¸­';
                    survivor.assignedTo = survivor.job === 'å®ˆå«' ? 'å“¨å¡”' : 
                                       survivor.job === 'åŒ»ç”Ÿ' ? 'åŒ»ç–—ç«™' :
                                       survivor.job === 'å·¥ç¨‹å¸ˆ' ? 'å‘ç”µå‚' :
                                       survivor.job === 'å†œæ°‘' ? 'å†œåœº' : 
                                       survivor.job === 'æŠ€å·¥' ? 'å›æ”¶ç«™' : 'æŒ‡æŒ¥ä¸­å¿ƒ';
                });
                
                showNotification('æ¢ç´¢å–æ¶ˆ', 'æ¢ç´¢ä»»åŠ¡å·²å–æ¶ˆï¼Œé˜Ÿå‘˜å·²è¿”å›', 'âŒ');
                
                // é‡ç½®æ¢ç´¢çŠ¶æ€
                gameData.currentExploration = null;
                gameData.explorationTeam = [];
                
                // æ›´æ–°æ˜¾ç¤º
                updateSurvivorList();
                updateExplorationStatus();
            }
        }
        
        // ====== å¹¸å­˜è€…ç®¡ç† ======
        function updateSurvivorList() {
            const listEl = document.getElementById('survivor-list');
            const totalPopulation = gameData.survivors.length;
            const maxPopulation = 10;
            
            document.getElementById('total-population').textContent = `${totalPopulation}/${maxPopulation}`;
            
            let totalHealth = 0;
            let totalMorale = 0;
            gameData.survivors.forEach(s => {
                totalHealth += s.health;
                totalMorale += s.morale;
            });
            
            const avgHealth = Math.round(totalHealth / totalPopulation);
            const avgMorale = Math.round(totalMorale / totalPopulation);
            
            document.getElementById('health-rate').textContent = `${avgHealth}%`;
            document.getElementById('morale-rate').textContent = `${avgMorale}%`;
            
            listEl.innerHTML = gameData.survivors.map(survivor => `
                <div style="margin-bottom: 10px; padding: 10px; background: rgba(40, 45, 60, 0.6); border-radius: 6px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 24px;">${survivor.icon}</div>
                            <div>
                                <div style="font-weight: bold;">${survivor.name}</div>
                                <div style="font-size: 11px; color: #95a5a6;">${survivor.job} - ${survivor.status}</div>
                            </div>
                        </div>
                        <div style="font-size: 11px; color: #f39c12;">${survivor.assignedTo}</div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 11px;">
                        <div>å¥åº·: ${survivor.health}%</div>
                        <div>å£«æ°”: ${survivor.morale}%</div>
                    </div>
                    
                    <div class="job-options">
                        <div class="job-btn ${survivor.assignedTo === 'æŒ‡æŒ¥ä¸­å¿ƒ' ? 'active' : ''}" onclick="assignJob(${survivor.id}, 'æŒ‡æŒ¥ä¸­å¿ƒ')">
                            ç®¡ç†
                        </div>
                        <div class="job-btn ${survivor.assignedTo === 'å†œåœº' ? 'active' : ''}" onclick="assignJob(${survivor.id}, 'å†œåœº')">
                            å†œä¸š
                        </div>
                        <div class="job-btn ${survivor.assignedTo === 'å‘ç”µå‚' ? 'active' : ''}" onclick="assignJob(${survivor.id}, 'å‘ç”µå‚')">
                            ç”µåŠ›
                        </div>
                        <div class="job-btn ${survivor.assignedTo === 'åŒ»ç–—ç«™' ? 'active' : ''}" onclick="assignJob(${survivor.id}, 'åŒ»ç–—ç«™')">
                            åŒ»ç–—
                        </div>
                        <div class="job-btn ${survivor.assignedTo === 'å“¨å¡”' ? 'active' : ''}" onclick="assignJob(${survivor.id}, 'å“¨å¡”')">
                            å®ˆå«
                        </div>
                        <div class="job-btn ${survivor.assignedTo === 'å›æ”¶ç«™' ? 'active' : ''}" onclick="assignJob(${survivor.id}, 'å›æ”¶ç«™')">
                            å›æ”¶
                        </div>
                        <div class="job-btn ${survivor.status === 'æ¢ç´¢ä¸­' ? 'active' : ''}" onclick="assignToExploration(${survivor.id})">
                            æ¢ç´¢
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function assignJob(survivorId, job) {
            const survivor = gameData.survivors.find(s => s.id === survivorId);
            if (survivor && survivor.status !== 'æ¢ç´¢ä¸­') {
                const oldJob = survivor.assignedTo;
                survivor.assignedTo = job;
                survivor.status = 'å·¥ä½œä¸­';
                updateSurvivorList();
                showNotification('å·¥ä½œåˆ†é…', `${survivor.name} è¢«åˆ†é…åˆ° ${job}`, 'ğŸ‘¨â€ğŸ’¼');
            } else if (survivor && survivor.status === 'æ¢ç´¢ä¸­') {
                showNotification('æ— æ³•åˆ†é…', `${survivor.name} æ­£åœ¨æ¢ç´¢ä¸­ï¼Œæ— æ³•åˆ†é…å·¥ä½œ`, 'âš ï¸');
            }
        }
        
        function assignToExploration(survivorId) {
            const survivor = gameData.survivors.find(s => s.id === survivorId);
            if (survivor) {
                showNotification('æ¢ç´¢å‡†å¤‡', `${survivor.name} å·²å‡†å¤‡å¥½å‚åŠ æ¢ç´¢ä»»åŠ¡`, 'ğŸ§­');
            }
        }
        
        // ====== å»ºç­‘å»ºé€ ç³»ç»Ÿ ======
        function updateAvailableBuildings() {
            const listEl = document.getElementById('available-buildings');
            
            listEl.innerHTML = gameData.availableBuildings.map(building => `
                <div style="padding: 10px; background: rgba(40, 45, 60, 0.6); border-radius: 6px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <div style="font-size: 24px;">${building.icon}</div>
                        <div>
                            <div style="font-weight: bold;">${building.name}</div>
                            <div style="font-size: 11px; color: #95a5a6;">${building.description}</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 11px; color: #e67e22;">
                            ææ–™: ${building.cost.material}
                        </div>
                        <button class="build-btn" onclick="buildStructure(${building.id})" 
                                ${gameData.resources.material.current < building.cost.material ? 'disabled' : ''}>
                            å»ºé€ 
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function buildStructure(buildingId) {
            const building = gameData.availableBuildings.find(b => b.id === buildingId);
            
            if (!building) return;
            
            if (gameData.resources.material.current < building.cost.material) {
                showNotification('ææ–™ä¸è¶³', `éœ€è¦ ${building.cost.material} ææ–™ï¼Œå½“å‰åªæœ‰ ${gameData.resources.material.current}`, 'âš ï¸');
                return;
            }
            
            gameData.resources.material.current -= building.cost.material;
            
            let found = false;
            for (const view in gameData.buildings) {
                for (let i = 0; i < gameData.buildings[view].length; i++) {
                    const mapBuilding = gameData.buildings[view][i];
                    if (mapBuilding.name === building.name) {
                        gameData.buildings[view][i].built = true;
                        gameData.buildings[view][i].level = 1;
                        found = true;
                        
                        switch(building.type) {
                            case 'farm':
                                gameData.resources.food.production += 2;
                                break;
                            case 'water':
                                gameData.resources.water.production += 2;
                                break;
                            case 'industrial':
                                gameData.resources.power.production += 5;
                                break;
                            case 'defense':
                                updateDefenseLevel();
                                break;
                            case 'recycling':
                                gameData.resources.material.production += 3;
                                unlockAchievement(12);
                                break;
                            case 'material':
                                gameData.resources.material.production += 5;
                                break;
                        }
                        
                        break;
                    }
                }
                if (found) break;
            }
            
            updateResourceDisplay();
            updateBuildingList();
            drawMap();
            
            showNotification('å»ºé€ å®Œæˆ', `${building.name} å·²å»ºé€ å®Œæˆï¼`, building.icon);
            
            checkAchievements();
        }
        
        function updateDefenseLevel() {
            let defenseCount = 0;
            for (const view in gameData.buildings) {
                defenseCount += gameData.buildings[view].filter(b => 
                    b.type.includes('defense') && b.built && b.level > 0
                ).length;
            }
            
            gameData.threatLevel = Math.max(1, Math.min(10, Math.floor(defenseCount / 2) + 1));
            document.querySelector('.status-value[style*="color:#e74c3c"]').textContent = `Lv.${gameData.threatLevel}`;
            
            document.getElementById('threat-level').textContent = 
                gameData.threatLevel <= 3 ? 'ä½' : 
                gameData.threatLevel <= 6 ? 'ä¸­' : 'é«˜';
            
            document.getElementById('threat-bar').style.width = `${gameData.threatLevel * 10}%`;
        }
        
        // ====== ç§‘æŠ€ç ”ç©¶ç³»ç»Ÿ ======
        function updateTechList() {
            const listEl = document.getElementById('tech-list');
            document.getElementById('tech-points').textContent = gameData.techPoints;
            
            const allTechnologies = [...gameData.technologies];
            
            gameData.installedDLCs.forEach(dlc => {
                if (dlc.enabled && dlc.content && dlc.content.technologies) {
                    allTechnologies.push(...dlc.content.technologies);
                }
            });
            
            listEl.innerHTML = allTechnologies.map(tech => `
                <div style="margin-bottom: 10px; padding: 10px; background: ${tech.unlocked ? 'rgba(46, 204, 113, 0.1)' : 'rgba(40, 45, 60, 0.6)'}; border-radius: 6px; border-left: 4px solid ${tech.unlocked ? '#2ecc71' : '#9b59b6'};">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 20px;">${tech.icon}</div>
                            <div>
                                <div style="font-weight: bold;">${tech.name}</div>
                                <div style="font-size: 11px; color: #95a5a6;">${tech.description}</div>
                            </div>
                        </div>
                        <div style="font-size: 11px; color: #9b59b6;">
                            ${tech.cost} ç§‘æŠ€ç‚¹
                        </div>
                    </div>
                    
                    ${tech.unlocked ? 
                        '<div style="text-align: center; font-size: 11px; color: #2ecc71; padding: 5px; background: rgba(46, 204, 113, 0.2); border-radius: 4px;">å·²ç ”ç©¶</div>' :
                        `<button class="build-btn" onclick="researchTech(${tech.id})" 
                                ${gameData.techPoints < tech.cost ? 'disabled' : ''}>
                            ç ”ç©¶
                        </button>`
                    }
                </div>
            `).join('');
        }
        
        function researchTech(techId) {
            let tech = gameData.technologies.find(t => t.id === techId);
            
            if (!tech) {
                for (const dlc of gameData.installedDLCs) {
                    if (dlc.enabled && dlc.content && dlc.content.technologies) {
                        tech = dlc.content.technologies.find(t => t.id === techId);
                        if (tech) break;
                    }
                }
            }
            
            if (!tech || tech.unlocked) return;
            
            if (gameData.techPoints < tech.cost) {
                showNotification('ç§‘æŠ€ç‚¹ä¸è¶³', `éœ€è¦ ${tech.cost} ç§‘æŠ€ç‚¹ï¼Œå½“å‰åªæœ‰ ${gameData.techPoints}`, 'ğŸ”¬');
                return;
            }
            
            gameData.techPoints -= tech.cost;
            tech.unlocked = true;
            
            updateTechList();
            unlockNewBuildings(techId);
            
            showNotification('ç ”ç©¶å®Œæˆ', `${tech.name} å·²ç ”ç©¶å®Œæˆï¼`, tech.icon);
            checkAchievements();
        }
        
        function unlockNewBuildings(techId) {
            const newBuildings = [];
            
            switch(techId) {
                case 1: // åŸºç¡€å†œä¸š
                    newBuildings.push({ id: 111, name: 'æ¸©å®¤', icon: 'ğŸŒ¿', cost: { material: 50 }, time: 3, type: 'farm', description: 'é«˜æ•ˆç§æ¤ï¼Œæ¯å°æ—¶+5é£Ÿç‰©' });
                    break;
                case 2: // æ°´åŠ›å‡€åŒ–
                    newBuildings.push({ id: 112, name: 'å‡€æ°´å‚', icon: 'ğŸš°', cost: { material: 60 }, time: 4, type: 'water', description: 'å¤§å‹å‡€æ°´ï¼Œæ¯å°æ—¶+5å‡€æ°´' });
                    break;
                case 3: // åŸºç¡€ç”µåŠ›
                    newBuildings.push({ id: 113, name: 'å‘ç”µç«™', icon: 'ğŸ­', cost: { material: 80 }, time: 5, type: 'industrial', description: 'ç¨³å®šä¾›ç”µï¼Œæ¯å°æ—¶+15ç”µåŠ›' });
                    break;
                case 5: // åŸºç¡€é˜²å¾¡
                    newBuildings.push({ id: 114, name: 'é˜²å¾¡ç‚®å¡”', icon: 'ğŸ”«', cost: { material: 70 }, time: 4, type: 'defense', description: 'è‡ªåŠ¨é˜²å¾¡ï¼Œå¤§å¹…æå‡é˜²å¾¡èƒ½åŠ›' });
                    break;
                case 6: // ææ–™åŠ å·¥
                    newBuildings.push({ id: 115, name: 'ææ–™åŠ å·¥å‚', icon: 'ğŸ­', cost: { material: 80 }, time: 4, type: 'material', description: 'é«˜æ•ˆç”Ÿäº§ï¼Œæ¯å°æ—¶+8ææ–™' });
                    break;
            }
            
            newBuildings.forEach(building => {
                if (!gameData.availableBuildings.find(b => b.id === building.id)) {
                    gameData.availableBuildings.push(building);
                }
            });
            
            if (newBuildings.length > 0) {
                updateAvailableBuildings();
            }
        }
        
        // ====== æˆå°±ç³»ç»Ÿ ======
        function updateAchievementList() {
            const listEl = document.getElementById('achievement-list');
            const unlockedCount = gameData.achievements.filter(a => a.unlocked).length;
            const totalCount = gameData.achievements.length;
            
            document.getElementById('achievement-count').textContent = `${unlockedCount}/${totalCount}`;
            
            listEl.innerHTML = gameData.achievements.map(achievement => `
                <div style="margin-bottom: 10px; padding: 10px; background: ${achievement.unlocked ? 'rgba(241, 196, 15, 0.1)' : 'rgba(40, 45, 60, 0.6)'}; border-radius: 6px; border-left: 4px solid ${achievement.unlocked ? '#f1c40f' : '#7f8c8d'};">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 20px;">${achievement.icon}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">${achievement.name}</div>
                            <div style="font-size: 11px; color: #95a5a6;">${achievement.description}</div>
                        </div>
                        <div style="font-size: 11px; color: ${achievement.unlocked ? '#f1c40f' : '#7f8c8d'};">
                            ${achievement.unlocked ? 'å·²è§£é”' : 'æœªè§£é”'}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function checkAchievements() {
            const totalResources = gameData.resources.food.current + gameData.resources.water.current + 
                                 gameData.resources.power.current + gameData.resources.material.current;
            
            if (totalResources >= 100) {
                unlockAchievement(3);
            }
            
            if (gameData.survivors.length >= 10) {
                unlockAchievement(4);
            }
            
            const researchedTech = gameData.technologies.filter(t => t.unlocked).length;
            if (researchedTech >= 1) {
                unlockAchievement(5);
            }
            
            if (gameData.threatLevel >= 5) {
                unlockAchievement(6);
            }
            
            if (gameData.resources.food.production >= 10) {
                unlockAchievement(7);
            }
            
            if (gameData.resources.power.production >= 50) {
                unlockAchievement(8);
            }
            
            const exploredLocations = gameData.explorationLocations.filter(l => l.discovered).length;
            if (exploredLocations >= 5) {
                unlockAchievement(9);
            }
        }
        
        function unlockAchievement(achievementId) {
            const achievement = gameData.achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                updateAchievementList();
                showNotification('æˆå°±è§£é”', `æˆå°± "${achievement.name}" å·²è§£é”ï¼`, 'ğŸ†');
            }
        }
        
        // ====== æ€ªç‰©ç³»ç»Ÿ ======
        function updateMonsterList() {
            const listEl = document.getElementById('monster-list');
            
            listEl.innerHTML = gameData.monsters.map(monster => `
                <div class="monster-item">
                    <div class="monster-info">
                        <div class="monster-icon">${monster.icon}</div>
                        <div>
                            <div style="font-weight: bold;">${monster.name}</div>
                            <div style="font-size: 11px; color: #95a5a6;">${monster.description}</div>
                        </div>
                    </div>
                    <div class="monster-stats">
                        <div style="color: #e74c3c;">å¨èƒ: ${monster.threat}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ====== DLCç®¡ç†ç³»ç»Ÿ ======
        function updateDLCList() {
            const listEl = document.getElementById('installed-dlc');
            const noDlcMessage = document.getElementById('no-dlc-message');
            
            if (gameData.installedDLCs.length === 0) {
                listEl.innerHTML = '';
                noDlcMessage.style.display = 'block';
                return;
            }
            
            noDlcMessage.style.display = 'none';
            listEl.innerHTML = gameData.installedDLCs.map(dlc => `
                <div class="dlc-item">
                    <div class="dlc-item-header">
                        <div class="dlc-icon">${dlc.icon}</div>
                        <div>
                            <div class="dlc-name">${dlc.name}</div>
                            <div class="dlc-meta">
                                <span>v${dlc.version}</span>
                                <span>${dlc.author}</span>
                            </div>
                        </div>
                    </div>
                    <div class="dlc-description">${dlc.description}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 10px; color: ${dlc.enabled ? '#2ecc71' : '#e74c3c'};">
                            ${dlc.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="build-btn" style="font-size: 10px; padding: 4px 8px;" onclick="toggleDLC('${dlc.id}')">
                                ${dlc.enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
                            </button>
                            <button class="build-btn" style="font-size: 10px; padding: 4px 8px; background: rgba(231, 76, 60, 0.2); border-color: #e74c3c; color: #e74c3c;" onclick="removeDLC('${dlc.id}')">
                                ç§»é™¤
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function toggleDLC(dlcId) {
            const dlc = gameData.installedDLCs.find(d => d.id === dlcId);
            if (dlc) {
                dlc.enabled = !dlc.enabled;
                updateDLCList();
                
                if (dlc.enabled) {
                    showNotification('DLCå¯ç”¨', `${dlc.name} å·²å¯ç”¨ï¼Œæ–°å†…å®¹å·²åŠ è½½`, 'âœ…');
                    applyDLCContent(dlc);
                } else {
                    showNotification('DLCç¦ç”¨', `${dlc.name} å·²ç¦ç”¨`, 'âŒ');
                    removeDLCContent(dlc);
                }
            }
        }
        
        function removeDLC(dlcId) {
            const confirmRemove = confirm('ç¡®å®šè¦ç§»é™¤è¿™ä¸ªDLCå—ï¼Ÿç›¸å…³çš„æ¸¸æˆå†…å®¹å°†è¢«åˆ é™¤ï¼');
            if (!confirmRemove) return;
            
            const dlcIndex = gameData.installedDLCs.findIndex(d => d.id === dlcId);
            if (dlcIndex !== -1) {
                const dlc = gameData.installedDLCs[dlcIndex];
                removeDLCContent(dlc);
                
                gameData.installedDLCs.splice(dlcIndex, 1);
                updateDLCList();
                showNotification('DLCç§»é™¤', `${dlc.name} å·²ç§»é™¤`, 'ğŸ—‘ï¸');
            }
        }
        
        function applyDLCContent(dlc) {
            if (!dlc.content) return;
            
            if (dlc.content.survivors) {
                dlc.content.survivors.forEach(survivor => {
                    if (!gameData.survivors.find(s => s.id === survivor.id)) {
                        gameData.survivors.push(survivor);
                    }
                });
                updateSurvivorList();
            }
            
            if (dlc.content.buildings) {
                dlc.content.buildings.forEach(building => {
                    if (!gameData.availableBuildings.find(b => b.id === building.id)) {
                        gameData.availableBuildings.push(building);
                    }
                });
                updateAvailableBuildings();
            }
            
            updateTechList();
        }
        
        function removeDLCContent(dlc) {
            if (!dlc.content) return;
            
            if (dlc.content.survivors) {
                dlc.content.survivors.forEach(survivor => {
                    const index = gameData.survivors.findIndex(s => s.id === survivor.id);
                    if (index !== -1) {
                        gameData.survivors.splice(index, 1);
                    }
                });
                updateSurvivorList();
            }
            
            if (dlc.content.buildings) {
                dlc.content.buildings.forEach(building => {
                    const index = gameData.availableBuildings.findIndex(b => b.id === building.id);
                    if (index !== -1) {
                        gameData.availableBuildings.splice(index, 1);
                    }
                });
                updateAvailableBuildings();
            }
        }
        
        // ====== DLCå®‰è£…ç³»ç»Ÿ ======
        function initDLCDropZone() {
            const dropZone = document.getElementById('dlc-drop-zone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.add('drag-over');
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.remove('drag-over');
                }, false);
            });
            
            dropZone.addEventListener('drop', handleDrop, false);
        }
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const file = files[0];
                
                if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                    showNotification('æ–‡ä»¶é”™è¯¯', 'è¯·æ‹–æ”¾JSONæ ¼å¼çš„DLCæ–‡ä»¶', 'âš ï¸');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const dlcData = JSON.parse(event.target.result);
                        installDLC(dlcData);
                    } catch (error) {
                        showNotification('è§£æé”™è¯¯', 'DLCæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'âŒ');
                        console.error('DLCè§£æé”™è¯¯:', error);
                    }
                };
                reader.readAsText(file);
            }
        }
        
        function installDLC(dlcData) {
            if (!dlcData.id || !dlcData.name || !dlcData.version) {
                showNotification('DLCé”™è¯¯', 'DLCæ•°æ®ä¸å®Œæ•´ï¼Œç¼ºå°‘å¿…è¦å­—æ®µ', 'âš ï¸');
                return;
            }
            
            if (gameData.installedDLCs.find(d => d.id === dlcData.id)) {
                showNotification('DLCå·²å­˜åœ¨', `${dlcData.name} å·²å®‰è£…ï¼Œè¯·å‹¿é‡å¤å®‰è£…`, 'â„¹ï¸');
                return;
            }
            
            dlcData.enabled = true;
            dlcData.author = dlcData.author || 'æœªçŸ¥ä½œè€…';
            dlcData.icon = dlcData.icon || 'ğŸ';
            dlcData.description = dlcData.description || 'æ— æè¿°';
            
            gameData.installedDLCs.push(dlcData);
            updateDLCList();
            applyDLCContent(dlcData);
            
            showNotification('DLCå®‰è£…æˆåŠŸ', `${dlcData.name} v${dlcData.version} å·²å®‰è£…å¹¶å¯ç”¨`, 'âœ…');
        }
        
        function loadDLCFromURL() {
            const url = document.getElementById('dlc-url').value.trim();
            
            if (!url) {
                showNotification('è¾“å…¥é”™è¯¯', 'è¯·è¾“å…¥DLC JSONæ–‡ä»¶çš„URL', 'âš ï¸');
                return;
            }
            
            showNotification('æ­£åœ¨ä¸‹è½½', `ä»URLä¸‹è½½DLC: ${url}`, 'â³');
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    }
                    return response.json();
                })
                .then(dlcData => {
                    installDLC(dlcData);
                    document.getElementById('dlc-url').value = '';
                })
                .catch(error => {
                    showNotification('ä¸‹è½½å¤±è´¥', `æ— æ³•ä¸‹è½½DLC: ${error.message}`, 'âŒ');
                    console.error('DLCä¸‹è½½é”™è¯¯:', error);
                });
        }
        
        function installExampleDLC() {
            const exampleDLC = {
                id: 'material-production-pack-' + Date.now(),
                name: 'é«˜æ•ˆç”Ÿäº§æ‰©å±•',
                version: '1.0',
                author: 'å¼€å‘è€…å›¢é˜Ÿ',
                icon: 'ğŸ­',
                description: 'æ·»åŠ é«˜æ•ˆææ–™ç”Ÿäº§å»ºç­‘ï¼Œæå‡ææ–™è·å–é€Ÿåº¦',
                content: {
                    buildings: [
                        { 
                            id: 2000, 
                            name: 'é«˜çº§ææ–™å·¥å‚', 
                            icon: 'ğŸ­', 
                            cost: { material: 80 }, 
                            time: 4, 
                            type: 'material', 
                            description: 'é«˜æ•ˆç”Ÿäº§å»ºç­‘ææ–™ï¼Œæ¯å°æ—¶+8ææ–™'
                        }
                    ]
                }
            };
            
            installDLC(exampleDLC);
        }
        
        // ====== å­˜æ¡£/è¯»æ¡£ç³»ç»Ÿ ======
        function updateSaveList() {
            const listEl = document.getElementById('save-list');
            
            if (gameData.saves.length === 0) {
                listEl.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #95a5a6; font-size: 12px;">
                        æš‚æ— å­˜æ¡£
                    </div>
                `;
                return;
            }
            
            listEl.innerHTML = gameData.saves.map((save, index) => `
                <div style="margin-bottom: 10px; padding: 10px; background: rgba(40, 45, 60, 0.6); border-radius: 6px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="font-weight: bold;">${save.name}</div>
                            <div style="font-size: 11px; color: #95a5a6;">
                                ç¬¬${save.data.gameTime.day}å¤© ${save.data.gameTime.hour.toString().padStart(2, '0')}:${save.data.gameTime.minute.toString().padStart(2, '0')}
                            </div>
                        </div>
                        <button class="build-btn" onclick="loadGame(${index})" style="font-size: 11px;">
                            åŠ è½½
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function saveGame() {
            const saveName = document.getElementById('save-name').value.trim();
            if (!saveName) {
                showNotification('å­˜æ¡£å¤±è´¥', 'è¯·è¾“å…¥å­˜æ¡£åç§°', 'âš ï¸');
                return;
            }
            
            const saveData = {
                name: saveName,
                timestamp: new Date().toLocaleString(),
                data: JSON.parse(JSON.stringify(gameData))
            };
            
            gameData.saves.push(saveData);
            document.getElementById('save-name').value = '';
            updateSaveList();
            
            showNotification('å­˜æ¡£æˆåŠŸ', `æ¸¸æˆå·²ä¿å­˜ä¸º: ${saveName}`, 'ğŸ’¾');
        }
        
        function loadGame(saveIndex) {
            if (saveIndex < 0 || saveIndex >= gameData.saves.length) return;
            
            const save = gameData.saves[saveIndex];
            const confirmLoad = confirm(`ç¡®å®šè¦åŠ è½½å­˜æ¡£ "${save.name}" å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¼šä¸¢å¤±ï¼`);
            
            if (confirmLoad) {
                Object.assign(gameData, JSON.parse(JSON.stringify(save.data)));
                
                updateResourceDisplay();
                updateSurvivorList();
                updateBuildingList();
                updateAvailableBuildings();
                updateTechList();
                updateAchievementList();
                updateMonsterList();
                updateDLCList();
                updateSaveList();
                drawMap();
                
                document.querySelector('.status-value[style*="color:#3498db"]').textContent = `ç¬¬${gameData.gameTime.day}å¤©`;
                document.querySelector('.status-value[style*="color:#2ecc71"]').textContent = `${gameData.survivors.length}/10äºº`;
                document.querySelector('.status-value[style*="color:#e74c3c"]').textContent = `Lv.${gameData.threatLevel}`;
                
                const hourStr = gameData.gameTime.hour.toString().padStart(2, '0');
                const minuteStr = gameData.gameTime.minute.toString().padStart(2, '0');
                document.getElementById('game-time').textContent = `${hourStr}:${minuteStr}`;
                
                showNotification('è¯»æ¡£æˆåŠŸ', `å·²åŠ è½½å­˜æ¡£: ${save.name}`, 'ğŸ“‚');
                closeModal('save-load-modal');
            }
        }
        
        function autoSaveGame() {
            const saveName = `è‡ªåŠ¨å­˜æ¡£_ç¬¬${gameData.gameTime.day}å¤©`;
            const saveData = {
                name: saveName,
                timestamp: new Date().toLocaleString(),
                data: JSON.parse(JSON.stringify(gameData))
            };
            
            gameData.saves = gameData.saves.filter(s => !s.name.startsWith('è‡ªåŠ¨å­˜æ¡£_'));
            gameData.saves.push(saveData);
            
            if (gameData.saves.length > 5) {
                gameData.saves = gameData.saves.slice(-5);
            }
            
            updateSaveList();
        }
        
        // ====== è‡ªåŠ¨å­˜æ¡£ç³»ç»Ÿ ======
        function toggleAutoSave() {
            gameData.autoSaveEnabled = !gameData.autoSaveEnabled;
            
            if (gameData.autoSaveEnabled) {
                document.getElementById('auto-save-text').textContent = 'è‡ªåŠ¨å­˜æ¡£:å¼€';
                gameData.autoSaveInterval = setInterval(() => {
                    if (!gameData.isPaused) {
                        autoSaveGame();
                    }
                }, 1800000);
                
                showNotification('è‡ªåŠ¨å­˜æ¡£', 'è‡ªåŠ¨å­˜æ¡£å·²å¯ç”¨ï¼Œæ¯30åˆ†é’Ÿä¿å­˜ä¸€æ¬¡', 'ğŸ’¾');
            } else {
                document.getElementById('auto-save-text').textContent = 'è‡ªåŠ¨å­˜æ¡£:å…³';
                if (gameData.autoSaveInterval) {
                    clearInterval(gameData.autoSaveInterval);
                    gameData.autoSaveInterval = null;
                }
                showNotification('è‡ªåŠ¨å­˜æ¡£', 'è‡ªåŠ¨å­˜æ¡£å·²å…³é—­', 'ğŸ’¾');
            }
        }
        
        // ====== åœ°å›¾æ‹–æ‹½å’Œç¼©æ”¾ ======
        let isDragging = false;
        let lastPos = { x: 0, y: 0 };
        
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastPos = { x: e.offsetX, y: e.offsetY };
            canvas.style.cursor = 'grabbing';
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if(!isDragging) return;
            
            const dx = e.offsetX - lastPos.x;
            const dy = e.offsetY - lastPos.y;
            
            gameData.offset.x += dx;
            gameData.offset.y += dy;
            
            lastPos = { x: e.offsetX, y: e.offsetY };
            drawMap();
        });
        
        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });
        
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const zoomAmount = 0.1;
            const mouseX = e.offsetX;
            const mouseY = e.offsetY;
            
            const zoomBefore = gameData.zoom;
            
            if(e.deltaY < 0 && gameData.zoom < 3) {
                gameData.zoom += zoomAmount;
            } else if(e.deltaY > 0 && gameData.zoom > 0.5) {
                gameData.zoom -= zoomAmount;
            }
            
            const zoomFactor = gameData.zoom / zoomBefore;
            gameData.offset.x = mouseX - (mouseX - gameData.offset.x) * zoomFactor;
            gameData.offset.y = mouseY - (mouseY - gameData.offset.y) * zoomFactor;
            
            drawMap();
        });
        
        // ====== å·¥å…·å‡½æ•° ======
        function zoomIn() {
            if(gameData.zoom < 3) {
                gameData.zoom += 0.2;
                drawMap();
            }
        }
        
        function zoomOut() {
            if(gameData.zoom > 0.5) {
                gameData.zoom -= 0.2;
                drawMap();
            }
        }
        
        function resetView() {
            gameData.zoom = 1.0;
            gameData.offset = { x: 0, y: 0 };
            drawMap();
        }
        
        function toggleGrid() {
            gameData.showGrid = !gameData.showGrid;
            document.getElementById('grid-text').textContent = gameData.showGrid ? 'ç½‘æ ¼' : 'ç½‘æ ¼';
            drawMap();
        }
        
        // ====== é€šçŸ¥ç³»ç»Ÿ ======
        function showNotification(title, message, icon = 'ğŸ“¢') {
            const notificationArea = document.getElementById('notification-area');
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-icon">${icon}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
            `;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        // ====== æŒ‰é’®åŠŸèƒ½ ======
        function showModal(modalId) {
            if (modalId === 'survivors-modal') {
                updateSurvivorList();
            } else if (modalId === 'buildings-modal') {
                updateAvailableBuildings();
            } else if (modalId === 'tech-modal') {
                updateTechList();
            } else if (modalId === 'achievements-modal') {
                updateAchievementList();
            } else if (modalId === 'monster-modal') {
                updateMonsterList();
            } else if (modalId === 'exploration-modal') {
                updateExplorationStatus();
                updateExplorationLocations();
                document.getElementById('exploration-results').style.display = 'none';
            } else if (modalId === 'dlc-modal') {
                updateDLCList();
            } else if (modalId === 'save-load-modal') {
                updateSaveList();
            } else if (modalId === 'settings-modal') {
                // æ›´æ–°è®¾ç½®ç•Œé¢çŠ¶æ€
                document.getElementById('game-speed').value = gameData.gameSpeed;
                document.getElementById('show-grid').checked = gameData.showGrid;
            }
            
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function togglePause() {
            gameData.isPaused = !gameData.isPaused;
            document.getElementById('pause-icon').textContent = gameData.isPaused ? 'â–¶ï¸' : 'â¸ï¸';
            document.getElementById('pause-text').textContent = gameData.isPaused ? 'ç»§ç»­' : 'æš‚åœ';
            showNotification(gameData.isPaused ? 'æ¸¸æˆå·²æš‚åœ' : 'æ¸¸æˆç»§ç»­', gameData.isPaused ? 'æ—¶é—´å·²åœæ­¢ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°è°ƒæ•´è®¾ç½®' : 'æ—¶é—´æ¢å¤æµåŠ¨', gameData.isPaused ? 'â¸ï¸' : 'â–¶ï¸');
        }
        
        function setOrientation(mode) {
            gameData.orientation = mode;
            showNotification('æ˜¾ç¤ºæ¨¡å¼', `å·²åˆ‡æ¢åˆ°${mode === 'portrait' ? 'ç«–å±' : 'æ¨ªå±'}æ¨¡å¼`, mode === 'portrait' ? 'ğŸ“±' : 'ğŸ’»');
            setTimeout(resizeCanvas, 100);
        }
        
        function resetGame() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦éƒ½å°†ä¸¢å¤±ï¼')) {
                showNotification('æ¸¸æˆé‡ç½®', 'æ¸¸æˆå·²é‡ç½®ï¼Œæ­£åœ¨é‡æ–°å¼€å§‹...', 'ğŸ”„');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }
        
        // ====== æ¸¸æˆé€Ÿåº¦æ§åˆ¶ ======
        function updateGameSpeed() {
            const speedSelect = document.getElementById('game-speed');
            const speed = parseInt(speedSelect.value);
            gameData.gameSpeed = speed;
            
            if (gameData.gameTimer) {
                clearInterval(gameData.gameTimer);
            }
            
            gameData.gameTimer = setInterval(updateGameTime, speed);
            
            showNotification('æ¸¸æˆé€Ÿåº¦', `æ¸¸æˆé€Ÿåº¦å·²è®¾ç½®ä¸º: ${speedSelect.options[speedSelect.selectedIndex].text}`, 'âš¡');
        }
        
        // ====== åˆå§‹åŒ– ======
        function init() {
            resizeCanvas();
            switchView('base');
            
            document.querySelectorAll('.map-tab').forEach(tab => {
                tab.addEventListener('click', () => switchView(tab.dataset.view));
            });
            
            gameData.gameTimer = setInterval(updateGameTime, gameData.gameSpeed);
            
            window.addEventListener('resize', resizeCanvas);
            
            document.getElementById('game-speed').addEventListener('change', updateGameSpeed);
            
            canvas.style.cursor = 'grab';
            
            initDLCDropZone();
            
            updateResourceDisplay();
            updateSurvivorList();
            updateAvailableBuildings();
            updateTechList();
            updateAchievementList();
            updateMonsterList();
            updateDLCList();
            updateSaveList();
            updateDefenseLevel();
            
            // åˆå§‹åŒ–è®¾ç½®æ§ä»¶
            document.getElementById('show-grid').addEventListener('change', function() {
                gameData.showGrid = this.checked;
                drawMap();
            });
            
            setTimeout(() => {
                showNotification('æ¬¢è¿æ¥åˆ°åºŸåœŸæ–¹èˆŸ', 'ç¬¬1å¤©æ—©ä¸Š7:00å¼€å§‹ï¼Œå»ºç«‹æ‚¨çš„ç”Ÿå­˜åŸºåœ°ï¼', 'ğŸ®');
                showNotification('æ–°æ‰‹æç¤º', 'ç‚¹å‡»"å¸®åŠ©"æŒ‰é’®æŸ¥çœ‹æ¸¸æˆæŒ‡å—ï¼Œå»ºè®®å…ˆå»ºé€ åŸºæœ¬ç”Ÿå­˜è®¾æ–½', 'ğŸ’¡');
                showNotification('ææ–™è·å–', 'é€šè¿‡æ¢ç´¢åºŸæ–™åœºå’Œå»ºç­‘å·¥åœ°å¯ä»¥è·å–å¤§é‡å»ºç­‘ææ–™ï¼', 'â›ï¸');
            }, 1000);
        }
        
        init();
        
        // å…¨å±€è®¿é—®
        window.zoomIn = zoomIn;
        window.zoomOut = zoomOut;
        window.resetView = resetView;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.togglePause = togglePause;
        window.setOrientation = setOrientation;
        window.toggleAutoSave = toggleAutoSave;
        window.resetGame = resetGame;
        window.toggleGrid = toggleGrid;
        window.selectBuilding = selectBuilding;
        window.selectExplorationBuilding = selectExplorationBuilding;
        window.switchView = switchView;
        window.assignJob = assignJob;
        window.assignToExploration = assignToExploration;
        window.buildStructure = buildStructure;
        window.researchTech = researchTech;
        window.saveGame = saveGame;
        window.loadGame = loadGame;
        window.loadDLCFromURL = loadDLCFromURL;
        window.installExampleDLC = installExampleDLC;
        window.toggleDLC = toggleDLC;
        window.removeDLC = removeDLC;
        window.startImmediateExploration = startImmediateExploration;
        window.startExplorationFromList = startExplorationFromList;
        window.cancelExploration = cancelExploration;
    </script>
</body>
</html>
